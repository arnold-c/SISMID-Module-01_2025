<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.475">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Matthew Ferrari">
<meta name="author" content="Callum Arnold-Leps">
<title>SISMID Module 2 Materials (2023) - R Session 02</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./r-session-03.html" rel="next">
<link href="./r-session-01.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }"><div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">R Session 02</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">SISMID Module 2 Materials (2023)</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/arnold-c/SISMID-02_2023" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle sidebar-tool" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Preface</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Pre-Requisites</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./install-r.html" class="sidebar-item-text sidebar-link">Install R</a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">Day 1</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lecture-01.html" class="sidebar-item-text sidebar-link">Lecture 01</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./r-session-01.html" class="sidebar-item-text sidebar-link">R Session 01</a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">Day 2</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./lecture-01.html" class="sidebar-item-text sidebar-link">Lecture 01</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./r-session-02.html" class="sidebar-item-text sidebar-link active">R Session 02</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./r-session-03.html" class="sidebar-item-text sidebar-link">R Session 03</a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">References</a>
  </div>
</li>
    </ul>
</div>
</nav><!-- margin-sidebar --><div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#a-model-with-2-classes" id="toc-a-model-with-2-classes" class="nav-link active" data-scroll-target="#a-model-with-2-classes">A Model With 2 Classes</a></li>
  <li>
<a href="#a-model-with-2-age-classes" id="toc-a-model-with-2-age-classes" class="nav-link" data-scroll-target="#a-model-with-2-age-classes">A Model With 2 Age Classes</a>
  <ul class="collapse">
<li><a href="#exercise-1-use-this-code-to-plot-the-number-of-susceptible-infected-and-recovered-individuals-over-time." id="toc-exercise-1-use-this-code-to-plot-the-number-of-susceptible-infected-and-recovered-individuals-over-time." class="nav-link" data-scroll-target="#exercise-1-use-this-code-to-plot-the-number-of-susceptible-infected-and-recovered-individuals-over-time.">Exercise 1: Use this code to plot the number of susceptible, infected, and recovered individuals over time.</a></li>
  </ul>
</li>
  <li>
<a href="#getting-more-realistic-adding-more-age-classes" id="toc-getting-more-realistic-adding-more-age-classes" class="nav-link" data-scroll-target="#getting-more-realistic-adding-more-age-classes">Getting more realistic: adding more age classes</a>
  <ul class="collapse">
<li><a href="#exercise-2-what-can-you-say-about-its-structure-how-are-the-different-age-groups-in-contact-with-each-other" id="toc-exercise-2-what-can-you-say-about-its-structure-how-are-the-different-age-groups-in-contact-with-each-other" class="nav-link" data-scroll-target="#exercise-2-what-can-you-say-about-its-structure-how-are-the-different-age-groups-in-contact-with-each-other">Exercise 2: What can you say about its structure? How are the different age groups in contact with each other?</a></li>
  <li><a href="#exercise-3-what-does-the-equilibrium-age-specific-seroprevalence-look-like-in-this-example" id="toc-exercise-3-what-does-the-equilibrium-age-specific-seroprevalence-look-like-in-this-example" class="nav-link" data-scroll-target="#exercise-3-what-does-the-equilibrium-age-specific-seroprevalence-look-like-in-this-example">Exercise 3: What does the equilibrium age-specific seroprevalence look like in this example?</a></li>
  <li><a href="#exercise-4" id="toc-exercise-4" class="nav-link" data-scroll-target="#exercise-4">Exercise 4:</a></li>
  </ul>
</li>
  <li>
<a href="#r0-and-the-mean-age-of-infection" id="toc-r0-and-the-mean-age-of-infection" class="nav-link" data-scroll-target="#r0-and-the-mean-age-of-infection">R0 and the mean age of infection</a>
  <ul class="collapse">
<li><a href="#exercise-5-try-the-same-as-you-fix-r_0-but-change-the-birth-rate-as-if-new-infants-were-vaccinated-instead-of-changing-the-contact-rate." id="toc-exercise-5-try-the-same-as-you-fix-r_0-but-change-the-birth-rate-as-if-new-infants-were-vaccinated-instead-of-changing-the-contact-rate." class="nav-link" data-scroll-target="#exercise-5-try-the-same-as-you-fix-r_0-but-change-the-birth-rate-as-if-new-infants-were-vaccinated-instead-of-changing-the-contact-rate.">Exercise 5: Try the same as you fix <span class="math inline">\(R_0\)</span> but change the birth rate (as if new infants were vaccinated), instead of changing the contact rate.</a></li>
  </ul>
</li>
  <li><a href="#what-do-real-contact-networks-look-like" id="toc-what-do-real-contact-networks-look-like" class="nav-link" data-scroll-target="#what-do-real-contact-networks-look-like">What do real contact networks look like?</a></li>
  <li><a href="#bonus-calculating-r0-using-a-next-generation-matrix" id="toc-bonus-calculating-r0-using-a-next-generation-matrix" class="nav-link" data-scroll-target="#bonus-calculating-r0-using-a-next-generation-matrix">Bonus: Calculating R0 Using a Next Generation Matrix</a></li>
  </ul><div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/arnold-c/SISMID-02_2023/edit/main/r-session-02.qmd" class="toc-action">Edit this page</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title d-none d-lg-block">R Session 02</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
<p class="subtitle lead">Heterogeneity and Age Structure in SIR Models</p>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Authors</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <a href="http://theferrarilab.com">Matthew Ferrari</a> <a href="https://orcid.org/0000-0001-5251-8168" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a>
  </div>
    <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Pennsylvania State University
          </p>
      </div>
      <div class="quarto-title-meta-contents">
    <a href="https://callumarnold.com">Callum Arnold-Leps</a> <a href="https://orcid.org/0000-0002-3245-6956" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a>
  </div>
    <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Pennsylvania State University
          </p>
      </div>
    </div>

<div class="quarto-title-meta">

      
  
    
  </div>
  
<div>
  <div class="abstract">
    <div class="abstract-title"></div>
    <p><em>Materials adapted from Helen Wearing and Aaron King</em></p>
  </div>
</div>

</header><div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">diagram</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://desolve.r-forge.r-project.org/">deSolve</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="a-model-with-2-classes" class="level2"><h2 class="anchored" data-anchor-id="a-model-with-2-classes">A Model With 2 Classes</h2>
<p>We’ll start with the simplest mechanistic model of two classes we can think of, which has separate classes for two groups <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span>. These groups could represent different socioeconomic classes, for example.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="r-session-02_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Which can be written in equations as, <span class="math display">\[
\begin{aligned}
    \frac{dS_a}{dt} &amp;= -\lambda_a\,S_a \phantom{-\gamma\,I_b}\\
    \frac{dS_b}{dt} &amp;= -\lambda_b\,S_b \phantom{-\gamma\,I_b}\\
    \frac{dI_a}{dt} &amp;= \phantom{-}\lambda_a\,S_a -\gamma\,I_a\\
    \frac{dI_b}{dt} &amp;= \phantom{-}\lambda_b\,S_b-\gamma\,I_b\\
    \frac{dR_a}{dt} &amp;= \phantom{-\lambda_a\,S_b}+\gamma\,I_a\\
    \frac{dR_b}{dt} &amp;= \phantom{-\lambda_a\,S_b}+\gamma\,I_b\\
  \end{aligned}
\]</span></p>
<p>The <span class="math inline">\(\lambda\)</span>s denote the group-specific force of infections:</p>
<p><span class="math display">\[
\begin{aligned}
        \lambda_a &amp;= \beta_{aa}\,I_a+\beta_{ab}\,I_b\\
        \lambda_b &amp;= \beta_{ba}\,I_a+\beta_{bb}\,I_b
\end{aligned}
\]</span> In this model, each population can infect each other but the infection moves through the populations separately. Let’s simulate such a model. To make things concrete, we’ll assume that the transmission rates <span class="math inline">\(\beta\)</span> are greater within groups than between them.</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">b1</span> <span class="op">&lt;-</span> <span class="fl">0.005</span></span>
<span><span class="va">b2</span> <span class="op">&lt;-</span> <span class="fl">0.02</span></span>
<span><span class="va">gamma</span> <span class="op">&lt;-</span> <span class="fl">10</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Here we set up the ODE model that matches the equations above</span></span>
<span><span class="va">ba.model</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">t</span>, <span class="va">x</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span>     </span>
<span>  <span class="va">s</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Sb"</span>,<span class="st">"Sa"</span><span class="op">)</span><span class="op">]</span>                  <span class="co"># susceptibles</span></span>
<span>  <span class="va">i</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Ib"</span>,<span class="st">"Ia"</span><span class="op">)</span><span class="op">]</span>                  <span class="co"># infecteds</span></span>
<span>  <span class="va">r</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Rb"</span>,<span class="st">"Ra"</span><span class="op">)</span><span class="op">]</span>                  <span class="co"># recovereds</span></span>
<span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="va">s</span><span class="op">+</span><span class="va">i</span><span class="op">+</span><span class="va">r</span>                            <span class="co"># total pop</span></span>
<span>  <span class="va">lambda.b</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">b1</span><span class="op">+</span><span class="va">b2</span><span class="op">)</span><span class="op">*</span><span class="va">i</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">+</span><span class="va">b1</span><span class="op">*</span><span class="va">i</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>      <span class="co"># group B force of infection</span></span>
<span>  <span class="va">lambda.a</span> <span class="op">&lt;-</span> <span class="va">b1</span><span class="op">*</span><span class="va">i</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">+</span><span class="op">(</span><span class="va">b1</span><span class="op">+</span><span class="va">b2</span><span class="op">)</span><span class="op">*</span><span class="va">i</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>      <span class="co"># group A force of infection</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>       <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>                               <span class="co"># these are the rates from the 6 equations above</span></span>
<span>         <span class="op">-</span><span class="va">lambda.b</span><span class="op">*</span><span class="va">s</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>         <span class="op">-</span><span class="va">lambda.a</span><span class="op">*</span><span class="va">s</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>          <span class="va">lambda.b</span><span class="op">*</span><span class="va">s</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">-</span><span class="va">gamma</span><span class="op">*</span><span class="va">i</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>          <span class="va">lambda.a</span><span class="op">*</span><span class="va">s</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">-</span><span class="va">gamma</span><span class="op">*</span><span class="va">i</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>                        <span class="va">gamma</span><span class="op">*</span><span class="va">i</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>                        <span class="va">gamma</span><span class="op">*</span><span class="va">i</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>         <span class="op">)</span></span>
<span>       <span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## initial conditions</span></span>
<span><span class="va">yinit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>Sb<span class="op">=</span><span class="fl">2000</span>,Sa<span class="op">=</span><span class="fl">1000</span>,Ib<span class="op">=</span><span class="fl">1</span>,Ia<span class="op">=</span><span class="fl">1</span>,Rb<span class="op">=</span><span class="fl">0</span>,Ra<span class="op">=</span><span class="fl">0</span><span class="op">)</span> <span class="co"># set starting conditions</span></span>
<span></span>
<span><span class="va">sol_ba</span> <span class="op">&lt;-</span> <span class="fu">deSolve</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/deSolve/man/ode.html">ode</a></span><span class="op">(</span>                          <span class="co"># run the ode solver on the model above</span></span>
<span>           y<span class="op">=</span><span class="va">yinit</span>,</span>
<span>           times<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">2</span>,by<span class="op">=</span><span class="fl">0.001</span><span class="op">)</span>,</span>
<span>           func<span class="op">=</span><span class="va">ba.model</span></span>
<span>           <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># this code will plot the resulting time series</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">sol_ba</span>, mfcol<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">sol_ba</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">sol_ba</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">sol_ba</span>,log<span class="op">=</span><span class="st">'y'</span>, mfcol<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">

</div>
<p>The results of the above are plotted below:</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># plot the proportion of individuals in each state for the two groups</span></span>
<span><span class="va">time</span> <span class="op">&lt;-</span> <span class="va">sol_ba</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>                         <span class="co"># time</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">sol_ba</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span>                           <span class="co"># all other variables</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">y</span>,<span class="fl">1</span>,<span class="va">sum</span><span class="op">)</span>                     <span class="co"># population size</span></span>
<span><span class="va">prop</span> <span class="op">&lt;-</span> <span class="va">y</span><span class="op">/</span><span class="va">n</span>                             <span class="co"># fractions</span></span>
<span><span class="va">subsampled.prop</span> <span class="op">&lt;-</span> <span class="va">prop</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span>,by<span class="op">=</span><span class="fl">10</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="va">subsampled.time</span> <span class="op">&lt;-</span> <span class="va">time</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span>,by<span class="op">=</span><span class="fl">10</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html">barplot</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">subsampled.prop</span><span class="op">)</span>,</span>
<span>        names.arg<span class="op">=</span><span class="va">subsampled.time</span>,</span>
<span>        xlab<span class="op">=</span><span class="st">'time'</span>,main<span class="op">=</span><span class="st">'Group structure'</span>,</span>
<span>        space<span class="op">=</span><span class="fl">0</span>,</span>
<span>        col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">1</span>,<span class="fl">0.5</span><span class="op">)</span>,</span>
<span>          <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span>,</span>
<span>          <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0.5</span>,<span class="fl">0.5</span><span class="op">)</span>,</span>
<span>          <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,</span>
<span>          <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">0.5</span>,<span class="fl">1</span><span class="op">)</span>,</span>
<span>          <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span></span>
<span>          <span class="op">)</span>,</span>
<span>        legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">prop</span><span class="op">)</span>,</span>
<span>        args.legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>bg<span class="op">=</span><span class="st">"white"</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="r-session-02_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section><section id="a-model-with-2-age-classes" class="level2"><h2 class="anchored" data-anchor-id="a-model-with-2-age-classes">A Model With 2 Age Classes</h2>
<p>Note that age is a special kind of heterogeneity in an epidemic model because individuals necessarily move from one class (younger) to another class (older) in a directional fashion that is independent of the infection and recovery process.</p>
<!-- Today's first lecture showed how force of infection can vary with age. -->
<!-- What sort of mechanisms might give rise to these effects? -->
<!-- Here we'll see to what extent we can infer these mechanisms on the basis of age-specific incidence and seroprevalence data. -->
<p>We’ll start by introducing age into the model above. So now <span class="math inline">\(a\)</span> becomes juveniles and <span class="math inline">\(b\)</span> becomes adults. And, independent of the disease process, juveniles (of any category) age into adults. Additionally, new juveniles are added through births (always first susceptible) and old individuals are lost to death.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="r-session-02_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<!-- $$ -->
<!-- \begin{aligned} -->
<!--   \frac{dS_J}{dt} &= -\lambda_J\,S_J \phantom{-\gamma\,I_A}\\ -->
<!--   \frac{dS_A}{dt} &= -\lambda_A\,S_A \phantom{-\gamma\,I_A}\\ -->
<!--   \frac{dI_J}{dt} &= \phantom{-}\lambda_J\,S_J -\gamma\,I_J\\ -->
<!--   \frac{dI_A}{dt} &= \phantom{-}\lambda_A\,S_A-\gamma\,I_A\\ -->
<!--   \frac{dR_J}{dt} &= \phantom{-\lambda_J\,S_A}+\gamma\,I_J\\ -->
<!--   \frac{dR_A}{dt} &= \phantom{-\lambda_J\,S_A}+\gamma\,I_A\\ -->
<!-- \end{aligned} -->
<!-- $$ The $\lambda$s denote the age-specific force of infections: $$ -->
<!-- \begin{aligned} -->
<!--     \lambda_J &= \beta_{JJ}\,I_J+\beta_{JA}\,I_A\\ -->
<!--     \lambda_A &= \beta_{AJ}\,I_J+\beta_{AA}\,I_A -->
<!--   \end{aligned} -->
<!-- $$  -->
<p>We can do this very simply using the same ingredients that go into the basic SIR model. In that model, the waiting times in the S and I classes are exponential. Let’s assume the same thing about the aging process. We’ll also add in births into the juvenile susceptible class and deaths from the adult classes.</p>
<p><span class="math display">\[
  \begin{aligned}
    \frac{dS_J}{dt} &amp;= -\lambda_J\,S_J \phantom{-\gamma\,I_A}  +B \phantom{-\mu\,S_A}-\alpha\,S_J\\
    \frac{dS_A}{dt} &amp;= -\lambda_A\,S_A \phantom{-\gamma\,I_A +B} -\mu\,S_A+\alpha\,S_J\\
    \frac{dI_J}{dt} &amp;= \phantom{-}\lambda_J\,S_J -\gamma\,I_J\phantom{+B-\mu\,S_A}-\alpha\,I_J\\
    \frac{dI_A}{dt} &amp;= \phantom{-}\lambda_A\,S_A-\gamma\,I_A \phantom{+B} -\mu\,I_A+\alpha\,I_J\\
    \frac{dR_J}{dt} &amp;= \phantom{-\lambda_J\,S_A}+\gamma\,I_J\phantom{+B-\mu\,S_A}-\alpha\,R_J\\
    \frac{dR_A}{dt} &amp;= \phantom{-\lambda_J\,S_A}+\gamma\,I_A \phantom{+B}-\mu\,R_A+\alpha\,R_J\\
  \end{aligned}
\]</span></p>
<p>Now, let’s simulate this model, under the same assumptions about transmission rates as above.</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># define the parameters</span></span>
<span><span class="va">b1_demog</span> <span class="op">&lt;-</span> <span class="fl">0.002</span></span>
<span><span class="va">b2_demog</span> <span class="op">&lt;-</span> <span class="fl">0.002</span></span>
<span><span class="va">gamma_demog</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="va">births_demog</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span><span class="va">da_demog</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">20</span>,<span class="fl">60</span><span class="op">)</span>                          <span class="co"># alpha = 1/da</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ja.demog.model</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">t</span>, <span class="va">x</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">s</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Sj"</span>,<span class="st">"Sa"</span><span class="op">)</span><span class="op">]</span>                  <span class="co"># susceptibles</span></span>
<span>  <span class="va">i</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Ij"</span>,<span class="st">"Ia"</span><span class="op">)</span><span class="op">]</span>                  <span class="co"># infecteds</span></span>
<span>  <span class="va">r</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Rj"</span>,<span class="st">"Ra"</span><span class="op">)</span><span class="op">]</span>                  <span class="co"># recovereds</span></span>
<span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="va">s</span><span class="op">+</span><span class="va">i</span><span class="op">+</span><span class="va">r</span>                            <span class="co"># total pop</span></span>
<span>  <span class="va">lambda.j</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">b1_demog</span><span class="op">+</span><span class="va">b2_demog</span><span class="op">)</span><span class="op">*</span><span class="va">i</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">+</span><span class="va">b1_demog</span><span class="op">*</span><span class="va">i</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>      <span class="co"># juv. force of infection </span></span>
<span>  <span class="va">lambda.a</span> <span class="op">&lt;-</span> <span class="va">b1_demog</span><span class="op">*</span><span class="va">i</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">+</span><span class="op">(</span><span class="va">b1_demog</span><span class="op">+</span><span class="va">b2_demog</span><span class="op">)</span><span class="op">*</span><span class="va">i</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>      <span class="co"># adult. force of infection</span></span>
<span>  <span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="va">da_demog</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>       <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>         <span class="op">-</span><span class="va">lambda.j</span><span class="op">*</span><span class="va">s</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>           <span class="op">-</span><span class="va">alpha</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="va">s</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">+</span><span class="va">births_demog</span>,</span>
<span>         <span class="op">-</span><span class="va">lambda.a</span><span class="op">*</span><span class="va">s</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>           <span class="op">+</span><span class="va">alpha</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="va">s</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">-</span><span class="va">alpha</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">*</span><span class="va">s</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>          <span class="va">lambda.j</span><span class="op">*</span><span class="va">s</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">-</span><span class="va">gamma_demog</span><span class="op">*</span><span class="va">i</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">-</span><span class="va">alpha</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="va">i</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>          <span class="va">lambda.a</span><span class="op">*</span><span class="va">s</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">-</span><span class="va">gamma_demog</span><span class="op">*</span><span class="va">i</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">+</span><span class="va">alpha</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="va">i</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">-</span><span class="va">alpha</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">*</span><span class="va">i</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,</span>
<span>                        <span class="va">gamma_demog</span><span class="op">*</span><span class="va">i</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">-</span><span class="va">alpha</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="va">r</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>                        <span class="va">gamma_demog</span><span class="op">*</span><span class="va">i</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">+</span><span class="va">alpha</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="va">r</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">-</span><span class="va">alpha</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">*</span><span class="va">r</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>         <span class="op">)</span></span>
<span>       <span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that in this function, <span class="math inline">\(\mu=\)</span> <code>alpha[2]</code>, i.e., death, is just like another age class.</p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## initial conditions</span></span>
<span><span class="va">yinit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>Sj<span class="op">=</span><span class="fl">2000</span>,Sa<span class="op">=</span><span class="fl">3000</span>,Ij<span class="op">=</span><span class="fl">0</span>,Ia<span class="op">=</span><span class="fl">1</span>,Rj<span class="op">=</span><span class="fl">0</span>,Ra<span class="op">=</span><span class="fl">1000</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sol_demog</span> <span class="op">&lt;-</span> <span class="fu">deSolve</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/deSolve/man/ode.html">ode</a></span><span class="op">(</span></span>
<span>           y<span class="op">=</span><span class="va">yinit</span>,</span>
<span>           times<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">200</span>,by<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span>,</span>
<span>           func<span class="op">=</span><span class="va">ja.demog.model</span></span>
<span>           <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="exercise-1-use-this-code-to-plot-the-number-of-susceptible-infected-and-recovered-individuals-over-time." class="level3"><h3 class="anchored" data-anchor-id="exercise-1-use-this-code-to-plot-the-number-of-susceptible-infected-and-recovered-individuals-over-time.">Exercise 1: Use this code to plot the number of susceptible, infected, and recovered individuals over time.</h3>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">sol_demog</span>, mfcol<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">sol_demog</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">sol_demog</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">sol_demog</span>,log<span class="op">=</span><span class="st">'y'</span>,mfcol<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">

</div>
<p>Note that now that births are replenishing susceptibles infection persists. The results of the above are plotted here :</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#plot the relative proportion of individuals in each category</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">time</span> <span class="op">&lt;-</span> <span class="va">sol_demog</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>                         <span class="co"># time</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">sol_demog</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span>                           <span class="co"># all other variables</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">y</span>,<span class="fl">1</span>,<span class="va">sum</span><span class="op">)</span>                     <span class="co"># population size</span></span>
<span><span class="va">prop</span> <span class="op">&lt;-</span> <span class="va">y</span><span class="op">/</span><span class="va">n</span>                             <span class="co"># fractions</span></span>
<span><span class="va">subsampled.prop</span> <span class="op">&lt;-</span> <span class="va">prop</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span>,by<span class="op">=</span><span class="fl">10</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="va">subsampled.time</span> <span class="op">&lt;-</span> <span class="va">time</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">time</span><span class="op">)</span>,by<span class="op">=</span><span class="fl">10</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html">barplot</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">subsampled.prop</span><span class="op">)</span>,</span>
<span>        names.arg<span class="op">=</span><span class="va">subsampled.time</span>,</span>
<span>        xlab<span class="op">=</span><span class="st">'time'</span>,main<span class="op">=</span><span class="st">'Age structure'</span>,</span>
<span>        space<span class="op">=</span><span class="fl">0</span>,</span>
<span>        col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">1</span>,<span class="fl">0.5</span><span class="op">)</span>,</span>
<span>          <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">0</span><span class="op">)</span>,</span>
<span>          <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0.5</span>,<span class="fl">0.5</span><span class="op">)</span>,</span>
<span>          <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span>,</span>
<span>          <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">0.5</span>,<span class="fl">1</span><span class="op">)</span>,</span>
<span>          <span class="fu"><a href="https://rdrr.io/r/grDevices/rgb.html">rgb</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span></span>
<span>          <span class="op">)</span>,</span>
<span>        legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">prop</span><span class="op">)</span>,</span>
<span>        args.legend<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>bg<span class="op">=</span><span class="st">"white"</span><span class="op">)</span>,</span>
<span>        border <span class="op">=</span> <span class="cn">NA</span></span>
<span>        <span class="op">)</span></span>
<span><span class="va">equil</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/drop.html">drop</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">tail</a></span><span class="op">(</span><span class="va">sol_demog</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="va">equil</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Sj"</span>,<span class="st">"Sa"</span><span class="op">)</span><span class="op">]</span><span class="op">+</span><span class="va">equil</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Ij"</span>,<span class="st">"Ia"</span><span class="op">)</span><span class="op">]</span><span class="op">+</span><span class="va">equil</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Rj"</span>,<span class="st">"Ra"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">seroprev</span> <span class="op">&lt;-</span> <span class="va">equil</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Rj"</span>,<span class="st">"Ra"</span><span class="op">)</span><span class="op">]</span><span class="op">/</span><span class="va">n</span>            <span class="co"># get the proportion in the R class at equilibrium</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">seroprev</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"J"</span>,<span class="st">"A"</span><span class="op">)</span>                </span>
<span></span>
<span><span class="co">#plot the proportion of each age class </span></span>
<span><span class="co"># that has been previously infected (is in the R class) </span></span>
<span><span class="co"># and would thus be expected to have antibodies (i.e. seropositive)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html">barplot</a></span><span class="op">(</span>height<span class="op">=</span><span class="va">seroprev</span>,width<span class="op">=</span><span class="va">da_demog</span>,ylab<span class="op">=</span><span class="st">"seroprevalence"</span><span class="op">)</span>  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="r-session-02_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">

</div>
<p>To compute <span class="math inline">\(R_0\)</span>, we need to know the stable age distribution (the relative proportion in the juvenile and adult age classes) of the population, which we can find by solving for the disease-free equilibrium: <span class="math inline">\(S_J^*=B/\alpha\)</span> and <span class="math inline">\(S_A^*=B/\mu\)</span>.</p>
<p>With the stable age distribution, we can calculate <span class="math inline">\(R_0\)</span> by constructing the next generation matrix. Details on this method are described in the last section of this worksheet and are not required for completing the exercises in the worksheet. The code below outlines how the next generation matrix is constructed using the <span class="math inline">\(\alpha\)</span> (aging from juvenile to adult), <span class="math inline">\(\mu\)</span> death), <span class="math inline">\(n\)</span> (total births), <span class="math inline">\(\gamma\)</span> (recovery), <span class="math inline">\(da\)</span> (width of age groups in years), and <span class="math inline">\(\beta\)</span> (transmission) parameters.</p>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># this code can be re-run to set parameter values</span></span>
<span><span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="va">da_demog</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">mu</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="va">da_demog</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="va">births_demog</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">alpha</span>,<span class="va">mu</span><span class="op">)</span></span>
<span><span class="va">beta_demog</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">b1_demog</span><span class="op">+</span><span class="va">b2</span>,<span class="va">b1_demog</span>,<span class="va">b1_demog</span>,<span class="va">b1_demog</span><span class="op">+</span><span class="va">b2</span><span class="op">)</span>,nrow<span class="op">=</span><span class="fl">2</span>,ncol<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># this command craetes the next generation matrix</span></span>
<span><span class="va">ngm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span></span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>                <span class="va">n</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="va">beta_demog</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span><span class="op">/</span><span class="op">(</span><span class="va">gamma_demog</span><span class="op">+</span><span class="va">alpha</span><span class="op">)</span><span class="op">+</span></span>
<span>                  <span class="va">alpha</span><span class="op">/</span><span class="op">(</span><span class="va">gamma_demog</span><span class="op">+</span><span class="va">mu</span><span class="op">)</span><span class="op">*</span><span class="va">n</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="va">beta_demog</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span><span class="op">/</span><span class="op">(</span><span class="va">gamma_demog</span><span class="op">+</span><span class="va">mu</span><span class="op">)</span>,</span>
<span>                <span class="va">n</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">*</span><span class="va">beta_demog</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span><span class="op">/</span><span class="op">(</span><span class="va">gamma_demog</span><span class="op">+</span><span class="va">alpha</span><span class="op">)</span><span class="op">+</span></span>
<span>                  <span class="va">alpha</span><span class="op">/</span><span class="op">(</span><span class="va">gamma_demog</span><span class="op">+</span><span class="va">mu</span><span class="op">)</span><span class="op">*</span><span class="va">n</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">*</span><span class="va">beta_demog</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">]</span><span class="op">/</span><span class="op">(</span><span class="va">gamma_demog</span><span class="op">+</span><span class="va">mu</span><span class="op">)</span>,</span>
<span>                <span class="va">n</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="va">beta_demog</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span><span class="op">/</span><span class="op">(</span><span class="va">gamma_demog</span><span class="op">+</span><span class="va">mu</span><span class="op">)</span>,</span>
<span>                <span class="va">n</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">*</span><span class="va">beta_demog</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">]</span><span class="op">/</span><span class="op">(</span><span class="va">gamma_demog</span><span class="op">+</span><span class="va">mu</span><span class="op">)</span></span>
<span>                <span class="op">)</span>,</span>
<span>              nrow<span class="op">=</span><span class="fl">2</span>,</span>
<span>              ncol<span class="op">=</span><span class="fl">2</span></span>
<span>              <span class="op">)</span></span>
<span></span>
<span><span class="co"># this command outputs the R0 value</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/complex.html">Re</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/eigen.html">eigen</a></span><span class="op">(</span><span class="va">ngm</span>,only.values<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">$</span><span class="va">values</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 13.23485</code></pre>
</div>
</div>
</section></section><section id="getting-more-realistic-adding-more-age-classes" class="level2"><h2 class="anchored" data-anchor-id="getting-more-realistic-adding-more-age-classes">Getting more realistic: adding more age classes</h2>
<p>In the models above, the aging process follows an exponential distribution, which means that whether an individual is 1~year old or 10 years old, the chance of them becoming an adult is the same! To improve on this, we can assume that the time a juvenile must wait before becoming an adult follows a gamma distribution. This is equivalent to saying that the waiting time is a sum of some number of exponential distributions. This suggests that we can achieve such a distribution by adding age classes to the model, so that becoming an adult means passing through some number of stages. We’ll use 30 age classes, and since they don’t have to be of equal duration, we’ll assume that they’re not. Specifically, we’ll have 20 1-yr age classes to take us up to adulthood and break adults into 10 age classes of 5~yr duration each. The last age class covers age 66-80.</p>
<p>Now, when we had just two age classes, we could write out each of the equations easily enough, but now that we’re going to have 30, we’ll need to be more systematic. In particular, we’ll need to think of <span class="math inline">\(\beta\)</span> as a matrix of transmission rates. Let’s see how to define such a matrix in <strong>R</strong>. So that we don’t change too many things all at once, let’s keep the same contact structure as in the juvenile-adult model.</p>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">b1_ages</span> <span class="op">&lt;-</span> <span class="fl">0.02</span>  <span class="co">#transmission rate</span></span>
<span><span class="va">b2_ages</span> <span class="op">&lt;-</span> <span class="fl">0.01</span>  <span class="co">#transmission rate</span></span>
<span><span class="va">gamma_ages</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="va">births_ages</span> <span class="op">&lt;-</span> <span class="fl">100</span></span>
<span></span>
<span></span>
<span><span class="va">ages</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">20</span>,by<span class="op">=</span><span class="fl">1</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">25</span>,<span class="fl">65</span>,by<span class="op">=</span><span class="fl">5</span><span class="op">)</span>,<span class="fl">80</span><span class="op">)</span> <span class="co"># upper end of age classes</span></span>
<span><span class="va">da_ages</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">ages</span><span class="op">)</span><span class="op">)</span>                        <span class="co"># widths of age classes</span></span>
<span></span>
<span><span class="co"># set up a matrix of contact rates between classes -- more contact within juveniles and adults than between</span></span>
<span><span class="va">beta_ages</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span>nrow<span class="op">=</span><span class="fl">30</span>,ncol<span class="op">=</span><span class="fl">30</span><span class="op">)</span>    </span>
<span><span class="va">beta_ages</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">b1_ages</span> <span class="co"># transmission rate for juveniles </span></span>
<span><span class="va">beta_ages</span><span class="op">[</span><span class="fl">21</span><span class="op">:</span><span class="fl">30</span>,<span class="fl">21</span><span class="op">:</span><span class="fl">30</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">b2_ages</span> <span class="co"># transmission rate for adults</span></span>
<span><span class="va">beta_ages</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span>,<span class="fl">21</span><span class="op">:</span><span class="fl">30</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">b2_ages</span><span class="op">/</span><span class="fl">2</span> <span class="co"># lower transmission rate between juveniles and adults</span></span>
<span><span class="va">beta_ages</span><span class="op">[</span><span class="fl">21</span><span class="op">:</span><span class="fl">30</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">b2_ages</span><span class="op">/</span><span class="fl">2</span> <span class="co"># lower transmission rate between juveniles and adults</span></span>
<span></span>
<span><span class="co">#WAIFW stands for Who Aquires Infection From Whom</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/filled.contour.html">filled.contour</a></span><span class="op">(</span><span class="va">ages</span>, <span class="va">ages</span>, <span class="va">beta_ages</span>,                </span>
<span>               plot.title<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html">title</a></span><span class="op">(</span></span>
<span>                 main<span class="op">=</span><span class="st">"WAIFW matrix"</span>,      </span>
<span>                 xlab<span class="op">=</span><span class="st">"age"</span>,ylab<span class="op">=</span><span class="st">"age"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="r-session-02_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We’ll assume that, at the time of introduction, all children are susceptible, as are adults over 45, but that individuals aged 20–45 have seen the pathogen before and are immune. The vector <code>yinit</code> expresses these initial conditions.</p>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">yinit_ages</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>           S<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">100</span>,<span class="fl">20</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">5</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">200</span>,<span class="fl">5</span><span class="op">)</span><span class="op">)</span>,</span>
<span>           I<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">25</span><span class="op">)</span>,<span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">4</span><span class="op">)</span><span class="op">)</span>,</span>
<span>           R<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">20</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1000</span>,<span class="fl">5</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span>           <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that we’re starting out with 1 infected individual in the 26th age class.</p>
<p>The codes that follow will be a bit easier to follow if we introduce some indexes that will allow us to pick out certain bits of the <code>yinit</code> vector.</p>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sindex</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">30</span></span>
<span><span class="va">iindex</span> <span class="op">&lt;-</span> <span class="fl">31</span><span class="op">:</span><span class="fl">60</span></span>
<span><span class="va">rindex</span> <span class="op">&lt;-</span> <span class="fl">61</span><span class="op">:</span><span class="fl">90</span></span>
<span><span class="va">juvies</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">20</span></span>
<span><span class="va">adults</span> <span class="op">&lt;-</span> <span class="fl">21</span><span class="op">:</span><span class="fl">30</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, to capture the aging process, it’s convenient to define another matrix to hold the rates of movement between age classes.</p>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">aging</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">/</span><span class="va">da_ages</span><span class="op">)</span></span>
<span><span class="va">aging</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/row.html">row</a></span><span class="op">(</span><span class="va">aging</span><span class="op">)</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/col.html">col</a></span><span class="op">(</span><span class="va">aging</span><span class="op">)</span><span class="op">==</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">da_ages</span>,<span class="op">-</span><span class="fl">1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Have a look at the aging matrix, for example by doing:</p>
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># move fast through the 1-year age classes - negatives are moves out, positives are moves in</span></span>
<span><span class="va">aging</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span> </span>
<span></span>
<span><span class="co"># don't age between these classes -- e.g. can't age from 1 to 6</span></span>
<span><span class="va">aging</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,<span class="fl">6</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span> </span>
<span></span>
<span><span class="co"># move slowly between the wider age classes</span></span>
<span><span class="va">aging</span><span class="op">[</span><span class="fl">25</span><span class="op">:</span><span class="fl">30</span>,<span class="fl">25</span><span class="op">:</span><span class="fl">30</span><span class="op">]</span> </span>
<span></span>
<span><span class="co">#plot the aging matrix</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/filled.contour.html">filled.contour</a></span><span class="op">(</span><span class="va">ages</span>, <span class="va">ages</span>, <span class="va">aging</span>,                </span>
<span>               plot.title<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html">title</a></span><span class="op">(</span></span>
<span>                 main<span class="op">=</span><span class="st">"Aging matrix"</span>,</span>
<span>                 xlab<span class="op">=</span><span class="st">"age"</span>,ylab<span class="op">=</span><span class="st">"age"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="exercise-2-what-can-you-say-about-its-structure-how-are-the-different-age-groups-in-contact-with-each-other" class="level3"><h3 class="anchored" data-anchor-id="exercise-2-what-can-you-say-about-its-structure-how-are-the-different-age-groups-in-contact-with-each-other">Exercise 2: What can you say about its structure? How are the different age groups in contact with each other?</h3>
<p>Now we can put the pieces together to write a simulator for the age-structured SIR dynamics.</p>
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ja.multistage.model</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">t</span>, <span class="va">x</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">s</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="va">sindex</span><span class="op">]</span>                  <span class="co"># susceptibles</span></span>
<span>  <span class="va">i</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="va">iindex</span><span class="op">]</span>                  <span class="co"># infecteds</span></span>
<span>  <span class="va">r</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="va">rindex</span><span class="op">]</span>                  <span class="co"># recovereds</span></span>
<span>  <span class="va">lambda</span> <span class="op">&lt;-</span> <span class="va">beta_ages</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span><span class="va">i</span>              <span class="co"># force of infection</span></span>
<span>  <span class="va">dsdt</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="va">lambda</span><span class="op">*</span><span class="va">s</span><span class="op">+</span><span class="va">aging</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span><span class="va">s</span></span>
<span>  <span class="va">didt</span> <span class="op">&lt;-</span>  <span class="va">lambda</span><span class="op">*</span><span class="va">s</span><span class="op">+</span><span class="va">aging</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span><span class="va">i</span><span class="op">-</span><span class="va">gamma_ages</span><span class="op">*</span><span class="va">i</span></span>
<span>  <span class="va">drdt</span> <span class="op">&lt;-</span>           <span class="va">aging</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span><span class="va">r</span><span class="op">+</span><span class="va">gamma_ages</span><span class="op">*</span><span class="va">i</span> </span>
<span>  <span class="va">dsdt</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">dsdt</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">+</span><span class="va">births_ages</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span></span>
<span>       <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>         <span class="va">dsdt</span>,</span>
<span>         <span class="va">didt</span>,</span>
<span>         <span class="va">drdt</span></span>
<span>         <span class="op">)</span></span>
<span>       <span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can plug this into <code>ode</code> just as we did the simpler models to simulate an epidemic. We’ll then plot the epidemic curve.</p>
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sol_ms</span> <span class="op">&lt;-</span> <span class="fu">deSolve</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/deSolve/man/ode.html">ode</a></span><span class="op">(</span></span>
<span>           y<span class="op">=</span><span class="va">yinit_ages</span>,</span>
<span>           times<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">100</span>,by<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span>,</span>
<span>           func<span class="op">=</span><span class="va">ja.multistage.model</span>,</span>
<span>           parms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>beta_ages <span class="op">=</span> <span class="va">beta_ages</span>, aging<span class="op">=</span><span class="va">aging</span>, births_ages <span class="op">=</span> <span class="va">births_ages</span><span class="op">)</span></span>
<span>           <span class="op">)</span></span>
<span><span class="va">time_ms</span> <span class="op">&lt;-</span> <span class="va">sol_ms</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">infects_ms</span> <span class="op">&lt;-</span> <span class="va">sol_ms</span><span class="op">[</span>,<span class="fl">1</span><span class="op">+</span><span class="va">iindex</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">time_ms</span>,<span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">infects_ms</span>,<span class="fl">1</span>,<span class="va">sum</span><span class="op">)</span>,type<span class="op">=</span><span class="st">'l'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">time_ms</span>,<span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">infects_ms</span><span class="op">[</span>,<span class="va">juvies</span><span class="op">]</span>,<span class="fl">1</span>,<span class="va">sum</span><span class="op">)</span>,col<span class="op">=</span><span class="st">'red'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">time_ms</span>,<span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">infects_ms</span><span class="op">[</span>,<span class="va">adults</span><span class="op">]</span>,<span class="fl">1</span>,<span class="va">sum</span><span class="op">)</span>,col<span class="op">=</span><span class="st">'blue'</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s mimic a situation where we have cross-sectional seroprevalence data (e.g.&nbsp;measures of antibodies that tell you someone is in the R class). In using such data, we’d typically assume that the system was at equilibrium.</p>
</section><section id="exercise-3-what-does-the-equilibrium-age-specific-seroprevalence-look-like-in-this-example" class="level3"><h3 class="anchored" data-anchor-id="exercise-3-what-does-the-equilibrium-age-specific-seroprevalence-look-like-in-this-example">Exercise 3: What does the equilibrium age-specific seroprevalence look like in this example?</h3>
<p>Use the code below to display the age-specific seroprevalence (i.e., the seroprevalence for each age group at equilibrium)</p>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">equil_ms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/drop.html">drop</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">tail</a></span><span class="op">(</span><span class="va">sol_ms</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">n_ms</span> <span class="op">&lt;-</span> <span class="va">equil_ms</span><span class="op">[</span><span class="va">sindex</span><span class="op">]</span><span class="op">+</span><span class="va">equil_ms</span><span class="op">[</span><span class="va">iindex</span><span class="op">]</span><span class="op">+</span><span class="va">equil_ms</span><span class="op">[</span><span class="va">rindex</span><span class="op">]</span></span>
<span><span class="va">seroprev_ms</span> <span class="op">&lt;-</span> <span class="va">equil_ms</span><span class="op">[</span><span class="va">rindex</span><span class="op">]</span><span class="op">/</span><span class="va">n_ms</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">seroprev_ms</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">ages</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html">barplot</a></span><span class="op">(</span>height<span class="op">=</span><span class="va">seroprev_ms</span>,width<span class="op">=</span><span class="va">da_ages</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s also compute <span class="math inline">\(R_0\)</span>. To do so, we’ll need the stable age distribution. We can get that by simulating an infection-free population, which we get by setting the initial I to all 0s:</p>
<div class="cell">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">yinit.sonly</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>                 S<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">250</span>,<span class="fl">30</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                 I<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">30</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                 R<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">30</span><span class="op">)</span><span class="op">)</span></span>
<span>                 <span class="op">)</span></span>
<span><span class="va">sol_sonly</span> <span class="op">&lt;-</span> <span class="fu">deSolve</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/deSolve/man/ode.html">ode</a></span><span class="op">(</span></span>
<span>           y<span class="op">=</span><span class="va">yinit.sonly</span>,</span>
<span>           times<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">300</span>,by<span class="op">=</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>           func<span class="op">=</span><span class="va">ja.multistage.model</span>,</span>
<span>           parms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>beta<span class="op">=</span><span class="va">beta</span>, aging<span class="op">=</span><span class="va">aging</span>, births<span class="op">=</span><span class="va">births_demog</span><span class="op">)</span></span>
<span>           <span class="op">)</span></span>
<span><span class="va">time_sonly</span> <span class="op">&lt;-</span> <span class="va">sol_sonly</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">pop</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">sol_sonly</span><span class="op">[</span>,<span class="op">-</span><span class="fl">1</span><span class="op">]</span>,<span class="fl">1</span>,<span class="va">sum</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">time_sonly</span>,<span class="va">pop</span>,type<span class="op">=</span><span class="st">'l'</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Alternatively, we can get the stable age distribution by finding the population structure that balances the birth, aging, and death processes. At equilibrium, we have the matrix equation <span class="math display">\[
\begin{pmatrix}
    -\alpha_1 &amp; 0 &amp; 0 &amp; \cdots &amp; 0\\
    \alpha_1 &amp; -\alpha_2 &amp; 0 &amp; \cdots &amp; 0\\
    0 &amp; \alpha_2 &amp; -\alpha_3 &amp; \cdots &amp; 0\\
    \vdots &amp;  &amp; \ddots &amp; \ddots &amp; \vdots \\
    0 &amp; \cdots &amp; &amp; \alpha_{29} &amp; -\alpha_{30}\\
  \end{pmatrix} . \begin{pmatrix}
    n_1 \\ n_2 \\ n_3 \\ \vdots \\ n_{30}
  \end{pmatrix} + \begin{pmatrix}
    B \\ 0 \\ 0 \\ \vdots \\ 0
  \end{pmatrix}=
  \begin{pmatrix}
    0 \\ 0 \\ 0 \\ \vdots \\ 0
  \end{pmatrix}
\]</span> To solve this equation in <strong>R</strong>, we can do</p>
<div class="cell">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## get stable age distribution</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html">solve</a></span><span class="op">(</span><span class="va">aging</span>,<span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">births_ages</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">29</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The following lines then compute <span class="math inline">\(R_0\)</span> using the next generation matrix method. More details are available in the “Bonus” section at the end of the document. This calculation comes from a recipe described in detail by <strong>Diekmann &amp; Heesterbeek, 2000</strong> and <strong>Hurford <em>et. al</em>, 2010</strong>.</p>
<div class="cell">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="cn">F</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span><span class="va">beta_ages</span><span class="op">+</span><span class="va">aging</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">aging</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">V</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">gamma_ages</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">aging</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/complex.html">Re</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/eigen.html">eigen</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/solve.html">solve</a></span><span class="op">(</span><span class="va">V</span>,<span class="cn">F</span><span class="op">)</span>,only.values<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">$</span><span class="va">values</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6.792003</code></pre>
</div>
</div>
<div class="cell">

</div>
</section><section id="exercise-4" class="level3"><h3 class="anchored" data-anchor-id="exercise-4">Exercise 4:</h3>
<section id="a.-change-the-juvenile-and-adult-contact-rates-b1_ages-and-b2_ages-to-reflect-different-transmission-within-groups.-make-the-juvenile-contact-rate-0.02-to-reflect-higher-contact-among-kids-e.g.-in-schools." class="level4"><h4 class="anchored" data-anchor-id="a.-change-the-juvenile-and-adult-contact-rates-b1_ages-and-b2_ages-to-reflect-different-transmission-within-groups.-make-the-juvenile-contact-rate-0.02-to-reflect-higher-contact-among-kids-e.g.-in-schools.">a. Change the juvenile and adult contact rates (b1_ages and b2_ages) to reflect different transmission within groups. Make the juvenile contact rate 0.02 to reflect higher contact among kids (e.g.&nbsp;in schools).</h4>
</section><section id="b.-use-image-or-filled.contour-to-plot-the-beta-matrix." class="level4"><h4 class="anchored" data-anchor-id="b.-use-image-or-filled.contour-to-plot-the-beta-matrix.">b. Use <code>image</code> or <code>filled.contour</code> to plot the <span class="math inline">\(\beta\)</span> matrix.</h4>
</section><section id="c.-compute-r_0-for-your-assumptions." class="level4"><h4 class="anchored" data-anchor-id="c.-compute-r_0-for-your-assumptions.">c.&nbsp;Compute <span class="math inline">\(R_0\)</span> for your assumptions.</h4>
</section><section id="d.-simulate-and-plot-the-age-structured-sir-dynamics-under-your-assumptions-and-record-how-the-age-specific-seroprevalence-has-changed." class="level4"><h4 class="anchored" data-anchor-id="d.-simulate-and-plot-the-age-structured-sir-dynamics-under-your-assumptions-and-record-how-the-age-specific-seroprevalence-has-changed.">d.&nbsp;Simulate and plot the age-structured SIR dynamics under your assumptions and record how the age-specific seroprevalence has changed.</h4>
<div class="cell">

</div>
<div class="cell">

</div>
<div class="cell">

</div>
</section></section></section><section id="r0-and-the-mean-age-of-infection" class="level2"><h2 class="anchored" data-anchor-id="r0-and-the-mean-age-of-infection">R0 and the mean age of infection</h2>
<p>For simplicity, let’s return to the earlier models with a simple age-class mixing matrix. But this time, we’ll calculate <span class="math inline">\(R_0\)</span>, the mean age of infection, and the number of cases between 15-35 years as we increase the rate of contact. Recall from the rubella and CRS example that the risk of severe disease outcomes depends on the risk of infection in reproductive age women. Recall also that increasing vaccination reduces <span class="math inline">\(R_E\)</span> – so here we’ll evalate at several values of <span class="math inline">\(R_0\)</span> as a proxy for the impact of vaccination. We’ll then calculate how the mean age of infection changes, and specifically how the absolute number of cases among individuals between the ages of 15-35 (as a proxy for reproductive age women) changes. To do so, we’ll make a loop and evaluate the code for each of 10 increasing levels of mixing (which whill change R0)</p>
<div class="cell">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span> <span class="co"># a vector of scaling factors, we'll reduce the contact rate </span></span>
<span> <span class="co"># from the original code by each of the values in this vector</span></span>
<span><span class="va">scale</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">.2</span>,<span class="fl">1</span>,length<span class="op">=</span><span class="fl">10</span><span class="op">)</span> </span>
<span><span class="va">R0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># somewhere to store results for the mean age</span></span>
<span><span class="va">mean_age</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># somewhere to store results for the mean age</span></span>
<span><span class="va">sum_cases</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># somewhere to store results for the mean age</span></span>
<span></span>
<span><span class="co"># this loop will run for as many different levels of contact that we specify </span></span>
<span><span class="co"># for the scale variable </span></span>
<span><span class="co"># this is the same code as above, but now we've included a multiplier for the </span></span>
<span><span class="co"># contact matrix</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">ii</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">scale</span><span class="op">)</span><span class="op">)</span><span class="op">{</span> </span>
<span>  <span class="va">b1</span> <span class="op">&lt;-</span> <span class="fl">0.007</span></span>
<span>  <span class="va">b2</span> <span class="op">&lt;-</span> <span class="fl">0.02</span></span>
<span>  <span class="va">b3</span> <span class="op">&lt;-</span> <span class="fl">0.03</span></span>
<span>  <span class="va">beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">b1</span>,nrow<span class="op">=</span><span class="fl">30</span>,ncol<span class="op">=</span><span class="fl">30</span><span class="op">)</span></span>
<span>  <span class="va">beta</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">b2</span></span>
<span>  <span class="va">beta</span><span class="op">[</span><span class="fl">6</span><span class="op">:</span><span class="fl">16</span>,<span class="fl">6</span><span class="op">:</span><span class="fl">16</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">b3</span></span>
<span>  <span class="va">beta_ages</span> <span class="op">&lt;-</span> <span class="va">beta</span> <span class="op">*</span> <span class="va">scale</span><span class="op">[</span><span class="va">ii</span><span class="op">]</span></span>
<span>  <span class="co">#filled.contour(beta)</span></span>
<span></span>
<span>  </span>
<span>  <span class="va">sol_R0</span> <span class="op">&lt;-</span> <span class="fu">deSolve</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/deSolve/man/ode.html">ode</a></span><span class="op">(</span></span>
<span>    y<span class="op">=</span><span class="va">yinit_ages</span>,</span>
<span>    times<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">400</span>,by<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span>,</span>
<span>    func<span class="op">=</span><span class="va">ja.multistage.model</span>,</span>
<span>    parms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>beta_ages<span class="op">=</span><span class="va">beta_ages</span>, aging<span class="op">=</span><span class="va">aging</span>, births_ages<span class="op">=</span><span class="va">births_ages</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  </span>
<span>  <span class="va">equil_R0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/drop.html">drop</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">tail</a></span><span class="op">(</span><span class="va">sol_R0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span>  <span class="va">n_R0</span> <span class="op">&lt;-</span> <span class="va">equil_R0</span><span class="op">[</span><span class="va">sindex</span><span class="op">]</span><span class="op">+</span><span class="va">equil_R0</span><span class="op">[</span><span class="va">iindex</span><span class="op">]</span><span class="op">+</span><span class="va">equil_R0</span><span class="op">[</span><span class="va">rindex</span><span class="op">]</span></span>
<span>  <span class="va">seroprev_R0</span> <span class="op">&lt;-</span> <span class="va">equil_R0</span><span class="op">[</span><span class="va">rindex</span><span class="op">]</span><span class="op">/</span><span class="va">n_R0</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">seroprev_R0</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">ages</span></span>
<span>  <span class="co"># barplot(height=seroprev,width=da)</span></span>
<span>  </span>
<span>  <span class="co">## get stable age distribution</span></span>
<span>  <span class="va">n_R0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html">solve</a></span><span class="op">(</span><span class="va">aging</span>,<span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">births_ages</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">29</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="co">## get R0</span></span>
<span>  <span class="va">F_R0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">n_R0</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span><span class="va">beta_ages</span><span class="op">+</span><span class="va">aging</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">aging</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">V_R0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">gamma_ages</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">aging</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">R0</span><span class="op">[</span><span class="va">ii</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/complex.html">Re</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/eigen.html">eigen</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/solve.html">solve</a></span><span class="op">(</span><span class="va">V_R0</span>,<span class="va">F_R0</span><span class="op">)</span>,only.values<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">$</span><span class="va">values</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="co"># R0 = 6.53</span></span>
<span>  <span class="va">infects_R0</span> <span class="op">&lt;-</span> <span class="va">sol_R0</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">sol_R0</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,<span class="fl">1</span><span class="op">+</span><span class="va">iindex</span><span class="op">]</span></span>
<span>  <span class="va">mean_age</span><span class="op">[</span><span class="va">ii</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">ages</span> <span class="op">*</span> <span class="va">infects_R0</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">infects_R0</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">sum_cases</span><span class="op">[</span><span class="va">ii</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">infects_R0</span><span class="op">[</span><span class="fl">15</span><span class="op">:</span><span class="fl">23</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we can make a table of the results and plot mean age and the sum of cases between 15-35 years of age as a function of <span class="math inline">\(R_0\)</span>.</p>
<div class="cell">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>R0 <span class="op">=</span> <span class="va">R0</span>, <span class="st">"mean age"</span> <span class="op">=</span> <span class="va">mean_age</span>, <span class="st">"cases (15-35y)"</span> <span class="op">=</span> <span class="va">sum_cases</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<thead><tr class="header">
<th style="text-align: right;">R0</th>
<th style="text-align: right;">mean.age</th>
<th style="text-align: right;">cases..15.35y.</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1.349005</td>
<td style="text-align: right;">29.720681</td>
<td style="text-align: right;">1.4792882</td>
</tr>
<tr class="even">
<td style="text-align: right;">1.923933</td>
<td style="text-align: right;">21.497318</td>
<td style="text-align: right;">2.1148202</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2.499068</td>
<td style="text-align: right;">16.404292</td>
<td style="text-align: right;">2.0147559</td>
</tr>
<tr class="even">
<td style="text-align: right;">3.074291</td>
<td style="text-align: right;">13.105915</td>
<td style="text-align: right;">1.7387261</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3.649562</td>
<td style="text-align: right;">10.871071</td>
<td style="text-align: right;">1.4511558</td>
</tr>
<tr class="even">
<td style="text-align: right;">4.224859</td>
<td style="text-align: right;">9.295660</td>
<td style="text-align: right;">1.1960211</td>
</tr>
<tr class="odd">
<td style="text-align: right;">4.800174</td>
<td style="text-align: right;">8.145710</td>
<td style="text-align: right;">0.9815663</td>
</tr>
<tr class="even">
<td style="text-align: right;">5.375501</td>
<td style="text-align: right;">7.279760</td>
<td style="text-align: right;">0.8051295</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5.950836</td>
<td style="text-align: right;">6.609149</td>
<td style="text-align: right;">0.6612108</td>
</tr>
<tr class="even">
<td style="text-align: right;">6.526177</td>
<td style="text-align: right;">6.076599</td>
<td style="text-align: right;">0.5441408</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">R0</span>,<span class="va">mean_age</span>,xlab<span class="op">=</span><span class="st">"R0"</span>,ylab<span class="op">=</span><span class="st">"mean age of infection"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">R0</span>,<span class="va">sum_cases</span>,xlab<span class="op">=</span><span class="st">"R0"</span>,ylab<span class="op">=</span><span class="st">"total cases between 15-35y"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="r-session-02_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">

</div>
<section id="exercise-5-try-the-same-as-you-fix-r_0-but-change-the-birth-rate-as-if-new-infants-were-vaccinated-instead-of-changing-the-contact-rate." class="level3"><h3 class="anchored" data-anchor-id="exercise-5-try-the-same-as-you-fix-r_0-but-change-the-birth-rate-as-if-new-infants-were-vaccinated-instead-of-changing-the-contact-rate.">Exercise 5: Try the same as you fix <span class="math inline">\(R_0\)</span> but change the birth rate (as if new infants were vaccinated), instead of changing the contact rate.</h3>
<p>For example, if the birth rate was 100 before, try using a sequence of birth rates ranging from 100 (i.e.&nbsp;no new infants are vaccinated) to 75 (i.e., 25% of new infants are vaccinated). You can use the technique we used above, where we ran the simulation in a loop multiple times, for varying levels of contact, modifying it to run on varying levels of births (e.g., between 75 and 100).</p>
<div class="cell">

</div>
<div class="cell">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>births <span class="op">=</span> <span class="va">births_seq</span>, R0 <span class="op">=</span> <span class="va">R0_b</span>, <span class="st">"mean age"</span> <span class="op">=</span> <span class="va">mean_age_b</span>, </span>
<span>                 <span class="st">"cases (15-35y)"</span> <span class="op">=</span> <span class="va">sum_cases_b</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<thead><tr class="header">
<th style="text-align: right;">births</th>
<th style="text-align: right;">R0</th>
<th style="text-align: right;">mean.age</th>
<th style="text-align: right;">cases..15.35y.</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">75.00000</td>
<td style="text-align: right;">4.908047</td>
<td style="text-align: right;">7.964942</td>
<td style="text-align: right;">0.7093049</td>
</tr>
<tr class="even">
<td style="text-align: right;">77.77778</td>
<td style="text-align: right;">5.087836</td>
<td style="text-align: right;">7.683702</td>
<td style="text-align: right;">0.6913806</td>
</tr>
<tr class="odd">
<td style="text-align: right;">80.55556</td>
<td style="text-align: right;">5.267626</td>
<td style="text-align: right;">7.425096</td>
<td style="text-align: right;">0.6730883</td>
</tr>
<tr class="even">
<td style="text-align: right;">83.33333</td>
<td style="text-align: right;">5.447417</td>
<td style="text-align: right;">7.186665</td>
<td style="text-align: right;">0.6545678</td>
</tr>
<tr class="odd">
<td style="text-align: right;">86.11111</td>
<td style="text-align: right;">5.627209</td>
<td style="text-align: right;">6.966264</td>
<td style="text-align: right;">0.6359377</td>
</tr>
<tr class="even">
<td style="text-align: right;">88.88889</td>
<td style="text-align: right;">5.807001</td>
<td style="text-align: right;">6.762021</td>
<td style="text-align: right;">0.6172979</td>
</tr>
<tr class="odd">
<td style="text-align: right;">91.66667</td>
<td style="text-align: right;">5.986794</td>
<td style="text-align: right;">6.572292</td>
<td style="text-align: right;">0.5987331</td>
</tr>
<tr class="even">
<td style="text-align: right;">94.44444</td>
<td style="text-align: right;">6.166588</td>
<td style="text-align: right;">6.395635</td>
<td style="text-align: right;">0.5803142</td>
</tr>
<tr class="odd">
<td style="text-align: right;">97.22222</td>
<td style="text-align: right;">6.346382</td>
<td style="text-align: right;">6.230778</td>
<td style="text-align: right;">0.5621003</td>
</tr>
<tr class="even">
<td style="text-align: right;">100.00000</td>
<td style="text-align: right;">6.526177</td>
<td style="text-align: right;">6.076599</td>
<td style="text-align: right;">0.5441408</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">births_seq</span>,<span class="va">mean_age_b</span>,xlab<span class="op">=</span><span class="st">"births"</span>,ylab<span class="op">=</span><span class="st">"mean age of infection"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">births_seq</span>,<span class="va">sum_cases_b</span>,xlab<span class="op">=</span><span class="st">"births"</span>,ylab<span class="op">=</span><span class="st">"total cases between 15-35y"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="r-session-02_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#plot(births_seq,R0_b,xlab="births",ylab="R0")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="what-do-real-contact-networks-look-like" class="level2"><h2 class="anchored" data-anchor-id="what-do-real-contact-networks-look-like">What do real contact networks look like?</h2>
<p>The POLYMOD study <strong>Mossong, 2008</strong> was a journal-based look into the contact network in contemporary European society. Let’s have a look what these data tell us about the contact structure.</p>
<div class="cell">
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">moss</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span></span>
<span>                 <span class="fu"><a href="https://rdrr.io/r/base/connections.html">url</a></span><span class="op">(</span><span class="st">"http://www.math.mcmaster.ca/~bolker/eeid/data/mossong.csv"</span><span class="op">)</span>,</span>
<span>                 as.is<span class="op">=</span><span class="cn">TRUE</span></span>
<span>                 <span class="op">)</span></span>
<span><span class="va">age.categories</span> <span class="op">&lt;-</span> <span class="va">moss</span><span class="op">$</span><span class="va">contactor</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">30</span><span class="op">]</span></span>
<span><span class="va">moss</span><span class="op">$</span><span class="va">contactor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">ordered</a></span><span class="op">(</span><span class="va">moss</span><span class="op">$</span><span class="va">contactor</span>,levels<span class="op">=</span><span class="va">age.categories</span><span class="op">)</span></span>
<span><span class="va">moss</span><span class="op">$</span><span class="va">contactee</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">ordered</a></span><span class="op">(</span><span class="va">moss</span><span class="op">$</span><span class="va">contactee</span>,levels<span class="op">=</span><span class="va">age.categories</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Since contacts are symmetric, we’ll need to estimate the symmetric contact matrix.</p>
<div class="cell">
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">x1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span></span>
<span>           <span class="va">moss</span>,</span>
<span>           <span class="fu"><a href="https://rdrr.io/r/base/tapply.html">tapply</a></span><span class="op">(</span><span class="va">contact.rate</span>,<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">contactor</span>,<span class="va">contactee</span><span class="op">)</span>,<span class="va">unique</span><span class="op">)</span></span>
<span>           <span class="op">)</span></span>
<span><span class="va">xsym</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">x1</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">x1</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/filled.contour.html">filled.contour</a></span><span class="op">(</span><span class="va">ages</span>,<span class="va">ages</span>,<span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="va">xsym</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/filled.contour.html">filled.contour</a></span><span class="op">(</span></span>
<span>               <span class="va">ages</span>,<span class="va">ages</span>,<span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="va">xsym</span><span class="op">)</span>,</span>
<span>               plot.title<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html">title</a></span><span class="op">(</span></span>
<span>                 main<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/substitute.html">quote</a></span><span class="op">(</span><span class="va">log</span><span class="op">[</span><span class="fl">10</span><span class="op">]</span><span class="op">(</span><span class="va">contact</span><span class="op">~</span><span class="va">rate</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                 xlab<span class="op">=</span><span class="st">"age"</span>,ylab<span class="op">=</span><span class="st">"age"</span><span class="op">)</span></span>
<span>               <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html">barplot</a></span><span class="op">(</span>height<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">x1</span>,<span class="fl">1</span>,<span class="va">sum</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html">barplot</a></span><span class="op">(</span>height<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">x1</span>,<span class="fl">2</span>,<span class="va">sum</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>While this matrix tells us how many contacts are made per year by an individual of each age, it doesn’t tell us anything about the probability that a contact results in communication of infection. Let’s assume that each contact has a constant probability <span class="math inline">\(q\)</span> of resulting in a transmission event.</p>
<div class="cell">
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">q</span> <span class="op">&lt;-</span> <span class="fl">3e-5</span></span>
<span><span class="va">beta_ages</span> <span class="op">&lt;-</span> <span class="va">q</span><span class="op">*</span><span class="va">xsym</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/filled.contour.html">filled.contour</a></span><span class="op">(</span><span class="va">ages</span>,<span class="va">ages</span>,<span class="fu"><a href="https://rdrr.io/r/base/Log.html">log10</a></span><span class="op">(</span><span class="va">beta_ages</span><span class="op">)</span>,                </span>
<span>               plot.title<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html">title</a></span><span class="op">(</span></span>
<span>                 main<span class="op">=</span><span class="st">"WAIFW matrix based on POLYMOD data"</span>,</span>
<span>                 xlab<span class="op">=</span><span class="st">"age"</span>,ylab<span class="op">=</span><span class="st">"age"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="r-session-02_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Now let’s simulate the introduction of such a pathogen into a population characterized by this contact structure.</p>
<div class="cell">
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">sol_p</span> <span class="op">&lt;-</span> <span class="fu">deSolve</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/deSolve/man/ode.html">ode</a></span><span class="op">(</span></span>
<span>           y<span class="op">=</span><span class="va">yinit_ages</span>,</span>
<span>           times<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">200</span>,by<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span>,</span>
<span>           func<span class="op">=</span><span class="va">ja.multistage.model</span>,</span>
<span>           parms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>beta_ages<span class="op">=</span><span class="va">beta_ages</span>, aging<span class="op">=</span><span class="va">aging</span>, births<span class="op">=</span><span class="va">births_ages</span><span class="op">)</span></span>
<span>           <span class="op">)</span></span>
<span></span>
<span><span class="va">time</span> <span class="op">&lt;-</span> <span class="va">sol_p</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">infects_p</span> <span class="op">&lt;-</span> <span class="va">sol_p</span><span class="op">[</span>,<span class="fl">1</span><span class="op">+</span><span class="va">iindex</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">time</span>,<span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">infects_p</span>,<span class="fl">1</span>,<span class="va">sum</span><span class="op">)</span>,type<span class="op">=</span><span class="st">'l'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">time</span>,<span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">infects_p</span><span class="op">[</span>,<span class="va">juvies</span><span class="op">]</span>,<span class="fl">1</span>,<span class="va">sum</span><span class="op">)</span>,col<span class="op">=</span><span class="st">'red'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span><span class="op">(</span><span class="va">time</span>,<span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">infects_p</span><span class="op">[</span>,<span class="va">adults</span><span class="op">]</span>,<span class="fl">1</span>,<span class="va">sum</span><span class="op">)</span>,col<span class="op">=</span><span class="st">'blue'</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As before, we can also look at the equilibrium seroprevalence</p>
<div class="cell">
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">equil_p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/drop.html">drop</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">tail</a></span><span class="op">(</span><span class="va">sol_p</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">n_p</span> <span class="op">&lt;-</span> <span class="va">equil_p</span><span class="op">[</span><span class="va">sindex</span><span class="op">]</span><span class="op">+</span><span class="va">equil_p</span><span class="op">[</span><span class="va">iindex</span><span class="op">]</span><span class="op">+</span><span class="va">equil_p</span><span class="op">[</span><span class="va">rindex</span><span class="op">]</span></span>
<span><span class="va">seroprev_p</span> <span class="op">&lt;-</span> <span class="va">equil_p</span><span class="op">[</span><span class="va">rindex</span><span class="op">]</span><span class="op">/</span><span class="va">n_p</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">seroprev_p</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">ages</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html">barplot</a></span><span class="op">(</span>height<span class="op">=</span><span class="va">seroprev_p</span>,width<span class="op">=</span><span class="va">da_ages</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>and compute the <span class="math inline">\(R_0\)</span> for this infection.</p>
<div class="cell">
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">n_p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html">solve</a></span><span class="op">(</span><span class="va">aging</span>,<span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">births_ages</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">29</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">F_p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">n_p</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span><span class="va">beta_ages</span><span class="op">+</span><span class="va">aging</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">aging</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">V_p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">gamma_ages</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">aging</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/complex.html">Re</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/eigen.html">eigen</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/solve.html">solve</a></span><span class="op">(</span><span class="va">V_p</span>,<span class="va">F_p</span><span class="op">)</span>,only.values<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">$</span><span class="va">values</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>How does this R0 value compare to the R0 value obtained from Exercise 4?</p>
<div class="cell">

</div>
</section><section id="bonus-calculating-r0-using-a-next-generation-matrix" class="level2"><h2 class="anchored" data-anchor-id="bonus-calculating-r0-using-a-next-generation-matrix">Bonus: Calculating R0 Using a Next Generation Matrix</h2>
<p>The next generation matrix is a matrix that specifies how many new age-specific infections are generated by a typical infected individual of each age class (in a fully susceptible population). For example, let’s consider an infected adult and ask how many new juvenile infections it generates: this is the product of the number of susceptible juveniles (from the stable age distribution), the per capita transmission rate from adults to juveniles and the average duration of infection, i.e.&nbsp;<span class="math inline">\(S_J^* \times \beta_{JA} \times 1/ (\gamma+\mu)\)</span>. This forms one element of our next generation matrix. The other elements look very similar, except there are extra terms when we consider an infected juvenile because there is a (very small) chance they may age during the infectious period and therefore cause new infections as an adult: <span class="math display">\[
\mathrm{NGM} = \left(
  \begin{matrix}
    \frac{S_J^* \beta_{JJ} }{(\gamma+\alpha)} +\frac{\alpha}{(\gamma+\mu)}\frac{S_J^*\beta_{JA}}{(\gamma+\mu)} &amp;  
    \frac{S_J^* \beta_{JA}}{(\gamma+\mu)} \\
    \frac{S_A^* \beta_{AJ} }{(\gamma+\alpha)} +\frac{\alpha}{(\gamma+\mu)}\frac{S_A^*\beta_{AA}}{(\gamma+\mu)} &amp;  \frac{S_A^* \beta_{AA}}{(\gamma+\mu)}
  \end{matrix}
\right)
\]</span></p>
<p><span class="math inline">\(R_0\)</span> can then be computed as the dominant eigenvalue (i.e., the one with the largest real part) of this matrix. Let’s take an example from a model with 2 age classes, from above. First, let’s define the components of the next generation matrix:</p>
<div class="cell">
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">da_ngm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">20</span>,<span class="fl">60</span><span class="op">)</span> <span class="co"># this classifies the two age groups (0-20, 21-60) </span></span>
<span><span class="va">b1_ngm</span> <span class="op">=</span> <span class="fl">0.005</span></span>
<span><span class="va">b2_ngm</span> <span class="op">=</span> <span class="fl">0.006</span></span>
<span><span class="va">alpha_ngm</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="va">da_ngm</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">mu_ngm</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="va">da_ngm</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">n_ngm</span> <span class="op">&lt;-</span> <span class="va">births_demog</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">alpha_ngm</span>,<span class="va">mu_ngm</span><span class="op">)</span></span>
<span><span class="va">beta_ngm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">b1_ngm</span><span class="op">+</span><span class="va">b2_ngm</span>,<span class="va">b1_ngm</span>,<span class="va">b1_ngm</span>,<span class="va">b1_ngm</span><span class="op">+</span><span class="va">b2_ngm</span><span class="op">)</span>,nrow<span class="op">=</span><span class="fl">2</span>,ncol<span class="op">=</span><span class="fl">2</span><span class="op">)</span> </span>
<span><span class="va">gamma_ngm</span> <span class="op">=</span> <span class="fl">10</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The Next Generation Matrix can be calculated in <strong>R</strong> as:</p>
<div class="cell">
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ngm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span></span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>                <span class="va">n_ngm</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="va">beta_ngm</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">]</span><span class="op">/</span><span class="op">(</span><span class="va">gamma_ngm</span><span class="op">+</span><span class="va">alpha_ngm</span><span class="op">)</span><span class="op">+</span></span>
<span>                  <span class="va">alpha_ngm</span><span class="op">/</span><span class="op">(</span><span class="va">gamma_ngm</span><span class="op">+</span><span class="va">mu_ngm</span><span class="op">)</span><span class="op">*</span><span class="va">n</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="va">beta_ngm</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span><span class="op">/</span><span class="op">(</span><span class="va">gamma_ngm</span><span class="op">+</span><span class="va">mu_ngm</span><span class="op">)</span>,</span>
<span>                <span class="va">n_ngm</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">*</span><span class="va">beta_ngm</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">]</span><span class="op">/</span><span class="op">(</span><span class="va">gamma_ngm</span><span class="op">+</span><span class="va">alpha_ngm</span><span class="op">)</span><span class="op">+</span></span>
<span>                  <span class="va">alpha_ngm</span><span class="op">/</span><span class="op">(</span><span class="va">gamma_ngm</span><span class="op">+</span><span class="va">mu_ngm</span><span class="op">)</span><span class="op">*</span><span class="va">n</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">*</span><span class="va">beta_ngm</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">]</span><span class="op">/</span><span class="op">(</span><span class="va">gamma_ngm</span><span class="op">+</span><span class="va">mu_ngm</span><span class="op">)</span>,</span>
<span>                <span class="va">n_ngm</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="va">beta_ngm</span><span class="op">[</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">]</span><span class="op">/</span><span class="op">(</span><span class="va">gamma_ngm</span><span class="op">+</span><span class="va">mu_ngm</span><span class="op">)</span>,</span>
<span>                <span class="va">n_ngm</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">*</span><span class="va">beta_ngm</span><span class="op">[</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">]</span><span class="op">/</span><span class="op">(</span><span class="va">gamma_ngm</span><span class="op">+</span><span class="va">mu_ngm</span><span class="op">)</span></span>
<span>                <span class="op">)</span>,</span>
<span>              nrow<span class="op">=</span><span class="fl">2</span>,</span>
<span>              ncol<span class="op">=</span><span class="fl">2</span></span>
<span>              <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/eigen.html">eigen</a></span><span class="op">(</span><span class="va">ngm</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>eigen() decomposition
$values
[1] 7.185592 1.592730

$vectors
           [,1]       [,2]
[1,] -0.1959422 -0.8584125
[2,] -0.9806154  0.5129600</code></pre>
</div>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/eigen.html">eigen</a></span><span class="op">(</span><span class="va">ngm</span>,only.values<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$values
[1] 7.185592 1.592730

$vectors
NULL</code></pre>
</div>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/complex.html">Re</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/eigen.html">eigen</a></span><span class="op">(</span><span class="va">ngm</span>,only.values<span class="op">=</span><span class="cn">T</span><span class="op">)</span><span class="op">$</span><span class="va">values</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 7.185592</code></pre>
</div>
</div>


<!-- -->

</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./r-session-01.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">R Session 01</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./r-session-03.html" class="pagination-link">
        <span class="nav-page-text">R Session 03</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb49" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "Heterogeneity and Age Structure in SIR Models"</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="co">    - name: Matthew Ferrari</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="co">      url: http://theferrarilab.com</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="co">      affiliation: Pennsylvania State University</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="co">      orcid: 0000-0001-5251-8168</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a><span class="co">    - name: Callum Arnold-Leps</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a><span class="co">      url: https://callumarnold.com</span></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a><span class="co">      affiliation: Pennsylvania State University</span></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a><span class="co">      orcid: 0000-0002-3245-6956</span></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a><span class="an">abstract-title:</span><span class="co"> ""</span></span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a><span class="an">abstract:</span><span class="co"> |</span></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a><span class="co">    *Materials adapted from Helen Wearing and Aaron King*</span></span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span></span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a><span class="co">    warning: false</span></span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a><span class="fu"># R Session 02 {.unnumbered}</span></span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(diagram)</span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(deSolve)</span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-27"><a href="#cb49-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-28"><a href="#cb49-28" aria-hidden="true" tabindex="-1"></a><span class="fu">## A Model With 2 Classes</span></span>
<span id="cb49-29"><a href="#cb49-29" aria-hidden="true" tabindex="-1"></a>We'll start with the simplest mechanistic model of two classes we can think of, which has separate classes for two groups $a$ and $b$. These groups could represent different socioeconomic classes, for example.</span>
<span id="cb49-30"><a href="#cb49-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-33"><a href="#cb49-33" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb49-34"><a href="#cb49-34" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb49-35"><a href="#cb49-35" aria-hidden="true" tabindex="-1"></a>elpos <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb49-36"><a href="#cb49-36" aria-hidden="true" tabindex="-1"></a>               <span class="at">Sa=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>),</span>
<span id="cb49-37"><a href="#cb49-37" aria-hidden="true" tabindex="-1"></a>               <span class="at">Sb=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">3</span>),</span>
<span id="cb49-38"><a href="#cb49-38" aria-hidden="true" tabindex="-1"></a>               <span class="at">Ia=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>),</span>
<span id="cb49-39"><a href="#cb49-39" aria-hidden="true" tabindex="-1"></a>               <span class="at">Ib=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">2</span>),</span>
<span id="cb49-40"><a href="#cb49-40" aria-hidden="true" tabindex="-1"></a>               <span class="at">Ra=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>),</span>
<span id="cb49-41"><a href="#cb49-41" aria-hidden="true" tabindex="-1"></a>               <span class="at">Rb=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">1</span>)</span>
<span id="cb49-42"><a href="#cb49-42" aria-hidden="true" tabindex="-1"></a>               )</span>
<span id="cb49-43"><a href="#cb49-43" aria-hidden="true" tabindex="-1"></a>elpos[,<span class="dv">1</span>] <span class="ot">&lt;-</span> (<span class="dv">2</span><span class="sc">*</span>elpos[,<span class="dv">1</span>]<span class="sc">-</span><span class="dv">1</span>)<span class="sc">/</span><span class="dv">8</span></span>
<span id="cb49-44"><a href="#cb49-44" aria-hidden="true" tabindex="-1"></a>elpos[,<span class="dv">2</span>] <span class="ot">&lt;-</span> (<span class="dv">2</span><span class="sc">*</span>elpos[,<span class="dv">2</span>]<span class="sc">-</span><span class="dv">1</span>)<span class="sc">/</span><span class="dv">6</span></span>
<span id="cb49-45"><a href="#cb49-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-46"><a href="#cb49-46" aria-hidden="true" tabindex="-1"></a>fromto <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb49-47"><a href="#cb49-47" aria-hidden="true" tabindex="-1"></a>                <span class="at">SaIa=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>),</span>
<span id="cb49-48"><a href="#cb49-48" aria-hidden="true" tabindex="-1"></a>                <span class="at">SbIb=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">4</span>),</span>
<span id="cb49-49"><a href="#cb49-49" aria-hidden="true" tabindex="-1"></a>                <span class="at">IaRa=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>),</span>
<span id="cb49-50"><a href="#cb49-50" aria-hidden="true" tabindex="-1"></a>                <span class="at">IbRb=</span><span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">6</span>)</span>
<span id="cb49-51"><a href="#cb49-51" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb49-52"><a href="#cb49-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-53"><a href="#cb49-53" aria-hidden="true" tabindex="-1"></a>op <span class="ot">&lt;-</span> <span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb49-54"><a href="#cb49-54" aria-hidden="true" tabindex="-1"></a>diagram<span class="sc">::</span><span class="fu">openplotmat</span>(<span class="at">asp=</span><span class="fl">0.9</span>)</span>
<span id="cb49-55"><a href="#cb49-55" aria-hidden="true" tabindex="-1"></a>arrpos <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">ncol=</span><span class="dv">2</span>,<span class="at">nrow=</span><span class="fu">nrow</span>(fromto))</span>
<span id="cb49-56"><a href="#cb49-56" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(fromto))){</span>
<span id="cb49-57"><a href="#cb49-57" aria-hidden="true" tabindex="-1"></a>  arrpos[i,] <span class="ot">&lt;-</span> diagram<span class="sc">::</span><span class="fu">straightarrow</span>(</span>
<span id="cb49-58"><a href="#cb49-58" aria-hidden="true" tabindex="-1"></a>                              <span class="at">to=</span>elpos[fromto[i,<span class="dv">2</span>],],</span>
<span id="cb49-59"><a href="#cb49-59" aria-hidden="true" tabindex="-1"></a>                              <span class="at">from=</span>elpos[fromto[i,<span class="dv">1</span>],],</span>
<span id="cb49-60"><a href="#cb49-60" aria-hidden="true" tabindex="-1"></a>                              <span class="at">lwd=</span><span class="dv">2</span>,</span>
<span id="cb49-61"><a href="#cb49-61" aria-hidden="true" tabindex="-1"></a>                              <span class="at">arr.pos=</span><span class="fl">0.65</span>,</span>
<span id="cb49-62"><a href="#cb49-62" aria-hidden="true" tabindex="-1"></a>                              <span class="at">arr.length=</span><span class="fl">0.5</span></span>
<span id="cb49-63"><a href="#cb49-63" aria-hidden="true" tabindex="-1"></a>                              )}</span>
<span id="cb49-64"><a href="#cb49-64" aria-hidden="true" tabindex="-1"></a>diagram<span class="sc">::</span><span class="fu">textrect</span>(elpos[<span class="st">"Sa"</span>,],<span class="fl">0.07</span>,<span class="fl">0.07</span>,<span class="at">lab=</span><span class="st">"Sa"</span>,<span class="at">box.col=</span><span class="fu">gray</span>(<span class="fl">0.7</span>),<span class="at">shadow.col=</span><span class="fu">gray</span>(<span class="fl">0.4</span>),<span class="at">shadow.size=</span><span class="fl">0.01</span>,<span class="at">cex=</span><span class="dv">2</span>)</span>
<span id="cb49-65"><a href="#cb49-65" aria-hidden="true" tabindex="-1"></a>diagram<span class="sc">::</span><span class="fu">textrect</span>(elpos[<span class="st">"Sb"</span>,],<span class="fl">0.07</span>,<span class="fl">0.07</span>,<span class="at">lab=</span><span class="st">"Sb"</span>,<span class="at">box.col=</span><span class="fu">gray</span>(<span class="fl">0.7</span>),<span class="at">shadow.col=</span><span class="fu">gray</span>(<span class="fl">0.4</span>),<span class="at">shadow.size=</span><span class="fl">0.01</span>,<span class="at">cex=</span><span class="dv">2</span>)</span>
<span id="cb49-66"><a href="#cb49-66" aria-hidden="true" tabindex="-1"></a>diagram<span class="sc">::</span><span class="fu">textrect</span>(elpos[<span class="st">"Ia"</span>,],<span class="fl">0.07</span>,<span class="fl">0.07</span>,<span class="at">lab=</span><span class="st">"Ia"</span>,<span class="at">box.col=</span><span class="fu">gray</span>(<span class="fl">0.7</span>),<span class="at">shadow.col=</span><span class="fu">gray</span>(<span class="fl">0.4</span>),<span class="at">shadow.size=</span><span class="fl">0.01</span>,<span class="at">cex=</span><span class="dv">2</span>)</span>
<span id="cb49-67"><a href="#cb49-67" aria-hidden="true" tabindex="-1"></a>diagram<span class="sc">::</span><span class="fu">textrect</span>(elpos[<span class="st">"Ib"</span>,],<span class="fl">0.07</span>,<span class="fl">0.07</span>,<span class="at">lab=</span><span class="st">"Ib"</span>,<span class="at">box.col=</span><span class="fu">gray</span>(<span class="fl">0.7</span>),<span class="at">shadow.col=</span><span class="fu">gray</span>(<span class="fl">0.4</span>),<span class="at">shadow.size=</span><span class="fl">0.01</span>,<span class="at">cex=</span><span class="dv">2</span>)</span>
<span id="cb49-68"><a href="#cb49-68" aria-hidden="true" tabindex="-1"></a>diagram<span class="sc">::</span><span class="fu">textrect</span>(elpos[<span class="st">"Ra"</span>,],<span class="fl">0.07</span>,<span class="fl">0.07</span>,<span class="at">lab=</span><span class="st">"Ra"</span>,<span class="at">box.col=</span><span class="fu">gray</span>(<span class="fl">0.7</span>),<span class="at">shadow.col=</span><span class="fu">gray</span>(<span class="fl">0.4</span>),<span class="at">shadow.size=</span><span class="fl">0.01</span>,<span class="at">cex=</span><span class="dv">2</span>)</span>
<span id="cb49-69"><a href="#cb49-69" aria-hidden="true" tabindex="-1"></a>diagram<span class="sc">::</span><span class="fu">textrect</span>(elpos[<span class="st">"Rb"</span>,],<span class="fl">0.07</span>,<span class="fl">0.07</span>,<span class="at">lab=</span><span class="st">"Rb"</span>,<span class="at">box.col=</span><span class="fu">gray</span>(<span class="fl">0.7</span>),<span class="at">shadow.col=</span><span class="fu">gray</span>(<span class="fl">0.4</span>),<span class="at">shadow.size=</span><span class="fl">0.01</span>,<span class="at">cex=</span><span class="dv">2</span>)</span>
<span id="cb49-70"><a href="#cb49-70" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(arrpos[<span class="dv">1</span>,<span class="dv">1</span>]<span class="sc">-</span><span class="fl">0.05</span>,<span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>,<span class="fu">quote</span>(lambda[a]),<span class="at">cex=</span><span class="dv">2</span>)</span>
<span id="cb49-71"><a href="#cb49-71" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(arrpos[<span class="dv">2</span>,<span class="dv">1</span>]<span class="sc">+</span><span class="fl">0.05</span>,<span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>,<span class="fu">quote</span>(lambda[b]),<span class="at">cex=</span><span class="dv">2</span>)</span>
<span id="cb49-72"><a href="#cb49-72" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(arrpos[<span class="dv">3</span>,<span class="dv">1</span>]<span class="sc">-</span><span class="fl">0.05</span>,<span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>,<span class="fu">quote</span>(gamma[a]),<span class="at">cex=</span><span class="dv">2</span>)</span>
<span id="cb49-73"><a href="#cb49-73" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(arrpos[<span class="dv">4</span>,<span class="dv">1</span>]<span class="sc">+</span><span class="fl">0.05</span>,<span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>,<span class="fu">quote</span>(gamma[b]),<span class="at">cex=</span><span class="dv">2</span>)</span>
<span id="cb49-74"><a href="#cb49-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-75"><a href="#cb49-75" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(op)</span>
<span id="cb49-76"><a href="#cb49-76" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-77"><a href="#cb49-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-78"><a href="#cb49-78" aria-hidden="true" tabindex="-1"></a>Which can be written in equations as,</span>
<span id="cb49-79"><a href="#cb49-79" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb49-80"><a href="#cb49-80" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb49-81"><a href="#cb49-81" aria-hidden="true" tabindex="-1"></a>    \frac{dS_a}{dt} &amp;= -\lambda_a\,S_a \phantom{-\gamma\,I_b}<span class="sc">\\</span></span>
<span id="cb49-82"><a href="#cb49-82" aria-hidden="true" tabindex="-1"></a>    \frac{dS_b}{dt} &amp;= -\lambda_b\,S_b \phantom{-\gamma\,I_b}<span class="sc">\\</span></span>
<span id="cb49-83"><a href="#cb49-83" aria-hidden="true" tabindex="-1"></a>    \frac{dI_a}{dt} &amp;= \phantom{-}\lambda_a\,S_a -\gamma\,I_a<span class="sc">\\</span></span>
<span id="cb49-84"><a href="#cb49-84" aria-hidden="true" tabindex="-1"></a>    \frac{dI_b}{dt} &amp;= \phantom{-}\lambda_b\,S_b-\gamma\,I_b<span class="sc">\\</span></span>
<span id="cb49-85"><a href="#cb49-85" aria-hidden="true" tabindex="-1"></a>    \frac{dR_a}{dt} &amp;= \phantom{-\lambda_a\,S_b}+\gamma\,I_a<span class="sc">\\</span></span>
<span id="cb49-86"><a href="#cb49-86" aria-hidden="true" tabindex="-1"></a>    \frac{dR_b}{dt} &amp;= \phantom{-\lambda_a\,S_b}+\gamma\,I_b<span class="sc">\\</span></span>
<span id="cb49-87"><a href="#cb49-87" aria-hidden="true" tabindex="-1"></a>  \end{aligned}</span>
<span id="cb49-88"><a href="#cb49-88" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb49-89"><a href="#cb49-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-90"><a href="#cb49-90" aria-hidden="true" tabindex="-1"></a>The $\lambda$s denote the group-specific force of infections:</span>
<span id="cb49-91"><a href="#cb49-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-92"><a href="#cb49-92" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb49-93"><a href="#cb49-93" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb49-94"><a href="#cb49-94" aria-hidden="true" tabindex="-1"></a>        \lambda_a &amp;= \beta_{aa}\,I_a+\beta_{ab}\,I_b<span class="sc">\\</span></span>
<span id="cb49-95"><a href="#cb49-95" aria-hidden="true" tabindex="-1"></a>        \lambda_b &amp;= \beta_{ba}\,I_a+\beta_{bb}\,I_b</span>
<span id="cb49-96"><a href="#cb49-96" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb49-97"><a href="#cb49-97" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb49-98"><a href="#cb49-98" aria-hidden="true" tabindex="-1"></a>In this model, each population can infect each other but the infection moves through the populations separately.</span>
<span id="cb49-99"><a href="#cb49-99" aria-hidden="true" tabindex="-1"></a>Let's simulate such a model.</span>
<span id="cb49-100"><a href="#cb49-100" aria-hidden="true" tabindex="-1"></a>To make things concrete, we'll assume that the transmission rates $\beta$ are greater within groups than between them.</span>
<span id="cb49-101"><a href="#cb49-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-104"><a href="#cb49-104" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb49-105"><a href="#cb49-105" aria-hidden="true" tabindex="-1"></a>b1 <span class="ot">&lt;-</span> <span class="fl">0.005</span></span>
<span id="cb49-106"><a href="#cb49-106" aria-hidden="true" tabindex="-1"></a>b2 <span class="ot">&lt;-</span> <span class="fl">0.02</span></span>
<span id="cb49-107"><a href="#cb49-107" aria-hidden="true" tabindex="-1"></a>gamma <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb49-108"><a href="#cb49-108" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-109"><a href="#cb49-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-112"><a href="#cb49-112" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb49-113"><a href="#cb49-113" aria-hidden="true" tabindex="-1"></a><span class="co"># Here we set up the ODE model that matches the equations above</span></span>
<span id="cb49-114"><a href="#cb49-114" aria-hidden="true" tabindex="-1"></a>ba.model <span class="ot">&lt;-</span> <span class="cf">function</span> (t, x, ...) {     </span>
<span id="cb49-115"><a href="#cb49-115" aria-hidden="true" tabindex="-1"></a>  s <span class="ot">&lt;-</span> x[<span class="fu">c</span>(<span class="st">"Sb"</span>,<span class="st">"Sa"</span>)]                  <span class="co"># susceptibles</span></span>
<span id="cb49-116"><a href="#cb49-116" aria-hidden="true" tabindex="-1"></a>  i <span class="ot">&lt;-</span> x[<span class="fu">c</span>(<span class="st">"Ib"</span>,<span class="st">"Ia"</span>)]                  <span class="co"># infecteds</span></span>
<span id="cb49-117"><a href="#cb49-117" aria-hidden="true" tabindex="-1"></a>  r <span class="ot">&lt;-</span> x[<span class="fu">c</span>(<span class="st">"Rb"</span>,<span class="st">"Ra"</span>)]                  <span class="co"># recovereds</span></span>
<span id="cb49-118"><a href="#cb49-118" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> s<span class="sc">+</span>i<span class="sc">+</span>r                            <span class="co"># total pop</span></span>
<span id="cb49-119"><a href="#cb49-119" aria-hidden="true" tabindex="-1"></a>  lambda.b <span class="ot">&lt;-</span> (b1<span class="sc">+</span>b2)<span class="sc">*</span>i[<span class="dv">1</span>]<span class="sc">+</span>b1<span class="sc">*</span>i[<span class="dv">2</span>]      <span class="co"># group B force of infection</span></span>
<span id="cb49-120"><a href="#cb49-120" aria-hidden="true" tabindex="-1"></a>  lambda.a <span class="ot">&lt;-</span> b1<span class="sc">*</span>i[<span class="dv">1</span>]<span class="sc">+</span>(b1<span class="sc">+</span>b2)<span class="sc">*</span>i[<span class="dv">2</span>]      <span class="co"># group A force of infection</span></span>
<span id="cb49-121"><a href="#cb49-121" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb49-122"><a href="#cb49-122" aria-hidden="true" tabindex="-1"></a>       <span class="fu">c</span>(                               <span class="co"># these are the rates from the 6 equations above</span></span>
<span id="cb49-123"><a href="#cb49-123" aria-hidden="true" tabindex="-1"></a>         <span class="sc">-</span>lambda.b<span class="sc">*</span>s[<span class="dv">1</span>],</span>
<span id="cb49-124"><a href="#cb49-124" aria-hidden="true" tabindex="-1"></a>         <span class="sc">-</span>lambda.a<span class="sc">*</span>s[<span class="dv">2</span>],</span>
<span id="cb49-125"><a href="#cb49-125" aria-hidden="true" tabindex="-1"></a>          lambda.b<span class="sc">*</span>s[<span class="dv">1</span>]<span class="sc">-</span>gamma<span class="sc">*</span>i[<span class="dv">1</span>],</span>
<span id="cb49-126"><a href="#cb49-126" aria-hidden="true" tabindex="-1"></a>          lambda.a<span class="sc">*</span>s[<span class="dv">2</span>]<span class="sc">-</span>gamma<span class="sc">*</span>i[<span class="dv">2</span>],</span>
<span id="cb49-127"><a href="#cb49-127" aria-hidden="true" tabindex="-1"></a>                        gamma<span class="sc">*</span>i[<span class="dv">1</span>],</span>
<span id="cb49-128"><a href="#cb49-128" aria-hidden="true" tabindex="-1"></a>                        gamma<span class="sc">*</span>i[<span class="dv">2</span>]</span>
<span id="cb49-129"><a href="#cb49-129" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb49-130"><a href="#cb49-130" aria-hidden="true" tabindex="-1"></a>       )</span>
<span id="cb49-131"><a href="#cb49-131" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb49-132"><a href="#cb49-132" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-133"><a href="#cb49-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-134"><a href="#cb49-134" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=T, eval=TRUE, message=FALSE}</span></span>
<span id="cb49-135"><a href="#cb49-135" aria-hidden="true" tabindex="-1"></a><span class="do">## initial conditions</span></span>
<span id="cb49-136"><a href="#cb49-136" aria-hidden="true" tabindex="-1"></a>yinit <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">Sb=</span><span class="dv">2000</span>,<span class="at">Sa=</span><span class="dv">1000</span>,<span class="at">Ib=</span><span class="dv">1</span>,<span class="at">Ia=</span><span class="dv">1</span>,<span class="at">Rb=</span><span class="dv">0</span>,<span class="at">Ra=</span><span class="dv">0</span>) <span class="co"># set starting conditions</span></span>
<span id="cb49-137"><a href="#cb49-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-138"><a href="#cb49-138" aria-hidden="true" tabindex="-1"></a>sol_ba <span class="ot">&lt;-</span> deSolve<span class="sc">::</span><span class="fu">ode</span>(                          <span class="co"># run the ode solver on the model above</span></span>
<span id="cb49-139"><a href="#cb49-139" aria-hidden="true" tabindex="-1"></a>           <span class="at">y=</span>yinit,</span>
<span id="cb49-140"><a href="#cb49-140" aria-hidden="true" tabindex="-1"></a>           <span class="at">times=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">2</span>,<span class="at">by=</span><span class="fl">0.001</span>),</span>
<span id="cb49-141"><a href="#cb49-141" aria-hidden="true" tabindex="-1"></a>           <span class="at">func=</span>ba.model</span>
<span id="cb49-142"><a href="#cb49-142" aria-hidden="true" tabindex="-1"></a>           )</span>
<span id="cb49-143"><a href="#cb49-143" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-144"><a href="#cb49-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-145"><a href="#cb49-145" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=T, eval=FALSE, warning=FALSE}</span></span>
<span id="cb49-146"><a href="#cb49-146" aria-hidden="true" tabindex="-1"></a><span class="co"># this code will plot the resulting time series</span></span>
<span id="cb49-147"><a href="#cb49-147" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sol_ba, <span class="at">mfcol=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>))</span>
<span id="cb49-148"><a href="#cb49-148" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(sol_ba)</span>
<span id="cb49-149"><a href="#cb49-149" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sol_ba)</span>
<span id="cb49-150"><a href="#cb49-150" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sol_ba,<span class="at">log=</span><span class="st">'y'</span>, <span class="at">mfcol=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>))</span>
<span id="cb49-151"><a href="#cb49-151" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-152"><a href="#cb49-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-153"><a href="#cb49-153" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=F, eval=FALSE}</span></span>
<span id="cb49-154"><a href="#cb49-154" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sol_ba, <span class="at">mfcol=</span><span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>))</span>
<span id="cb49-155"><a href="#cb49-155" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfcol=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb49-156"><a href="#cb49-156" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-157"><a href="#cb49-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-158"><a href="#cb49-158" aria-hidden="true" tabindex="-1"></a>The results of the above are plotted below:</span>
<span id="cb49-159"><a href="#cb49-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-162"><a href="#cb49-162" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb49-163"><a href="#cb49-163" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the proportion of individuals in each state for the two groups</span></span>
<span id="cb49-164"><a href="#cb49-164" aria-hidden="true" tabindex="-1"></a>time <span class="ot">&lt;-</span> sol_ba[,<span class="dv">1</span>]                         <span class="co"># time</span></span>
<span id="cb49-165"><a href="#cb49-165" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> sol_ba[,<span class="sc">-</span><span class="dv">1</span>]                           <span class="co"># all other variables</span></span>
<span id="cb49-166"><a href="#cb49-166" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">apply</span>(y,<span class="dv">1</span>,sum)                     <span class="co"># population size</span></span>
<span id="cb49-167"><a href="#cb49-167" aria-hidden="true" tabindex="-1"></a>prop <span class="ot">&lt;-</span> y<span class="sc">/</span>n                             <span class="co"># fractions</span></span>
<span id="cb49-168"><a href="#cb49-168" aria-hidden="true" tabindex="-1"></a>subsampled.prop <span class="ot">&lt;-</span> prop[<span class="fu">seq</span>(<span class="dv">1</span>,<span class="fu">length</span>(time),<span class="at">by=</span><span class="dv">10</span>),]</span>
<span id="cb49-169"><a href="#cb49-169" aria-hidden="true" tabindex="-1"></a>subsampled.time <span class="ot">&lt;-</span> time[<span class="fu">seq</span>(<span class="dv">1</span>,<span class="fu">length</span>(time),<span class="at">by=</span><span class="dv">10</span>)]</span>
<span id="cb49-170"><a href="#cb49-170" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(</span>
<span id="cb49-171"><a href="#cb49-171" aria-hidden="true" tabindex="-1"></a>        <span class="fu">t</span>(subsampled.prop),</span>
<span id="cb49-172"><a href="#cb49-172" aria-hidden="true" tabindex="-1"></a>        <span class="at">names.arg=</span>subsampled.time,</span>
<span id="cb49-173"><a href="#cb49-173" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab=</span><span class="st">'time'</span>,<span class="at">main=</span><span class="st">'Group structure'</span>,</span>
<span id="cb49-174"><a href="#cb49-174" aria-hidden="true" tabindex="-1"></a>        <span class="at">space=</span><span class="dv">0</span>,</span>
<span id="cb49-175"><a href="#cb49-175" aria-hidden="true" tabindex="-1"></a>        <span class="at">col=</span><span class="fu">c</span>(</span>
<span id="cb49-176"><a href="#cb49-176" aria-hidden="true" tabindex="-1"></a>          <span class="fu">rgb</span>(<span class="fl">0.5</span>,<span class="dv">1</span>,<span class="fl">0.5</span>),</span>
<span id="cb49-177"><a href="#cb49-177" aria-hidden="true" tabindex="-1"></a>          <span class="fu">rgb</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>),</span>
<span id="cb49-178"><a href="#cb49-178" aria-hidden="true" tabindex="-1"></a>          <span class="fu">rgb</span>(<span class="dv">1</span>,<span class="fl">0.5</span>,<span class="fl">0.5</span>),</span>
<span id="cb49-179"><a href="#cb49-179" aria-hidden="true" tabindex="-1"></a>          <span class="fu">rgb</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>),</span>
<span id="cb49-180"><a href="#cb49-180" aria-hidden="true" tabindex="-1"></a>          <span class="fu">rgb</span>(<span class="fl">0.5</span>,<span class="fl">0.5</span>,<span class="dv">1</span>),</span>
<span id="cb49-181"><a href="#cb49-181" aria-hidden="true" tabindex="-1"></a>          <span class="fu">rgb</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb49-182"><a href="#cb49-182" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb49-183"><a href="#cb49-183" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend =</span> <span class="fu">colnames</span>(prop),</span>
<span id="cb49-184"><a href="#cb49-184" aria-hidden="true" tabindex="-1"></a>        <span class="at">args.legend=</span><span class="fu">list</span>(<span class="at">bg=</span><span class="st">"white"</span>)</span>
<span id="cb49-185"><a href="#cb49-185" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb49-186"><a href="#cb49-186" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-187"><a href="#cb49-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-188"><a href="#cb49-188" aria-hidden="true" tabindex="-1"></a><span class="fu">## A Model With 2 Age Classes</span></span>
<span id="cb49-189"><a href="#cb49-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-190"><a href="#cb49-190" aria-hidden="true" tabindex="-1"></a>Note that age is a special kind of heterogeneity in an epidemic model because individuals necessarily move from one class (younger) to another class (older) in a directional fashion that is independent of the infection and recovery process.</span>
<span id="cb49-191"><a href="#cb49-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-192"><a href="#cb49-192" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- Today's first lecture showed how force of infection can vary with age. --&gt;</span></span>
<span id="cb49-193"><a href="#cb49-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-194"><a href="#cb49-194" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- What sort of mechanisms might give rise to these effects? --&gt;</span></span>
<span id="cb49-195"><a href="#cb49-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-196"><a href="#cb49-196" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- Here we'll see to what extent we can infer these mechanisms on the basis of age-specific incidence and seroprevalence data. --&gt;</span></span>
<span id="cb49-197"><a href="#cb49-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-198"><a href="#cb49-198" aria-hidden="true" tabindex="-1"></a>We'll start by introducing age into the model above.</span>
<span id="cb49-199"><a href="#cb49-199" aria-hidden="true" tabindex="-1"></a>So now $a$ becomes juveniles and $b$ becomes adults.</span>
<span id="cb49-200"><a href="#cb49-200" aria-hidden="true" tabindex="-1"></a>And, independent of the disease process, juveniles (of any category) age into adults.</span>
<span id="cb49-201"><a href="#cb49-201" aria-hidden="true" tabindex="-1"></a>Additionally, new juveniles are added through births (always first susceptible) and old individuals are lost to death.</span>
<span id="cb49-202"><a href="#cb49-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-203"><a href="#cb49-203" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE}</span></span>
<span id="cb49-204"><a href="#cb49-204" aria-hidden="true" tabindex="-1"></a>elpos <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb49-205"><a href="#cb49-205" aria-hidden="true" tabindex="-1"></a>               <span class="at">B=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>),</span>
<span id="cb49-206"><a href="#cb49-206" aria-hidden="true" tabindex="-1"></a>               <span class="at">Sj=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>),</span>
<span id="cb49-207"><a href="#cb49-207" aria-hidden="true" tabindex="-1"></a>               <span class="at">Sa=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">3</span>),</span>
<span id="cb49-208"><a href="#cb49-208" aria-hidden="true" tabindex="-1"></a>               <span class="at">Ij=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>),</span>
<span id="cb49-209"><a href="#cb49-209" aria-hidden="true" tabindex="-1"></a>               <span class="at">Ia=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">2</span>),</span>
<span id="cb49-210"><a href="#cb49-210" aria-hidden="true" tabindex="-1"></a>               <span class="at">Rj=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>),</span>
<span id="cb49-211"><a href="#cb49-211" aria-hidden="true" tabindex="-1"></a>               <span class="at">Ra=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">1</span>),</span>
<span id="cb49-212"><a href="#cb49-212" aria-hidden="true" tabindex="-1"></a>               <span class="at">Ds=</span><span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">3</span>),</span>
<span id="cb49-213"><a href="#cb49-213" aria-hidden="true" tabindex="-1"></a>               <span class="at">Di=</span><span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">2</span>),</span>
<span id="cb49-214"><a href="#cb49-214" aria-hidden="true" tabindex="-1"></a>               <span class="at">Dr=</span><span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">1</span>)</span>
<span id="cb49-215"><a href="#cb49-215" aria-hidden="true" tabindex="-1"></a>               )</span>
<span id="cb49-216"><a href="#cb49-216" aria-hidden="true" tabindex="-1"></a>elpos[,<span class="dv">1</span>] <span class="ot">&lt;-</span> (<span class="dv">2</span><span class="sc">*</span>elpos[,<span class="dv">1</span>]<span class="sc">-</span><span class="dv">1</span>)<span class="sc">/</span><span class="dv">8</span></span>
<span id="cb49-217"><a href="#cb49-217" aria-hidden="true" tabindex="-1"></a>elpos[,<span class="dv">2</span>] <span class="ot">&lt;-</span> (<span class="dv">2</span><span class="sc">*</span>elpos[,<span class="dv">2</span>]<span class="sc">-</span><span class="dv">1</span>)<span class="sc">/</span><span class="dv">6</span></span>
<span id="cb49-218"><a href="#cb49-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-219"><a href="#cb49-219" aria-hidden="true" tabindex="-1"></a>fromto <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb49-220"><a href="#cb49-220" aria-hidden="true" tabindex="-1"></a>                <span class="at">BSj=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>),</span>
<span id="cb49-221"><a href="#cb49-221" aria-hidden="true" tabindex="-1"></a>                <span class="at">RaD=</span><span class="fu">c</span>(<span class="dv">7</span>,<span class="dv">10</span>),</span>
<span id="cb49-222"><a href="#cb49-222" aria-hidden="true" tabindex="-1"></a>                <span class="at">SjSa=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>),</span>
<span id="cb49-223"><a href="#cb49-223" aria-hidden="true" tabindex="-1"></a>                <span class="at">IjIa=</span><span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">5</span>),</span>
<span id="cb49-224"><a href="#cb49-224" aria-hidden="true" tabindex="-1"></a>                <span class="at">RjRa=</span><span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">7</span>),</span>
<span id="cb49-225"><a href="#cb49-225" aria-hidden="true" tabindex="-1"></a>                <span class="at">SjIj=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">4</span>),</span>
<span id="cb49-226"><a href="#cb49-226" aria-hidden="true" tabindex="-1"></a>                <span class="at">SaIa=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">5</span>),</span>
<span id="cb49-227"><a href="#cb49-227" aria-hidden="true" tabindex="-1"></a>                <span class="at">IjRj=</span><span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">6</span>),</span>
<span id="cb49-228"><a href="#cb49-228" aria-hidden="true" tabindex="-1"></a>                <span class="at">IaRa=</span><span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">7</span>),</span>
<span id="cb49-229"><a href="#cb49-229" aria-hidden="true" tabindex="-1"></a>                <span class="at">SaD=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">8</span>),</span>
<span id="cb49-230"><a href="#cb49-230" aria-hidden="true" tabindex="-1"></a>                <span class="at">IaD=</span><span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">9</span>)  </span>
<span id="cb49-231"><a href="#cb49-231" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb49-232"><a href="#cb49-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-233"><a href="#cb49-233" aria-hidden="true" tabindex="-1"></a>op <span class="ot">&lt;-</span> <span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb49-234"><a href="#cb49-234" aria-hidden="true" tabindex="-1"></a>diagram<span class="sc">::</span><span class="fu">openplotmat</span>(<span class="at">asp=</span><span class="fl">0.9</span>)</span>
<span id="cb49-235"><a href="#cb49-235" aria-hidden="true" tabindex="-1"></a>arrpos <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">ncol=</span><span class="dv">2</span>,<span class="at">nrow=</span><span class="fu">nrow</span>(fromto))</span>
<span id="cb49-236"><a href="#cb49-236" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(fromto)))</span>
<span id="cb49-237"><a href="#cb49-237" aria-hidden="true" tabindex="-1"></a>  arrpos[i,] <span class="ot">&lt;-</span> diagram<span class="sc">::</span><span class="fu">straightarrow</span>(</span>
<span id="cb49-238"><a href="#cb49-238" aria-hidden="true" tabindex="-1"></a>                              <span class="at">to=</span>elpos[fromto[i,<span class="dv">2</span>],],</span>
<span id="cb49-239"><a href="#cb49-239" aria-hidden="true" tabindex="-1"></a>                              <span class="at">from=</span>elpos[fromto[i,<span class="dv">1</span>],],</span>
<span id="cb49-240"><a href="#cb49-240" aria-hidden="true" tabindex="-1"></a>                              <span class="at">lwd=</span><span class="dv">2</span>,</span>
<span id="cb49-241"><a href="#cb49-241" aria-hidden="true" tabindex="-1"></a>                              <span class="at">arr.pos=</span><span class="fl">0.65</span>,</span>
<span id="cb49-242"><a href="#cb49-242" aria-hidden="true" tabindex="-1"></a>                              <span class="at">arr.length=</span><span class="fl">0.5</span></span>
<span id="cb49-243"><a href="#cb49-243" aria-hidden="true" tabindex="-1"></a>                              )</span>
<span id="cb49-244"><a href="#cb49-244" aria-hidden="true" tabindex="-1"></a>diagram<span class="sc">::</span><span class="fu">textrect</span>(elpos[<span class="st">"B"</span>,],<span class="fl">0.07</span>,<span class="fl">0.07</span>,<span class="at">lab=</span><span class="st">"B"</span>,<span class="at">box.col=</span><span class="fu">gray</span>(<span class="fl">0.7</span>),<span class="at">shadow.col=</span><span class="fu">gray</span>(<span class="fl">0.4</span>),<span class="at">shadow.size=</span><span class="fl">0.01</span>,<span class="at">cex=</span><span class="dv">2</span>)</span>
<span id="cb49-245"><a href="#cb49-245" aria-hidden="true" tabindex="-1"></a>diagram<span class="sc">::</span><span class="fu">textrect</span>(elpos[<span class="st">"Sj"</span>,],<span class="fl">0.07</span>,<span class="fl">0.07</span>,<span class="at">lab=</span><span class="st">"Sj"</span>,<span class="at">box.col=</span><span class="fu">gray</span>(<span class="fl">0.7</span>),<span class="at">shadow.col=</span><span class="fu">gray</span>(<span class="fl">0.4</span>),<span class="at">shadow.size=</span><span class="fl">0.01</span>,<span class="at">cex=</span><span class="dv">2</span>)</span>
<span id="cb49-246"><a href="#cb49-246" aria-hidden="true" tabindex="-1"></a>diagram<span class="sc">::</span><span class="fu">textrect</span>(elpos[<span class="st">"Sa"</span>,],<span class="fl">0.07</span>,<span class="fl">0.07</span>,<span class="at">lab=</span><span class="st">"Sa"</span>,<span class="at">box.col=</span><span class="fu">gray</span>(<span class="fl">0.7</span>),<span class="at">shadow.col=</span><span class="fu">gray</span>(<span class="fl">0.4</span>),<span class="at">shadow.size=</span><span class="fl">0.01</span>,<span class="at">cex=</span><span class="dv">2</span>)</span>
<span id="cb49-247"><a href="#cb49-247" aria-hidden="true" tabindex="-1"></a>diagram<span class="sc">::</span><span class="fu">textrect</span>(elpos[<span class="st">"Ij"</span>,],<span class="fl">0.07</span>,<span class="fl">0.07</span>,<span class="at">lab=</span><span class="st">"Ij"</span>,<span class="at">box.col=</span><span class="fu">gray</span>(<span class="fl">0.7</span>),<span class="at">shadow.col=</span><span class="fu">gray</span>(<span class="fl">0.4</span>),<span class="at">shadow.size=</span><span class="fl">0.01</span>,<span class="at">cex=</span><span class="dv">2</span>)</span>
<span id="cb49-248"><a href="#cb49-248" aria-hidden="true" tabindex="-1"></a>diagram<span class="sc">::</span><span class="fu">textrect</span>(elpos[<span class="st">"Ia"</span>,],<span class="fl">0.07</span>,<span class="fl">0.07</span>,<span class="at">lab=</span><span class="st">"Ia"</span>,<span class="at">box.col=</span><span class="fu">gray</span>(<span class="fl">0.7</span>),<span class="at">shadow.col=</span><span class="fu">gray</span>(<span class="fl">0.4</span>),<span class="at">shadow.size=</span><span class="fl">0.01</span>,<span class="at">cex=</span><span class="dv">2</span>)</span>
<span id="cb49-249"><a href="#cb49-249" aria-hidden="true" tabindex="-1"></a>diagram<span class="sc">::</span><span class="fu">textrect</span>(elpos[<span class="st">"Rj"</span>,],<span class="fl">0.07</span>,<span class="fl">0.07</span>,<span class="at">lab=</span><span class="st">"Rj"</span>,<span class="at">box.col=</span><span class="fu">gray</span>(<span class="fl">0.7</span>),<span class="at">shadow.col=</span><span class="fu">gray</span>(<span class="fl">0.4</span>),<span class="at">shadow.size=</span><span class="fl">0.01</span>,<span class="at">cex=</span><span class="dv">2</span>)</span>
<span id="cb49-250"><a href="#cb49-250" aria-hidden="true" tabindex="-1"></a>diagram<span class="sc">::</span><span class="fu">textrect</span>(elpos[<span class="st">"Ra"</span>,],<span class="fl">0.07</span>,<span class="fl">0.07</span>,<span class="at">lab=</span><span class="st">"Ra"</span>,<span class="at">box.col=</span><span class="fu">gray</span>(<span class="fl">0.7</span>),<span class="at">shadow.col=</span><span class="fu">gray</span>(<span class="fl">0.4</span>),<span class="at">shadow.size=</span><span class="fl">0.01</span>,<span class="at">cex=</span><span class="dv">2</span>)</span>
<span id="cb49-251"><a href="#cb49-251" aria-hidden="true" tabindex="-1"></a>diagram<span class="sc">::</span><span class="fu">textrect</span>(elpos[<span class="st">"Ds"</span>,],<span class="fl">0.07</span>,<span class="fl">0.07</span>,<span class="at">lab=</span><span class="st">"D"</span>,<span class="at">box.col=</span><span class="fu">gray</span>(<span class="fl">0.7</span>),<span class="at">shadow.col=</span><span class="fu">gray</span>(<span class="fl">0.4</span>),<span class="at">shadow.size=</span><span class="fl">0.01</span>,<span class="at">cex=</span><span class="dv">2</span>)</span>
<span id="cb49-252"><a href="#cb49-252" aria-hidden="true" tabindex="-1"></a>diagram<span class="sc">::</span><span class="fu">textrect</span>(elpos[<span class="st">"Di"</span>,],<span class="fl">0.07</span>,<span class="fl">0.07</span>,<span class="at">lab=</span><span class="st">"D"</span>,<span class="at">box.col=</span><span class="fu">gray</span>(<span class="fl">0.7</span>),<span class="at">shadow.col=</span><span class="fu">gray</span>(<span class="fl">0.4</span>),<span class="at">shadow.size=</span><span class="fl">0.01</span>,<span class="at">cex=</span><span class="dv">2</span>)</span>
<span id="cb49-253"><a href="#cb49-253" aria-hidden="true" tabindex="-1"></a>diagram<span class="sc">::</span><span class="fu">textrect</span>(elpos[<span class="st">"Dr"</span>,],<span class="fl">0.07</span>,<span class="fl">0.07</span>,<span class="at">lab=</span><span class="st">"D"</span>,<span class="at">box.col=</span><span class="fu">gray</span>(<span class="fl">0.7</span>),<span class="at">shadow.col=</span><span class="fu">gray</span>(<span class="fl">0.4</span>),<span class="at">shadow.size=</span><span class="fl">0.01</span>,<span class="at">cex=</span><span class="dv">2</span>)</span>
<span id="cb49-254"><a href="#cb49-254" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>,arrpos[<span class="dv">3</span>,<span class="dv">2</span>]<span class="sc">+</span><span class="fl">0.05</span>,<span class="fu">quote</span>(alpha),<span class="at">cex=</span><span class="dv">2</span>)</span>
<span id="cb49-255"><a href="#cb49-255" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>,arrpos[<span class="dv">4</span>,<span class="dv">2</span>]<span class="sc">+</span><span class="fl">0.05</span>,<span class="fu">quote</span>(alpha),<span class="at">cex=</span><span class="dv">2</span>)</span>
<span id="cb49-256"><a href="#cb49-256" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>,arrpos[<span class="dv">5</span>,<span class="dv">2</span>]<span class="sc">+</span><span class="fl">0.05</span>,<span class="fu">quote</span>(alpha),<span class="at">cex=</span><span class="dv">2</span>)</span>
<span id="cb49-257"><a href="#cb49-257" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(arrpos[<span class="dv">6</span>,<span class="dv">1</span>]<span class="sc">-</span><span class="fl">0.05</span>,<span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>,<span class="fu">quote</span>(lambda[J]),<span class="at">cex=</span><span class="dv">2</span>)</span>
<span id="cb49-258"><a href="#cb49-258" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(arrpos[<span class="dv">7</span>,<span class="dv">1</span>]<span class="sc">+</span><span class="fl">0.05</span>,<span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>,<span class="fu">quote</span>(lambda[A]),<span class="at">cex=</span><span class="dv">2</span>)</span>
<span id="cb49-259"><a href="#cb49-259" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(arrpos[<span class="dv">8</span>,<span class="dv">1</span>]<span class="sc">-</span><span class="fl">0.05</span>,<span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>,<span class="fu">quote</span>(gamma),<span class="at">cex=</span><span class="dv">2</span>)</span>
<span id="cb49-260"><a href="#cb49-260" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(arrpos[<span class="dv">9</span>,<span class="dv">1</span>]<span class="sc">+</span><span class="fl">0.05</span>,<span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>,<span class="fu">quote</span>(gamma),<span class="at">cex=</span><span class="dv">2</span>)</span>
<span id="cb49-261"><a href="#cb49-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-262"><a href="#cb49-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-263"><a href="#cb49-263" aria-hidden="true" tabindex="-1"></a><span class="do">##text(3/4,arrpos[2,2]+0.05,quote(mu),cex=2)</span></span>
<span id="cb49-264"><a href="#cb49-264" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(op)</span>
<span id="cb49-265"><a href="#cb49-265" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-266"><a href="#cb49-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-267"><a href="#cb49-267" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- $$ --&gt;</span></span>
<span id="cb49-268"><a href="#cb49-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-269"><a href="#cb49-269" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- \begin{aligned} --&gt;</span></span>
<span id="cb49-270"><a href="#cb49-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-271"><a href="#cb49-271" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--   \frac{dS_J}{dt} &amp;= -\lambda_J\,S_J \phantom{-\gamma\,I_A}\\ --&gt;</span></span>
<span id="cb49-272"><a href="#cb49-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-273"><a href="#cb49-273" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--   \frac{dS_A}{dt} &amp;= -\lambda_A\,S_A \phantom{-\gamma\,I_A}\\ --&gt;</span></span>
<span id="cb49-274"><a href="#cb49-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-275"><a href="#cb49-275" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--   \frac{dI_J}{dt} &amp;= \phantom{-}\lambda_J\,S_J -\gamma\,I_J\\ --&gt;</span></span>
<span id="cb49-276"><a href="#cb49-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-277"><a href="#cb49-277" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--   \frac{dI_A}{dt} &amp;= \phantom{-}\lambda_A\,S_A-\gamma\,I_A\\ --&gt;</span></span>
<span id="cb49-278"><a href="#cb49-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-279"><a href="#cb49-279" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--   \frac{dR_J}{dt} &amp;= \phantom{-\lambda_J\,S_A}+\gamma\,I_J\\ --&gt;</span></span>
<span id="cb49-280"><a href="#cb49-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-281"><a href="#cb49-281" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--   \frac{dR_A}{dt} &amp;= \phantom{-\lambda_J\,S_A}+\gamma\,I_A\\ --&gt;</span></span>
<span id="cb49-282"><a href="#cb49-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-283"><a href="#cb49-283" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- \end{aligned} --&gt;</span></span>
<span id="cb49-284"><a href="#cb49-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-285"><a href="#cb49-285" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- $$ The $\lambda$s denote the age-specific force of infections: $$ --&gt;</span></span>
<span id="cb49-286"><a href="#cb49-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-287"><a href="#cb49-287" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- \begin{aligned} --&gt;</span></span>
<span id="cb49-288"><a href="#cb49-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-289"><a href="#cb49-289" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--     \lambda_J &amp;= \beta_{JJ}\,I_J+\beta_{JA}\,I_A\\ --&gt;</span></span>
<span id="cb49-290"><a href="#cb49-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-291"><a href="#cb49-291" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--     \lambda_A &amp;= \beta_{AJ}\,I_J+\beta_{AA}\,I_A --&gt;</span></span>
<span id="cb49-292"><a href="#cb49-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-293"><a href="#cb49-293" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!--   \end{aligned} --&gt;</span></span>
<span id="cb49-294"><a href="#cb49-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-295"><a href="#cb49-295" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- $$  --&gt;</span></span>
<span id="cb49-296"><a href="#cb49-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-297"><a href="#cb49-297" aria-hidden="true" tabindex="-1"></a>We can do this very simply using the same ingredients that go into the basic SIR model.</span>
<span id="cb49-298"><a href="#cb49-298" aria-hidden="true" tabindex="-1"></a>In that model, the waiting times in the S and I classes are exponential.</span>
<span id="cb49-299"><a href="#cb49-299" aria-hidden="true" tabindex="-1"></a>Let's assume the same thing about the aging process.</span>
<span id="cb49-300"><a href="#cb49-300" aria-hidden="true" tabindex="-1"></a>We'll also add in births into the juvenile susceptible class and deaths from the adult classes.</span>
<span id="cb49-301"><a href="#cb49-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-302"><a href="#cb49-302" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb49-303"><a href="#cb49-303" aria-hidden="true" tabindex="-1"></a>  \begin{aligned}</span>
<span id="cb49-304"><a href="#cb49-304" aria-hidden="true" tabindex="-1"></a>    \frac{dS_J}{dt} &amp;= -\lambda_J\,S_J \phantom{-\gamma\,I_A}  +B \phantom{-\mu\,S_A}-\alpha\,S_J<span class="sc">\\</span></span>
<span id="cb49-305"><a href="#cb49-305" aria-hidden="true" tabindex="-1"></a>    \frac{dS_A}{dt} &amp;= -\lambda_A\,S_A \phantom{-\gamma\,I_A +B} -\mu\,S_A+\alpha\,S_J<span class="sc">\\</span></span>
<span id="cb49-306"><a href="#cb49-306" aria-hidden="true" tabindex="-1"></a>    \frac{dI_J}{dt} &amp;= \phantom{-}\lambda_J\,S_J -\gamma\,I_J\phantom{+B-\mu\,S_A}-\alpha\,I_J<span class="sc">\\</span></span>
<span id="cb49-307"><a href="#cb49-307" aria-hidden="true" tabindex="-1"></a>    \frac{dI_A}{dt} &amp;= \phantom{-}\lambda_A\,S_A-\gamma\,I_A \phantom{+B} -\mu\,I_A+\alpha\,I_J<span class="sc">\\</span></span>
<span id="cb49-308"><a href="#cb49-308" aria-hidden="true" tabindex="-1"></a>    \frac{dR_J}{dt} &amp;= \phantom{-\lambda_J\,S_A}+\gamma\,I_J\phantom{+B-\mu\,S_A}-\alpha\,R_J<span class="sc">\\</span></span>
<span id="cb49-309"><a href="#cb49-309" aria-hidden="true" tabindex="-1"></a>    \frac{dR_A}{dt} &amp;= \phantom{-\lambda_J\,S_A}+\gamma\,I_A \phantom{+B}-\mu\,R_A+\alpha\,R_J<span class="sc">\\</span></span>
<span id="cb49-310"><a href="#cb49-310" aria-hidden="true" tabindex="-1"></a>  \end{aligned}</span>
<span id="cb49-311"><a href="#cb49-311" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb49-312"><a href="#cb49-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-313"><a href="#cb49-313" aria-hidden="true" tabindex="-1"></a>Now, let's simulate this model, under the same assumptions about transmission rates as above.</span>
<span id="cb49-314"><a href="#cb49-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-317"><a href="#cb49-317" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb49-318"><a href="#cb49-318" aria-hidden="true" tabindex="-1"></a><span class="co"># define the parameters</span></span>
<span id="cb49-319"><a href="#cb49-319" aria-hidden="true" tabindex="-1"></a>b1_demog <span class="ot">&lt;-</span> <span class="fl">0.002</span></span>
<span id="cb49-320"><a href="#cb49-320" aria-hidden="true" tabindex="-1"></a>b2_demog <span class="ot">&lt;-</span> <span class="fl">0.002</span></span>
<span id="cb49-321"><a href="#cb49-321" aria-hidden="true" tabindex="-1"></a>gamma_demog <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb49-322"><a href="#cb49-322" aria-hidden="true" tabindex="-1"></a>births_demog <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb49-323"><a href="#cb49-323" aria-hidden="true" tabindex="-1"></a>da_demog <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">20</span>,<span class="dv">60</span>)                          <span class="co"># alpha = 1/da</span></span>
<span id="cb49-324"><a href="#cb49-324" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-325"><a href="#cb49-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-328"><a href="#cb49-328" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb49-329"><a href="#cb49-329" aria-hidden="true" tabindex="-1"></a>ja.demog.model <span class="ot">&lt;-</span> <span class="cf">function</span> (t, x, ...) {</span>
<span id="cb49-330"><a href="#cb49-330" aria-hidden="true" tabindex="-1"></a>  s <span class="ot">&lt;-</span> x[<span class="fu">c</span>(<span class="st">"Sj"</span>,<span class="st">"Sa"</span>)]                  <span class="co"># susceptibles</span></span>
<span id="cb49-331"><a href="#cb49-331" aria-hidden="true" tabindex="-1"></a>  i <span class="ot">&lt;-</span> x[<span class="fu">c</span>(<span class="st">"Ij"</span>,<span class="st">"Ia"</span>)]                  <span class="co"># infecteds</span></span>
<span id="cb49-332"><a href="#cb49-332" aria-hidden="true" tabindex="-1"></a>  r <span class="ot">&lt;-</span> x[<span class="fu">c</span>(<span class="st">"Rj"</span>,<span class="st">"Ra"</span>)]                  <span class="co"># recovereds</span></span>
<span id="cb49-333"><a href="#cb49-333" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> s<span class="sc">+</span>i<span class="sc">+</span>r                            <span class="co"># total pop</span></span>
<span id="cb49-334"><a href="#cb49-334" aria-hidden="true" tabindex="-1"></a>  lambda.j <span class="ot">&lt;-</span> (b1_demog<span class="sc">+</span>b2_demog)<span class="sc">*</span>i[<span class="dv">1</span>]<span class="sc">+</span>b1_demog<span class="sc">*</span>i[<span class="dv">2</span>]      <span class="co"># juv. force of infection </span></span>
<span id="cb49-335"><a href="#cb49-335" aria-hidden="true" tabindex="-1"></a>  lambda.a <span class="ot">&lt;-</span> b1_demog<span class="sc">*</span>i[<span class="dv">1</span>]<span class="sc">+</span>(b1_demog<span class="sc">+</span>b2_demog)<span class="sc">*</span>i[<span class="dv">2</span>]      <span class="co"># adult. force of infection</span></span>
<span id="cb49-336"><a href="#cb49-336" aria-hidden="true" tabindex="-1"></a>  alpha <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span>da_demog</span>
<span id="cb49-337"><a href="#cb49-337" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb49-338"><a href="#cb49-338" aria-hidden="true" tabindex="-1"></a>       <span class="fu">c</span>(</span>
<span id="cb49-339"><a href="#cb49-339" aria-hidden="true" tabindex="-1"></a>         <span class="sc">-</span>lambda.j<span class="sc">*</span>s[<span class="dv">1</span>]           <span class="sc">-</span>alpha[<span class="dv">1</span>]<span class="sc">*</span>s[<span class="dv">1</span>]<span class="sc">+</span>births_demog,</span>
<span id="cb49-340"><a href="#cb49-340" aria-hidden="true" tabindex="-1"></a>         <span class="sc">-</span>lambda.a<span class="sc">*</span>s[<span class="dv">2</span>]           <span class="sc">+</span>alpha[<span class="dv">1</span>]<span class="sc">*</span>s[<span class="dv">1</span>]<span class="sc">-</span>alpha[<span class="dv">2</span>]<span class="sc">*</span>s[<span class="dv">2</span>],</span>
<span id="cb49-341"><a href="#cb49-341" aria-hidden="true" tabindex="-1"></a>          lambda.j<span class="sc">*</span>s[<span class="dv">1</span>]<span class="sc">-</span>gamma_demog<span class="sc">*</span>i[<span class="dv">1</span>]<span class="sc">-</span>alpha[<span class="dv">1</span>]<span class="sc">*</span>i[<span class="dv">1</span>],</span>
<span id="cb49-342"><a href="#cb49-342" aria-hidden="true" tabindex="-1"></a>          lambda.a<span class="sc">*</span>s[<span class="dv">2</span>]<span class="sc">-</span>gamma_demog<span class="sc">*</span>i[<span class="dv">2</span>]<span class="sc">+</span>alpha[<span class="dv">1</span>]<span class="sc">*</span>i[<span class="dv">1</span>]<span class="sc">-</span>alpha[<span class="dv">2</span>]<span class="sc">*</span>i[<span class="dv">2</span>],</span>
<span id="cb49-343"><a href="#cb49-343" aria-hidden="true" tabindex="-1"></a>                        gamma_demog<span class="sc">*</span>i[<span class="dv">1</span>]<span class="sc">-</span>alpha[<span class="dv">1</span>]<span class="sc">*</span>r[<span class="dv">1</span>],</span>
<span id="cb49-344"><a href="#cb49-344" aria-hidden="true" tabindex="-1"></a>                        gamma_demog<span class="sc">*</span>i[<span class="dv">2</span>]<span class="sc">+</span>alpha[<span class="dv">1</span>]<span class="sc">*</span>r[<span class="dv">1</span>]<span class="sc">-</span>alpha[<span class="dv">2</span>]<span class="sc">*</span>r[<span class="dv">2</span>]</span>
<span id="cb49-345"><a href="#cb49-345" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb49-346"><a href="#cb49-346" aria-hidden="true" tabindex="-1"></a>       )</span>
<span id="cb49-347"><a href="#cb49-347" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb49-348"><a href="#cb49-348" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-349"><a href="#cb49-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-350"><a href="#cb49-350" aria-hidden="true" tabindex="-1"></a>Note that in this function, $\mu=$ <span class="in">`alpha[2]`</span>, i.e., death, is just like another age class.</span>
<span id="cb49-351"><a href="#cb49-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-354"><a href="#cb49-354" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb49-355"><a href="#cb49-355" aria-hidden="true" tabindex="-1"></a><span class="do">## initial conditions</span></span>
<span id="cb49-356"><a href="#cb49-356" aria-hidden="true" tabindex="-1"></a>yinit <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">Sj=</span><span class="dv">2000</span>,<span class="at">Sa=</span><span class="dv">3000</span>,<span class="at">Ij=</span><span class="dv">0</span>,<span class="at">Ia=</span><span class="dv">1</span>,<span class="at">Rj=</span><span class="dv">0</span>,<span class="at">Ra=</span><span class="dv">1000</span>)</span>
<span id="cb49-357"><a href="#cb49-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-358"><a href="#cb49-358" aria-hidden="true" tabindex="-1"></a>sol_demog <span class="ot">&lt;-</span> deSolve<span class="sc">::</span><span class="fu">ode</span>(</span>
<span id="cb49-359"><a href="#cb49-359" aria-hidden="true" tabindex="-1"></a>           <span class="at">y=</span>yinit,</span>
<span id="cb49-360"><a href="#cb49-360" aria-hidden="true" tabindex="-1"></a>           <span class="at">times=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">200</span>,<span class="at">by=</span><span class="fl">0.1</span>),</span>
<span id="cb49-361"><a href="#cb49-361" aria-hidden="true" tabindex="-1"></a>           <span class="at">func=</span>ja.demog.model</span>
<span id="cb49-362"><a href="#cb49-362" aria-hidden="true" tabindex="-1"></a>           )</span>
<span id="cb49-363"><a href="#cb49-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-364"><a href="#cb49-364" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-365"><a href="#cb49-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-366"><a href="#cb49-366" aria-hidden="true" tabindex="-1"></a><span class="fu">### Exercise 1: Use this code to plot the number of susceptible, infected, and recovered individuals over time.</span></span>
<span id="cb49-367"><a href="#cb49-367" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb49-368"><a href="#cb49-368" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sol_demog, <span class="at">mfcol=</span><span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>))</span>
<span id="cb49-369"><a href="#cb49-369" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(sol_demog)</span>
<span id="cb49-370"><a href="#cb49-370" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sol_demog)</span>
<span id="cb49-371"><a href="#cb49-371" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sol_demog,<span class="at">log=</span><span class="st">'y'</span>,<span class="at">mfcol=</span><span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>))</span>
<span id="cb49-372"><a href="#cb49-372" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-373"><a href="#cb49-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-374"><a href="#cb49-374" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=F,eval=F}</span></span>
<span id="cb49-375"><a href="#cb49-375" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sol_demog, <span class="at">mfcol=</span><span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>))</span>
<span id="cb49-376"><a href="#cb49-376" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfcol=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb49-377"><a href="#cb49-377" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-378"><a href="#cb49-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-379"><a href="#cb49-379" aria-hidden="true" tabindex="-1"></a>Note that now that births are replenishing susceptibles infection persists. The results of the above are plotted here :</span>
<span id="cb49-380"><a href="#cb49-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-383"><a href="#cb49-383" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb49-384"><a href="#cb49-384" aria-hidden="true" tabindex="-1"></a><span class="co">#plot the relative proportion of individuals in each category</span></span>
<span id="cb49-385"><a href="#cb49-385" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb49-386"><a href="#cb49-386" aria-hidden="true" tabindex="-1"></a>time <span class="ot">&lt;-</span> sol_demog[,<span class="dv">1</span>]                         <span class="co"># time</span></span>
<span id="cb49-387"><a href="#cb49-387" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> sol_demog[,<span class="sc">-</span><span class="dv">1</span>]                           <span class="co"># all other variables</span></span>
<span id="cb49-388"><a href="#cb49-388" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">apply</span>(y,<span class="dv">1</span>,sum)                     <span class="co"># population size</span></span>
<span id="cb49-389"><a href="#cb49-389" aria-hidden="true" tabindex="-1"></a>prop <span class="ot">&lt;-</span> y<span class="sc">/</span>n                             <span class="co"># fractions</span></span>
<span id="cb49-390"><a href="#cb49-390" aria-hidden="true" tabindex="-1"></a>subsampled.prop <span class="ot">&lt;-</span> prop[<span class="fu">seq</span>(<span class="dv">1</span>,<span class="fu">length</span>(time),<span class="at">by=</span><span class="dv">10</span>),]</span>
<span id="cb49-391"><a href="#cb49-391" aria-hidden="true" tabindex="-1"></a>subsampled.time <span class="ot">&lt;-</span> time[<span class="fu">seq</span>(<span class="dv">1</span>,<span class="fu">length</span>(time),<span class="at">by=</span><span class="dv">10</span>)]</span>
<span id="cb49-392"><a href="#cb49-392" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(</span>
<span id="cb49-393"><a href="#cb49-393" aria-hidden="true" tabindex="-1"></a>        <span class="fu">t</span>(subsampled.prop),</span>
<span id="cb49-394"><a href="#cb49-394" aria-hidden="true" tabindex="-1"></a>        <span class="at">names.arg=</span>subsampled.time,</span>
<span id="cb49-395"><a href="#cb49-395" aria-hidden="true" tabindex="-1"></a>        <span class="at">xlab=</span><span class="st">'time'</span>,<span class="at">main=</span><span class="st">'Age structure'</span>,</span>
<span id="cb49-396"><a href="#cb49-396" aria-hidden="true" tabindex="-1"></a>        <span class="at">space=</span><span class="dv">0</span>,</span>
<span id="cb49-397"><a href="#cb49-397" aria-hidden="true" tabindex="-1"></a>        <span class="at">col=</span><span class="fu">c</span>(</span>
<span id="cb49-398"><a href="#cb49-398" aria-hidden="true" tabindex="-1"></a>          <span class="fu">rgb</span>(<span class="fl">0.5</span>,<span class="dv">1</span>,<span class="fl">0.5</span>),</span>
<span id="cb49-399"><a href="#cb49-399" aria-hidden="true" tabindex="-1"></a>          <span class="fu">rgb</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>),</span>
<span id="cb49-400"><a href="#cb49-400" aria-hidden="true" tabindex="-1"></a>          <span class="fu">rgb</span>(<span class="dv">1</span>,<span class="fl">0.5</span>,<span class="fl">0.5</span>),</span>
<span id="cb49-401"><a href="#cb49-401" aria-hidden="true" tabindex="-1"></a>          <span class="fu">rgb</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>),</span>
<span id="cb49-402"><a href="#cb49-402" aria-hidden="true" tabindex="-1"></a>          <span class="fu">rgb</span>(<span class="fl">0.5</span>,<span class="fl">0.5</span>,<span class="dv">1</span>),</span>
<span id="cb49-403"><a href="#cb49-403" aria-hidden="true" tabindex="-1"></a>          <span class="fu">rgb</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb49-404"><a href="#cb49-404" aria-hidden="true" tabindex="-1"></a>          ),</span>
<span id="cb49-405"><a href="#cb49-405" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend =</span> <span class="fu">colnames</span>(prop),</span>
<span id="cb49-406"><a href="#cb49-406" aria-hidden="true" tabindex="-1"></a>        <span class="at">args.legend=</span><span class="fu">list</span>(<span class="at">bg=</span><span class="st">"white"</span>),</span>
<span id="cb49-407"><a href="#cb49-407" aria-hidden="true" tabindex="-1"></a>        <span class="at">border =</span> <span class="cn">NA</span></span>
<span id="cb49-408"><a href="#cb49-408" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb49-409"><a href="#cb49-409" aria-hidden="true" tabindex="-1"></a>equil <span class="ot">&lt;-</span> <span class="fu">drop</span>(<span class="fu">tail</span>(sol_demog,<span class="dv">1</span>))[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb49-410"><a href="#cb49-410" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> equil[<span class="fu">c</span>(<span class="st">"Sj"</span>,<span class="st">"Sa"</span>)]<span class="sc">+</span>equil[<span class="fu">c</span>(<span class="st">"Ij"</span>,<span class="st">"Ia"</span>)]<span class="sc">+</span>equil[<span class="fu">c</span>(<span class="st">"Rj"</span>,<span class="st">"Ra"</span>)]</span>
<span id="cb49-411"><a href="#cb49-411" aria-hidden="true" tabindex="-1"></a>seroprev <span class="ot">&lt;-</span> equil[<span class="fu">c</span>(<span class="st">"Rj"</span>,<span class="st">"Ra"</span>)]<span class="sc">/</span>n            <span class="co"># get the proportion in the R class at equilibrium</span></span>
<span id="cb49-412"><a href="#cb49-412" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(seroprev) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"J"</span>,<span class="st">"A"</span>)                </span>
<span id="cb49-413"><a href="#cb49-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-414"><a href="#cb49-414" aria-hidden="true" tabindex="-1"></a><span class="co">#plot the proportion of each age class </span></span>
<span id="cb49-415"><a href="#cb49-415" aria-hidden="true" tabindex="-1"></a><span class="co"># that has been previously infected (is in the R class) </span></span>
<span id="cb49-416"><a href="#cb49-416" aria-hidden="true" tabindex="-1"></a><span class="co"># and would thus be expected to have antibodies (i.e. seropositive)</span></span>
<span id="cb49-417"><a href="#cb49-417" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(<span class="at">height=</span>seroprev,<span class="at">width=</span>da_demog,<span class="at">ylab=</span><span class="st">"seroprevalence"</span>)  </span>
<span id="cb49-418"><a href="#cb49-418" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-419"><a href="#cb49-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-420"><a href="#cb49-420" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE}</span></span>
<span id="cb49-421"><a href="#cb49-421" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb49-422"><a href="#cb49-422" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-423"><a href="#cb49-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-424"><a href="#cb49-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-425"><a href="#cb49-425" aria-hidden="true" tabindex="-1"></a>To compute $R_0$, we need to know the stable age distribution (the relative proportion in the juvenile and adult age classes) of the population, which we can find by solving for the disease-free equilibrium: $S_J^*=B/\alpha$ and $S_A^*=B/\mu$.</span>
<span id="cb49-426"><a href="#cb49-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-427"><a href="#cb49-427" aria-hidden="true" tabindex="-1"></a>With the stable age distribution, we can calculate $R_0$ by constructing the next generation matrix. Details on this method are described in the last section of this worksheet and are not required for completing the exercises in the worksheet. The code below outlines how the next generation matrix is constructed using the $\alpha$ (aging from juvenile to adult), $\mu$ death), $n$ (total births), $\gamma$ (recovery), $da$ (width of age groups in years), and $\beta$ (transmission) parameters. </span>
<span id="cb49-428"><a href="#cb49-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-429"><a href="#cb49-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-432"><a href="#cb49-432" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb49-433"><a href="#cb49-433" aria-hidden="true" tabindex="-1"></a><span class="co"># this code can be re-run to set parameter values</span></span>
<span id="cb49-434"><a href="#cb49-434" aria-hidden="true" tabindex="-1"></a>alpha <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span>da_demog[<span class="dv">1</span>]</span>
<span id="cb49-435"><a href="#cb49-435" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span>da_demog[<span class="dv">2</span>]</span>
<span id="cb49-436"><a href="#cb49-436" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> births_demog<span class="sc">/</span><span class="fu">c</span>(alpha,mu)</span>
<span id="cb49-437"><a href="#cb49-437" aria-hidden="true" tabindex="-1"></a>beta_demog <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(b1_demog<span class="sc">+</span>b2,b1_demog,b1_demog,b1_demog<span class="sc">+</span>b2),<span class="at">nrow=</span><span class="dv">2</span>,<span class="at">ncol=</span><span class="dv">2</span>)</span>
<span id="cb49-438"><a href="#cb49-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-439"><a href="#cb49-439" aria-hidden="true" tabindex="-1"></a><span class="co"># this command craetes the next generation matrix</span></span>
<span id="cb49-440"><a href="#cb49-440" aria-hidden="true" tabindex="-1"></a>ngm <span class="ot">&lt;-</span> <span class="fu">matrix</span>(</span>
<span id="cb49-441"><a href="#cb49-441" aria-hidden="true" tabindex="-1"></a>              <span class="fu">c</span>(</span>
<span id="cb49-442"><a href="#cb49-442" aria-hidden="true" tabindex="-1"></a>                n[<span class="dv">1</span>]<span class="sc">*</span>beta_demog[<span class="dv">1</span>,<span class="dv">1</span>]<span class="sc">/</span>(gamma_demog<span class="sc">+</span>alpha)<span class="sc">+</span></span>
<span id="cb49-443"><a href="#cb49-443" aria-hidden="true" tabindex="-1"></a>                  alpha<span class="sc">/</span>(gamma_demog<span class="sc">+</span>mu)<span class="sc">*</span>n[<span class="dv">1</span>]<span class="sc">*</span>beta_demog[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">/</span>(gamma_demog<span class="sc">+</span>mu),</span>
<span id="cb49-444"><a href="#cb49-444" aria-hidden="true" tabindex="-1"></a>                n[<span class="dv">2</span>]<span class="sc">*</span>beta_demog[<span class="dv">2</span>,<span class="dv">1</span>]<span class="sc">/</span>(gamma_demog<span class="sc">+</span>alpha)<span class="sc">+</span></span>
<span id="cb49-445"><a href="#cb49-445" aria-hidden="true" tabindex="-1"></a>                  alpha<span class="sc">/</span>(gamma_demog<span class="sc">+</span>mu)<span class="sc">*</span>n[<span class="dv">2</span>]<span class="sc">*</span>beta_demog[<span class="dv">2</span>,<span class="dv">2</span>]<span class="sc">/</span>(gamma_demog<span class="sc">+</span>mu),</span>
<span id="cb49-446"><a href="#cb49-446" aria-hidden="true" tabindex="-1"></a>                n[<span class="dv">1</span>]<span class="sc">*</span>beta_demog[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">/</span>(gamma_demog<span class="sc">+</span>mu),</span>
<span id="cb49-447"><a href="#cb49-447" aria-hidden="true" tabindex="-1"></a>                n[<span class="dv">2</span>]<span class="sc">*</span>beta_demog[<span class="dv">2</span>,<span class="dv">2</span>]<span class="sc">/</span>(gamma_demog<span class="sc">+</span>mu)</span>
<span id="cb49-448"><a href="#cb49-448" aria-hidden="true" tabindex="-1"></a>                ),</span>
<span id="cb49-449"><a href="#cb49-449" aria-hidden="true" tabindex="-1"></a>              <span class="at">nrow=</span><span class="dv">2</span>,</span>
<span id="cb49-450"><a href="#cb49-450" aria-hidden="true" tabindex="-1"></a>              <span class="at">ncol=</span><span class="dv">2</span></span>
<span id="cb49-451"><a href="#cb49-451" aria-hidden="true" tabindex="-1"></a>              )</span>
<span id="cb49-452"><a href="#cb49-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-453"><a href="#cb49-453" aria-hidden="true" tabindex="-1"></a><span class="co"># this command outputs the R0 value</span></span>
<span id="cb49-454"><a href="#cb49-454" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(<span class="fu">Re</span>(<span class="fu">eigen</span>(ngm,<span class="at">only.values=</span>T)<span class="sc">$</span>values))</span>
<span id="cb49-455"><a href="#cb49-455" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-456"><a href="#cb49-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-457"><a href="#cb49-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-458"><a href="#cb49-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-459"><a href="#cb49-459" aria-hidden="true" tabindex="-1"></a><span class="fu">## Getting more realistic: adding more age classes</span></span>
<span id="cb49-460"><a href="#cb49-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-461"><a href="#cb49-461" aria-hidden="true" tabindex="-1"></a>In the models above, the aging process follows an exponential distribution, which means that whether an individual is 1\~year old or 10 years old, the chance of them becoming an adult is the same!</span>
<span id="cb49-462"><a href="#cb49-462" aria-hidden="true" tabindex="-1"></a>To improve on this, we can assume that the time a juvenile must wait before becoming an adult follows a gamma distribution.</span>
<span id="cb49-463"><a href="#cb49-463" aria-hidden="true" tabindex="-1"></a>This is equivalent to saying that the waiting time is a sum of some number of exponential distributions.</span>
<span id="cb49-464"><a href="#cb49-464" aria-hidden="true" tabindex="-1"></a>This suggests that we can achieve such a distribution by adding age classes to the model, so that becoming an adult means passing through some number of stages.</span>
<span id="cb49-465"><a href="#cb49-465" aria-hidden="true" tabindex="-1"></a>We'll use 30 age classes, and since they don't have to be of equal duration, we'll assume that they're not.</span>
<span id="cb49-466"><a href="#cb49-466" aria-hidden="true" tabindex="-1"></a>Specifically, we'll have 20 1-yr age classes to take us up to adulthood and break adults into 10 age classes of 5\~yr duration each. The last age class covers age 66-80.</span>
<span id="cb49-467"><a href="#cb49-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-468"><a href="#cb49-468" aria-hidden="true" tabindex="-1"></a>Now, when we had just two age classes, we could write out each of the equations easily enough, but now that we're going to have 30, we'll need to be more systematic.</span>
<span id="cb49-469"><a href="#cb49-469" aria-hidden="true" tabindex="-1"></a>In particular, we'll need to think of $\beta$ as a matrix of transmission rates.</span>
<span id="cb49-470"><a href="#cb49-470" aria-hidden="true" tabindex="-1"></a>Let's see how to define such a matrix in **R**.</span>
<span id="cb49-471"><a href="#cb49-471" aria-hidden="true" tabindex="-1"></a>So that we don't change too many things all at once, let's keep the same contact structure as in the juvenile-adult model.</span>
<span id="cb49-472"><a href="#cb49-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-473"><a href="#cb49-473" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=TRUE, results='show', fig.show='show'}</span></span>
<span id="cb49-474"><a href="#cb49-474" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-475"><a href="#cb49-475" aria-hidden="true" tabindex="-1"></a>b1_ages <span class="ot">&lt;-</span> <span class="fl">0.02</span>  <span class="co">#transmission rate</span></span>
<span id="cb49-476"><a href="#cb49-476" aria-hidden="true" tabindex="-1"></a>b2_ages <span class="ot">&lt;-</span> <span class="fl">0.01</span>  <span class="co">#transmission rate</span></span>
<span id="cb49-477"><a href="#cb49-477" aria-hidden="true" tabindex="-1"></a>gamma_ages <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb49-478"><a href="#cb49-478" aria-hidden="true" tabindex="-1"></a>births_ages <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb49-479"><a href="#cb49-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-480"><a href="#cb49-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-481"><a href="#cb49-481" aria-hidden="true" tabindex="-1"></a>ages <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">seq</span>(<span class="dv">1</span>,<span class="dv">20</span>,<span class="at">by=</span><span class="dv">1</span>),<span class="fu">seq</span>(<span class="dv">25</span>,<span class="dv">65</span>,<span class="at">by=</span><span class="dv">5</span>),<span class="dv">80</span>) <span class="co"># upper end of age classes</span></span>
<span id="cb49-482"><a href="#cb49-482" aria-hidden="true" tabindex="-1"></a>da_ages <span class="ot">&lt;-</span> <span class="fu">diff</span>(<span class="fu">c</span>(<span class="dv">0</span>,ages))                        <span class="co"># widths of age classes</span></span>
<span id="cb49-483"><a href="#cb49-483" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-484"><a href="#cb49-484" aria-hidden="true" tabindex="-1"></a><span class="co"># set up a matrix of contact rates between classes -- more contact within juveniles and adults than between</span></span>
<span id="cb49-485"><a href="#cb49-485" aria-hidden="true" tabindex="-1"></a>beta_ages <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">nrow=</span><span class="dv">30</span>,<span class="at">ncol=</span><span class="dv">30</span>)    </span>
<span id="cb49-486"><a href="#cb49-486" aria-hidden="true" tabindex="-1"></a>beta_ages[<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>] <span class="ot">&lt;-</span> b1_ages <span class="co"># transmission rate for juveniles </span></span>
<span id="cb49-487"><a href="#cb49-487" aria-hidden="true" tabindex="-1"></a>beta_ages[<span class="dv">21</span><span class="sc">:</span><span class="dv">30</span>,<span class="dv">21</span><span class="sc">:</span><span class="dv">30</span>] <span class="ot">&lt;-</span> b2_ages <span class="co"># transmission rate for adults</span></span>
<span id="cb49-488"><a href="#cb49-488" aria-hidden="true" tabindex="-1"></a>beta_ages[<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>,<span class="dv">21</span><span class="sc">:</span><span class="dv">30</span>] <span class="ot">&lt;-</span> b2_ages<span class="sc">/</span><span class="dv">2</span> <span class="co"># lower transmission rate between juveniles and adults</span></span>
<span id="cb49-489"><a href="#cb49-489" aria-hidden="true" tabindex="-1"></a>beta_ages[<span class="dv">21</span><span class="sc">:</span><span class="dv">30</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>] <span class="ot">&lt;-</span> b2_ages<span class="sc">/</span><span class="dv">2</span> <span class="co"># lower transmission rate between juveniles and adults</span></span>
<span id="cb49-490"><a href="#cb49-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-491"><a href="#cb49-491" aria-hidden="true" tabindex="-1"></a><span class="co">#WAIFW stands for Who Aquires Infection From Whom</span></span>
<span id="cb49-492"><a href="#cb49-492" aria-hidden="true" tabindex="-1"></a><span class="fu">filled.contour</span>(ages, ages, beta_ages,                </span>
<span id="cb49-493"><a href="#cb49-493" aria-hidden="true" tabindex="-1"></a>               <span class="at">plot.title=</span><span class="fu">title</span>(</span>
<span id="cb49-494"><a href="#cb49-494" aria-hidden="true" tabindex="-1"></a>                 <span class="at">main=</span><span class="st">"WAIFW matrix"</span>,      </span>
<span id="cb49-495"><a href="#cb49-495" aria-hidden="true" tabindex="-1"></a>                 <span class="at">xlab=</span><span class="st">"age"</span>,<span class="at">ylab=</span><span class="st">"age"</span>))</span>
<span id="cb49-496"><a href="#cb49-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-497"><a href="#cb49-497" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-498"><a href="#cb49-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-499"><a href="#cb49-499" aria-hidden="true" tabindex="-1"></a>We'll assume that, at the time of introduction, all children are susceptible, as are adults over 45, but that individuals aged 20--45 have seen the pathogen before and are immune.</span>
<span id="cb49-500"><a href="#cb49-500" aria-hidden="true" tabindex="-1"></a>The vector <span class="in">`yinit`</span> expresses these initial conditions.</span>
<span id="cb49-501"><a href="#cb49-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-504"><a href="#cb49-504" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb49-505"><a href="#cb49-505" aria-hidden="true" tabindex="-1"></a>yinit_ages <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb49-506"><a href="#cb49-506" aria-hidden="true" tabindex="-1"></a>           <span class="at">S=</span><span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">100</span>,<span class="dv">20</span>),<span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">5</span>),<span class="fu">rep</span>(<span class="dv">200</span>,<span class="dv">5</span>)),</span>
<span id="cb49-507"><a href="#cb49-507" aria-hidden="true" tabindex="-1"></a>           <span class="at">I=</span><span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">25</span>),<span class="dv">1</span>,<span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">4</span>)),</span>
<span id="cb49-508"><a href="#cb49-508" aria-hidden="true" tabindex="-1"></a>           <span class="at">R=</span><span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">20</span>),<span class="fu">rep</span>(<span class="dv">1000</span>,<span class="dv">5</span>),<span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">5</span>))</span>
<span id="cb49-509"><a href="#cb49-509" aria-hidden="true" tabindex="-1"></a>           )</span>
<span id="cb49-510"><a href="#cb49-510" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-511"><a href="#cb49-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-512"><a href="#cb49-512" aria-hidden="true" tabindex="-1"></a>Note that we're starting out with 1 infected individual in the 26th age class.</span>
<span id="cb49-513"><a href="#cb49-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-514"><a href="#cb49-514" aria-hidden="true" tabindex="-1"></a>The codes that follow will be a bit easier to follow if we introduce some indexes that will allow us to pick out certain bits of the <span class="in">`yinit`</span> vector.</span>
<span id="cb49-515"><a href="#cb49-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-518"><a href="#cb49-518" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb49-519"><a href="#cb49-519" aria-hidden="true" tabindex="-1"></a>sindex <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">30</span></span>
<span id="cb49-520"><a href="#cb49-520" aria-hidden="true" tabindex="-1"></a>iindex <span class="ot">&lt;-</span> <span class="dv">31</span><span class="sc">:</span><span class="dv">60</span></span>
<span id="cb49-521"><a href="#cb49-521" aria-hidden="true" tabindex="-1"></a>rindex <span class="ot">&lt;-</span> <span class="dv">61</span><span class="sc">:</span><span class="dv">90</span></span>
<span id="cb49-522"><a href="#cb49-522" aria-hidden="true" tabindex="-1"></a>juvies <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span></span>
<span id="cb49-523"><a href="#cb49-523" aria-hidden="true" tabindex="-1"></a>adults <span class="ot">&lt;-</span> <span class="dv">21</span><span class="sc">:</span><span class="dv">30</span></span>
<span id="cb49-524"><a href="#cb49-524" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-525"><a href="#cb49-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-526"><a href="#cb49-526" aria-hidden="true" tabindex="-1"></a>Now, to capture the aging process, it's convenient to define another matrix to hold the rates of movement between age classes.</span>
<span id="cb49-527"><a href="#cb49-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-530"><a href="#cb49-530" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb49-531"><a href="#cb49-531" aria-hidden="true" tabindex="-1"></a>aging <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="sc">-</span><span class="dv">1</span><span class="sc">/</span>da_ages)</span>
<span id="cb49-532"><a href="#cb49-532" aria-hidden="true" tabindex="-1"></a>aging[<span class="fu">row</span>(aging)<span class="sc">-</span><span class="fu">col</span>(aging)<span class="sc">==</span><span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span><span class="fu">head</span>(da_ages,<span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb49-533"><a href="#cb49-533" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-534"><a href="#cb49-534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-535"><a href="#cb49-535" aria-hidden="true" tabindex="-1"></a>Have a look at the aging matrix, for example by doing:</span>
<span id="cb49-536"><a href="#cb49-536" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-537"><a href="#cb49-537" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE, fig.show='hide'}</span></span>
<span id="cb49-538"><a href="#cb49-538" aria-hidden="true" tabindex="-1"></a><span class="co"># move fast through the 1-year age classes - negatives are moves out, positives are moves in</span></span>
<span id="cb49-539"><a href="#cb49-539" aria-hidden="true" tabindex="-1"></a>aging[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>] </span>
<span id="cb49-540"><a href="#cb49-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-541"><a href="#cb49-541" aria-hidden="true" tabindex="-1"></a><span class="co"># don't age between these classes -- e.g. can't age from 1 to 6</span></span>
<span id="cb49-542"><a href="#cb49-542" aria-hidden="true" tabindex="-1"></a>aging[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,<span class="dv">6</span><span class="sc">:</span><span class="dv">10</span>] </span>
<span id="cb49-543"><a href="#cb49-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-544"><a href="#cb49-544" aria-hidden="true" tabindex="-1"></a><span class="co"># move slowly between the wider age classes</span></span>
<span id="cb49-545"><a href="#cb49-545" aria-hidden="true" tabindex="-1"></a>aging[<span class="dv">25</span><span class="sc">:</span><span class="dv">30</span>,<span class="dv">25</span><span class="sc">:</span><span class="dv">30</span>] </span>
<span id="cb49-546"><a href="#cb49-546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-547"><a href="#cb49-547" aria-hidden="true" tabindex="-1"></a><span class="co">#plot the aging matrix</span></span>
<span id="cb49-548"><a href="#cb49-548" aria-hidden="true" tabindex="-1"></a><span class="fu">filled.contour</span>(ages, ages, aging,                </span>
<span id="cb49-549"><a href="#cb49-549" aria-hidden="true" tabindex="-1"></a>               <span class="at">plot.title=</span><span class="fu">title</span>(</span>
<span id="cb49-550"><a href="#cb49-550" aria-hidden="true" tabindex="-1"></a>                 <span class="at">main=</span><span class="st">"Aging matrix"</span>,</span>
<span id="cb49-551"><a href="#cb49-551" aria-hidden="true" tabindex="-1"></a>                 <span class="at">xlab=</span><span class="st">"age"</span>,<span class="at">ylab=</span><span class="st">"age"</span>))</span>
<span id="cb49-552"><a href="#cb49-552" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-553"><a href="#cb49-553" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-554"><a href="#cb49-554" aria-hidden="true" tabindex="-1"></a><span class="fu">### Exercise 2: What can you say about its structure? How are the different age groups in contact with each other?</span></span>
<span id="cb49-555"><a href="#cb49-555" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-556"><a href="#cb49-556" aria-hidden="true" tabindex="-1"></a>Now we can put the pieces together to write a simulator for the age-structured SIR dynamics.</span>
<span id="cb49-557"><a href="#cb49-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-560"><a href="#cb49-560" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb49-561"><a href="#cb49-561" aria-hidden="true" tabindex="-1"></a>ja.multistage.model <span class="ot">&lt;-</span> <span class="cf">function</span> (t, x, ...) {</span>
<span id="cb49-562"><a href="#cb49-562" aria-hidden="true" tabindex="-1"></a>  s <span class="ot">&lt;-</span> x[sindex]                  <span class="co"># susceptibles</span></span>
<span id="cb49-563"><a href="#cb49-563" aria-hidden="true" tabindex="-1"></a>  i <span class="ot">&lt;-</span> x[iindex]                  <span class="co"># infecteds</span></span>
<span id="cb49-564"><a href="#cb49-564" aria-hidden="true" tabindex="-1"></a>  r <span class="ot">&lt;-</span> x[rindex]                  <span class="co"># recovereds</span></span>
<span id="cb49-565"><a href="#cb49-565" aria-hidden="true" tabindex="-1"></a>  lambda <span class="ot">&lt;-</span> beta_ages<span class="sc">%*%</span>i              <span class="co"># force of infection</span></span>
<span id="cb49-566"><a href="#cb49-566" aria-hidden="true" tabindex="-1"></a>  dsdt <span class="ot">&lt;-</span> <span class="sc">-</span>lambda<span class="sc">*</span>s<span class="sc">+</span>aging<span class="sc">%*%</span>s</span>
<span id="cb49-567"><a href="#cb49-567" aria-hidden="true" tabindex="-1"></a>  didt <span class="ot">&lt;-</span>  lambda<span class="sc">*</span>s<span class="sc">+</span>aging<span class="sc">%*%</span>i<span class="sc">-</span>gamma_ages<span class="sc">*</span>i</span>
<span id="cb49-568"><a href="#cb49-568" aria-hidden="true" tabindex="-1"></a>  drdt <span class="ot">&lt;-</span>           aging<span class="sc">%*%</span>r<span class="sc">+</span>gamma_ages<span class="sc">*</span>i </span>
<span id="cb49-569"><a href="#cb49-569" aria-hidden="true" tabindex="-1"></a>  dsdt[<span class="dv">1</span>] <span class="ot">&lt;-</span> dsdt[<span class="dv">1</span>]<span class="sc">+</span>births_ages</span>
<span id="cb49-570"><a href="#cb49-570" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb49-571"><a href="#cb49-571" aria-hidden="true" tabindex="-1"></a>       <span class="fu">c</span>(</span>
<span id="cb49-572"><a href="#cb49-572" aria-hidden="true" tabindex="-1"></a>         dsdt,</span>
<span id="cb49-573"><a href="#cb49-573" aria-hidden="true" tabindex="-1"></a>         didt,</span>
<span id="cb49-574"><a href="#cb49-574" aria-hidden="true" tabindex="-1"></a>         drdt</span>
<span id="cb49-575"><a href="#cb49-575" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb49-576"><a href="#cb49-576" aria-hidden="true" tabindex="-1"></a>       )</span>
<span id="cb49-577"><a href="#cb49-577" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb49-578"><a href="#cb49-578" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb49-579"><a href="#cb49-579" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-580"><a href="#cb49-580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-581"><a href="#cb49-581" aria-hidden="true" tabindex="-1"></a>We can plug this into <span class="in">`ode`</span> just as we did the simpler models to simulate an epidemic.</span>
<span id="cb49-582"><a href="#cb49-582" aria-hidden="true" tabindex="-1"></a>We'll then plot the epidemic curve.</span>
<span id="cb49-583"><a href="#cb49-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-584"><a href="#cb49-584" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, results='hide', fig.show='hide'}</span></span>
<span id="cb49-585"><a href="#cb49-585" aria-hidden="true" tabindex="-1"></a>sol_ms <span class="ot">&lt;-</span> deSolve<span class="sc">::</span><span class="fu">ode</span>(</span>
<span id="cb49-586"><a href="#cb49-586" aria-hidden="true" tabindex="-1"></a>           <span class="at">y=</span>yinit_ages,</span>
<span id="cb49-587"><a href="#cb49-587" aria-hidden="true" tabindex="-1"></a>           <span class="at">times=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">100</span>,<span class="at">by=</span><span class="fl">0.1</span>),</span>
<span id="cb49-588"><a href="#cb49-588" aria-hidden="true" tabindex="-1"></a>           <span class="at">func=</span>ja.multistage.model,</span>
<span id="cb49-589"><a href="#cb49-589" aria-hidden="true" tabindex="-1"></a>           <span class="at">parms =</span> <span class="fu">c</span>(<span class="at">beta_ages =</span> beta_ages, <span class="at">aging=</span>aging, <span class="at">births_ages =</span> births_ages)</span>
<span id="cb49-590"><a href="#cb49-590" aria-hidden="true" tabindex="-1"></a>           )</span>
<span id="cb49-591"><a href="#cb49-591" aria-hidden="true" tabindex="-1"></a>time_ms <span class="ot">&lt;-</span> sol_ms[,<span class="dv">1</span>]</span>
<span id="cb49-592"><a href="#cb49-592" aria-hidden="true" tabindex="-1"></a>infects_ms <span class="ot">&lt;-</span> sol_ms[,<span class="dv">1</span><span class="sc">+</span>iindex]</span>
<span id="cb49-593"><a href="#cb49-593" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(time_ms,<span class="fu">apply</span>(infects_ms,<span class="dv">1</span>,sum),<span class="at">type=</span><span class="st">'l'</span>)</span>
<span id="cb49-594"><a href="#cb49-594" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(time_ms,<span class="fu">apply</span>(infects_ms[,juvies],<span class="dv">1</span>,sum),<span class="at">col=</span><span class="st">'red'</span>)</span>
<span id="cb49-595"><a href="#cb49-595" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(time_ms,<span class="fu">apply</span>(infects_ms[,adults],<span class="dv">1</span>,sum),<span class="at">col=</span><span class="st">'blue'</span>)</span>
<span id="cb49-596"><a href="#cb49-596" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-597"><a href="#cb49-597" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-598"><a href="#cb49-598" aria-hidden="true" tabindex="-1"></a>Let's mimic a situation where we have cross-sectional seroprevalence data (e.g. measures of antibodies that tell you someone is in the R class).</span>
<span id="cb49-599"><a href="#cb49-599" aria-hidden="true" tabindex="-1"></a>In using such data, we'd typically assume that the system was at equilibrium.</span>
<span id="cb49-600"><a href="#cb49-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-601"><a href="#cb49-601" aria-hidden="true" tabindex="-1"></a><span class="fu">### Exercise 3: What does the equilibrium age-specific seroprevalence look like in this example?</span></span>
<span id="cb49-602"><a href="#cb49-602" aria-hidden="true" tabindex="-1"></a>Use the code below to display the age-specific seroprevalence (i.e., the seroprevalence for each age group at equilibrium)</span>
<span id="cb49-603"><a href="#cb49-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-604"><a href="#cb49-604" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, fig.show='hide'}</span></span>
<span id="cb49-605"><a href="#cb49-605" aria-hidden="true" tabindex="-1"></a>equil_ms <span class="ot">&lt;-</span> <span class="fu">drop</span>(<span class="fu">tail</span>(sol_ms,<span class="dv">1</span>))[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb49-606"><a href="#cb49-606" aria-hidden="true" tabindex="-1"></a>n_ms <span class="ot">&lt;-</span> equil_ms[sindex]<span class="sc">+</span>equil_ms[iindex]<span class="sc">+</span>equil_ms[rindex]</span>
<span id="cb49-607"><a href="#cb49-607" aria-hidden="true" tabindex="-1"></a>seroprev_ms <span class="ot">&lt;-</span> equil_ms[rindex]<span class="sc">/</span>n_ms</span>
<span id="cb49-608"><a href="#cb49-608" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(seroprev_ms) <span class="ot">&lt;-</span> ages</span>
<span id="cb49-609"><a href="#cb49-609" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(<span class="at">height=</span>seroprev_ms,<span class="at">width=</span>da_ages)</span>
<span id="cb49-610"><a href="#cb49-610" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-611"><a href="#cb49-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-612"><a href="#cb49-612" aria-hidden="true" tabindex="-1"></a>Let's also compute $R_0$.</span>
<span id="cb49-613"><a href="#cb49-613" aria-hidden="true" tabindex="-1"></a>To do so, we'll need the stable age distribution.</span>
<span id="cb49-614"><a href="#cb49-614" aria-hidden="true" tabindex="-1"></a>We can get that by simulating an infection-free population, which we get by setting the initial I to all 0s:</span>
<span id="cb49-615"><a href="#cb49-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-616"><a href="#cb49-616" aria-hidden="true" tabindex="-1"></a><span class="in">```{r,results='hide', fig.show='hide'}</span></span>
<span id="cb49-617"><a href="#cb49-617" aria-hidden="true" tabindex="-1"></a>yinit.sonly <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb49-618"><a href="#cb49-618" aria-hidden="true" tabindex="-1"></a>                 <span class="at">S=</span><span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">250</span>,<span class="dv">30</span>)),</span>
<span id="cb49-619"><a href="#cb49-619" aria-hidden="true" tabindex="-1"></a>                 <span class="at">I=</span><span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">30</span>)),</span>
<span id="cb49-620"><a href="#cb49-620" aria-hidden="true" tabindex="-1"></a>                 <span class="at">R=</span><span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">30</span>))</span>
<span id="cb49-621"><a href="#cb49-621" aria-hidden="true" tabindex="-1"></a>                 )</span>
<span id="cb49-622"><a href="#cb49-622" aria-hidden="true" tabindex="-1"></a>sol_sonly <span class="ot">&lt;-</span> deSolve<span class="sc">::</span><span class="fu">ode</span>(</span>
<span id="cb49-623"><a href="#cb49-623" aria-hidden="true" tabindex="-1"></a>           <span class="at">y=</span>yinit.sonly,</span>
<span id="cb49-624"><a href="#cb49-624" aria-hidden="true" tabindex="-1"></a>           <span class="at">times=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">300</span>,<span class="at">by=</span><span class="dv">1</span>),</span>
<span id="cb49-625"><a href="#cb49-625" aria-hidden="true" tabindex="-1"></a>           <span class="at">func=</span>ja.multistage.model,</span>
<span id="cb49-626"><a href="#cb49-626" aria-hidden="true" tabindex="-1"></a>           <span class="at">parms =</span> <span class="fu">c</span>(<span class="at">beta=</span>beta, <span class="at">aging=</span>aging, <span class="at">births=</span>births_demog)</span>
<span id="cb49-627"><a href="#cb49-627" aria-hidden="true" tabindex="-1"></a>           )</span>
<span id="cb49-628"><a href="#cb49-628" aria-hidden="true" tabindex="-1"></a>time_sonly <span class="ot">&lt;-</span> sol_sonly[,<span class="dv">1</span>]</span>
<span id="cb49-629"><a href="#cb49-629" aria-hidden="true" tabindex="-1"></a>pop <span class="ot">&lt;-</span> <span class="fu">apply</span>(sol_sonly[,<span class="sc">-</span><span class="dv">1</span>],<span class="dv">1</span>,sum)</span>
<span id="cb49-630"><a href="#cb49-630" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(time_sonly,pop,<span class="at">type=</span><span class="st">'l'</span>)</span>
<span id="cb49-631"><a href="#cb49-631" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-632"><a href="#cb49-632" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-633"><a href="#cb49-633" aria-hidden="true" tabindex="-1"></a>Alternatively, we can get the stable age distribution by finding the population structure that balances the birth, aging, and death processes.</span>
<span id="cb49-634"><a href="#cb49-634" aria-hidden="true" tabindex="-1"></a>At equilibrium, we have the matrix equation $$</span>
<span id="cb49-635"><a href="#cb49-635" aria-hidden="true" tabindex="-1"></a> \begin{pmatrix}</span>
<span id="cb49-636"><a href="#cb49-636" aria-hidden="true" tabindex="-1"></a>    -\alpha_1 &amp; 0 &amp; 0 &amp; \cdots &amp; 0<span class="sc">\\</span></span>
<span id="cb49-637"><a href="#cb49-637" aria-hidden="true" tabindex="-1"></a>    \alpha_1 &amp; -\alpha_2 &amp; 0 &amp; \cdots &amp; 0<span class="sc">\\</span></span>
<span id="cb49-638"><a href="#cb49-638" aria-hidden="true" tabindex="-1"></a>    0 &amp; \alpha_2 &amp; -\alpha_3 &amp; \cdots &amp; 0<span class="sc">\\</span></span>
<span id="cb49-639"><a href="#cb49-639" aria-hidden="true" tabindex="-1"></a>    \vdots &amp;  &amp; \ddots &amp; \ddots &amp; \vdots <span class="sc">\\</span></span>
<span id="cb49-640"><a href="#cb49-640" aria-hidden="true" tabindex="-1"></a>    0 &amp; \cdots &amp; &amp; \alpha_{29} &amp; -\alpha_{30}<span class="sc">\\</span></span>
<span id="cb49-641"><a href="#cb49-641" aria-hidden="true" tabindex="-1"></a>  \end{pmatrix} . \begin{pmatrix}</span>
<span id="cb49-642"><a href="#cb49-642" aria-hidden="true" tabindex="-1"></a>    n_1 <span class="sc">\\</span> n_2 <span class="sc">\\</span> n_3 <span class="sc">\\</span> \vdots <span class="sc">\\</span> n_{30}</span>
<span id="cb49-643"><a href="#cb49-643" aria-hidden="true" tabindex="-1"></a>  \end{pmatrix} + \begin{pmatrix}</span>
<span id="cb49-644"><a href="#cb49-644" aria-hidden="true" tabindex="-1"></a>    B <span class="sc">\\</span> 0 <span class="sc">\\</span> 0 <span class="sc">\\</span> \vdots <span class="sc">\\</span> 0</span>
<span id="cb49-645"><a href="#cb49-645" aria-hidden="true" tabindex="-1"></a>  \end{pmatrix}=</span>
<span id="cb49-646"><a href="#cb49-646" aria-hidden="true" tabindex="-1"></a>  \begin{pmatrix}</span>
<span id="cb49-647"><a href="#cb49-647" aria-hidden="true" tabindex="-1"></a>    0 <span class="sc">\\</span> 0 <span class="sc">\\</span> 0 <span class="sc">\\</span> \vdots <span class="sc">\\</span> 0</span>
<span id="cb49-648"><a href="#cb49-648" aria-hidden="true" tabindex="-1"></a>  \end{pmatrix}</span>
<span id="cb49-649"><a href="#cb49-649" aria-hidden="true" tabindex="-1"></a>$$ To solve this equation in **R**, we can do</span>
<span id="cb49-650"><a href="#cb49-650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-653"><a href="#cb49-653" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb49-654"><a href="#cb49-654" aria-hidden="true" tabindex="-1"></a><span class="do">## get stable age distribution</span></span>
<span id="cb49-655"><a href="#cb49-655" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">solve</span>(aging,<span class="sc">-</span><span class="fu">c</span>(births_ages,<span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">29</span>)))</span>
<span id="cb49-656"><a href="#cb49-656" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-657"><a href="#cb49-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-658"><a href="#cb49-658" aria-hidden="true" tabindex="-1"></a>The following lines then compute $R_0$ using the next generation matrix method. More details are available in the "Bonus" section at the end of the document.</span>
<span id="cb49-659"><a href="#cb49-659" aria-hidden="true" tabindex="-1"></a>This calculation comes from a recipe described in detail by **Diekmann &amp; Heesterbeek, 2000** and **Hurford *et. al*, 2010**.</span>
<span id="cb49-660"><a href="#cb49-660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-663"><a href="#cb49-663" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb49-664"><a href="#cb49-664" aria-hidden="true" tabindex="-1"></a>F <span class="ot">&lt;-</span> <span class="fu">diag</span>(n)<span class="sc">%*%</span>beta_ages<span class="sc">+</span>aging<span class="sc">-</span><span class="fu">diag</span>(<span class="fu">diag</span>(aging))</span>
<span id="cb49-665"><a href="#cb49-665" aria-hidden="true" tabindex="-1"></a>V <span class="ot">&lt;-</span> <span class="fu">diag</span>(gamma_ages<span class="sc">-</span><span class="fu">diag</span>(aging))</span>
<span id="cb49-666"><a href="#cb49-666" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(<span class="fu">Re</span>(<span class="fu">eigen</span>(<span class="fu">solve</span>(V,F),<span class="at">only.values=</span>T)<span class="sc">$</span>values))</span>
<span id="cb49-667"><a href="#cb49-667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-668"><a href="#cb49-668" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-669"><a href="#cb49-669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-670"><a href="#cb49-670" aria-hidden="true" tabindex="-1"></a><span class="in">```{r,echo=FALSE}</span></span>
<span id="cb49-671"><a href="#cb49-671" aria-hidden="true" tabindex="-1"></a>seroprev1 <span class="ot">&lt;-</span> seroprev</span>
<span id="cb49-672"><a href="#cb49-672" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-673"><a href="#cb49-673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-674"><a href="#cb49-674" aria-hidden="true" tabindex="-1"></a><span class="fu">### Exercise 4: </span></span>
<span id="cb49-675"><a href="#cb49-675" aria-hidden="true" tabindex="-1"></a><span class="fu">#### a. Change the juvenile and adult contact rates (b1_ages and b2_ages) to reflect different transmission within groups. Make the juvenile contact rate 0.02 to reflect higher contact among kids (e.g. in schools).</span></span>
<span id="cb49-676"><a href="#cb49-676" aria-hidden="true" tabindex="-1"></a><span class="fu">#### b. Use `image` or `filled.contour` to plot the $\beta$ matrix.</span></span>
<span id="cb49-677"><a href="#cb49-677" aria-hidden="true" tabindex="-1"></a><span class="fu">#### c. Compute $R_0$ for your assumptions.</span></span>
<span id="cb49-678"><a href="#cb49-678" aria-hidden="true" tabindex="-1"></a><span class="fu">#### d. Simulate and plot the age-structured SIR dynamics under your assumptions and record how the age-specific seroprevalence has changed.</span></span>
<span id="cb49-679"><a href="#cb49-679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-680"><a href="#cb49-680" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE,results='hide', fig.show='hide'}</span></span>
<span id="cb49-681"><a href="#cb49-681" aria-hidden="true" tabindex="-1"></a>b1_r <span class="ot">&lt;-</span> <span class="fl">0.007</span></span>
<span id="cb49-682"><a href="#cb49-682" aria-hidden="true" tabindex="-1"></a>b2_r <span class="ot">&lt;-</span> <span class="fl">0.02</span></span>
<span id="cb49-683"><a href="#cb49-683" aria-hidden="true" tabindex="-1"></a>b3_r <span class="ot">&lt;-</span> <span class="fl">0.03</span></span>
<span id="cb49-684"><a href="#cb49-684" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data=</span>b1_r,<span class="at">nrow=</span><span class="dv">30</span>,<span class="at">ncol=</span><span class="dv">30</span>)</span>
<span id="cb49-685"><a href="#cb49-685" aria-hidden="true" tabindex="-1"></a>beta[<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>] <span class="ot">&lt;-</span> b2_r</span>
<span id="cb49-686"><a href="#cb49-686" aria-hidden="true" tabindex="-1"></a>beta[<span class="dv">6</span><span class="sc">:</span><span class="dv">16</span>,<span class="dv">6</span><span class="sc">:</span><span class="dv">16</span>] <span class="ot">&lt;-</span> b3_r</span>
<span id="cb49-687"><a href="#cb49-687" aria-hidden="true" tabindex="-1"></a>beta_ages <span class="ot">&lt;-</span> beta</span>
<span id="cb49-688"><a href="#cb49-688" aria-hidden="true" tabindex="-1"></a><span class="fu">filled.contour</span>(ages, ages, beta_ages,                </span>
<span id="cb49-689"><a href="#cb49-689" aria-hidden="true" tabindex="-1"></a>               <span class="at">plot.title=</span><span class="fu">title</span>(</span>
<span id="cb49-690"><a href="#cb49-690" aria-hidden="true" tabindex="-1"></a>                 <span class="at">main=</span><span class="st">"WAIFW matrix"</span>,</span>
<span id="cb49-691"><a href="#cb49-691" aria-hidden="true" tabindex="-1"></a>                 <span class="at">xlab=</span><span class="st">"age"</span>,<span class="at">ylab=</span><span class="st">"age"</span>))</span>
<span id="cb49-692"><a href="#cb49-692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-693"><a href="#cb49-693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-694"><a href="#cb49-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-695"><a href="#cb49-695" aria-hidden="true" tabindex="-1"></a>sol_r <span class="ot">&lt;-</span> deSolve<span class="sc">::</span><span class="fu">ode</span>(</span>
<span id="cb49-696"><a href="#cb49-696" aria-hidden="true" tabindex="-1"></a>           <span class="at">y=</span>yinit_ages,</span>
<span id="cb49-697"><a href="#cb49-697" aria-hidden="true" tabindex="-1"></a>           <span class="at">times=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">400</span>,<span class="at">by=</span><span class="fl">0.1</span>),</span>
<span id="cb49-698"><a href="#cb49-698" aria-hidden="true" tabindex="-1"></a>           <span class="at">func=</span>ja.multistage.model,</span>
<span id="cb49-699"><a href="#cb49-699" aria-hidden="true" tabindex="-1"></a>           <span class="at">parms =</span> <span class="fu">c</span>(<span class="at">beta_ages=</span>beta_ages, <span class="at">aging=</span>aging, <span class="at">births_ages=</span>births_ages)</span>
<span id="cb49-700"><a href="#cb49-700" aria-hidden="true" tabindex="-1"></a>           )</span>
<span id="cb49-701"><a href="#cb49-701" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-702"><a href="#cb49-702" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sol_r[,<span class="dv">1</span>],<span class="fu">apply</span>(sol_r[,<span class="dv">1</span><span class="sc">+</span>iindex],<span class="dv">1</span>,sum),<span class="at">type=</span><span class="st">'l'</span>)</span>
<span id="cb49-703"><a href="#cb49-703" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(sol_r[,<span class="dv">1</span>],<span class="fu">apply</span>(sol_r[,<span class="dv">1</span><span class="sc">+</span>iindex[juvies]],<span class="dv">1</span>,sum),<span class="at">col=</span><span class="st">'red'</span>)</span>
<span id="cb49-704"><a href="#cb49-704" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(sol_r[,<span class="dv">1</span>],<span class="fu">apply</span>(sol_r[,<span class="dv">1</span><span class="sc">+</span>iindex[adults]],<span class="dv">1</span>,sum),<span class="at">col=</span><span class="st">'blue'</span>)</span>
<span id="cb49-705"><a href="#cb49-705" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-706"><a href="#cb49-706" aria-hidden="true" tabindex="-1"></a>equil_r <span class="ot">&lt;-</span> <span class="fu">drop</span>(<span class="fu">tail</span>(sol_r,<span class="dv">1</span>))[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb49-707"><a href="#cb49-707" aria-hidden="true" tabindex="-1"></a>n_r <span class="ot">&lt;-</span> equil_r[sindex]<span class="sc">+</span>equil_r[iindex]<span class="sc">+</span>equil_r[rindex]</span>
<span id="cb49-708"><a href="#cb49-708" aria-hidden="true" tabindex="-1"></a>seroprev_r <span class="ot">&lt;-</span> equil_r[rindex]<span class="sc">/</span>n_r</span>
<span id="cb49-709"><a href="#cb49-709" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(seroprev_r) <span class="ot">&lt;-</span> ages</span>
<span id="cb49-710"><a href="#cb49-710" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(<span class="at">height=</span>seroprev_r,<span class="at">width=</span>da_ages)</span>
<span id="cb49-711"><a href="#cb49-711" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-712"><a href="#cb49-712" aria-hidden="true" tabindex="-1"></a><span class="do">## get stable age distribution</span></span>
<span id="cb49-713"><a href="#cb49-713" aria-hidden="true" tabindex="-1"></a>n_r <span class="ot">&lt;-</span> <span class="fu">solve</span>(aging,<span class="sc">-</span><span class="fu">c</span>(births_ages,<span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">29</span>)))</span>
<span id="cb49-714"><a href="#cb49-714" aria-hidden="true" tabindex="-1"></a><span class="do">## get R0</span></span>
<span id="cb49-715"><a href="#cb49-715" aria-hidden="true" tabindex="-1"></a>F <span class="ot">&lt;-</span> <span class="fu">diag</span>(n_r)<span class="sc">%*%</span>beta_ages<span class="sc">+</span>aging<span class="sc">-</span><span class="fu">diag</span>(<span class="fu">diag</span>(aging))</span>
<span id="cb49-716"><a href="#cb49-716" aria-hidden="true" tabindex="-1"></a>V <span class="ot">&lt;-</span> <span class="fu">diag</span>(gamma_ages<span class="sc">-</span><span class="fu">diag</span>(aging))</span>
<span id="cb49-717"><a href="#cb49-717" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(<span class="fu">Re</span>(<span class="fu">eigen</span>(<span class="fu">solve</span>(V,F),<span class="at">only.values=</span>T)<span class="sc">$</span>values))</span>
<span id="cb49-718"><a href="#cb49-718" aria-hidden="true" tabindex="-1"></a><span class="co"># R0 = 6.53</span></span>
<span id="cb49-719"><a href="#cb49-719" aria-hidden="true" tabindex="-1"></a>infects_r <span class="ot">&lt;-</span> sol_r[<span class="fu">dim</span>(sol_r)[<span class="dv">1</span>],<span class="dv">1</span><span class="sc">+</span>iindex]</span>
<span id="cb49-720"><a href="#cb49-720" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(ages <span class="sc">*</span> infects_r<span class="sc">/</span><span class="fu">sum</span>(infects_r))</span>
<span id="cb49-721"><a href="#cb49-721" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(infects_r[<span class="dv">15</span><span class="sc">:</span><span class="dv">23</span>])</span>
<span id="cb49-722"><a href="#cb49-722" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-723"><a href="#cb49-723" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-724"><a href="#cb49-724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-725"><a href="#cb49-725" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo = FALSE}</span></span>
<span id="cb49-726"><a href="#cb49-726" aria-hidden="true" tabindex="-1"></a>seroprev2 <span class="ot">&lt;-</span> seroprev</span>
<span id="cb49-727"><a href="#cb49-727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-728"><a href="#cb49-728" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-729"><a href="#cb49-729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-730"><a href="#cb49-730" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE, echo=FALSE, fig.show='hide'}</span></span>
<span id="cb49-731"><a href="#cb49-731" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(ggplot2)</span>
<span id="cb49-732"><a href="#cb49-732" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(reshape)</span>
<span id="cb49-733"><a href="#cb49-733" aria-hidden="true" tabindex="-1"></a>sol_r <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(sol_r)</span>
<span id="cb49-734"><a href="#cb49-734" aria-hidden="true" tabindex="-1"></a>sol_rm <span class="ot">&lt;-</span> <span class="fu">melt</span>(sol_r,<span class="at">id=</span><span class="st">"time"</span>)</span>
<span id="cb49-735"><a href="#cb49-735" aria-hidden="true" tabindex="-1"></a>sol_rm<span class="sc">$</span>class <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">substr</span>(<span class="fu">as.character</span>(sol_rm<span class="sc">$</span>variable),<span class="at">start=</span><span class="dv">1</span>,<span class="at">stop=</span><span class="dv">1</span>))</span>
<span id="cb49-736"><a href="#cb49-736" aria-hidden="true" tabindex="-1"></a>sol_rm<span class="sc">$</span>age <span class="ot">&lt;-</span> ages[<span class="fu">as.integer</span>(<span class="fu">substr</span>(<span class="fu">as.character</span>(sol_rm<span class="sc">$</span>variable),<span class="dv">2</span>,<span class="at">stop=</span><span class="dv">5</span>))]</span>
<span id="cb49-737"><a href="#cb49-737" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>sol_rm)<span class="sc">+</span><span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>time,<span class="at">y=</span>value,<span class="at">col=</span>age,<span class="at">group=</span>age))<span class="sc">+</span><span class="fu">facet_grid</span>(class<span class="sc">~</span>.,<span class="at">scales=</span><span class="st">"free"</span>)</span>
<span id="cb49-738"><a href="#cb49-738" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-739"><a href="#cb49-739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-740"><a href="#cb49-740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-741"><a href="#cb49-741" aria-hidden="true" tabindex="-1"></a><span class="fu">## R0 and the mean age of infection</span></span>
<span id="cb49-742"><a href="#cb49-742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-743"><a href="#cb49-743" aria-hidden="true" tabindex="-1"></a>For simplicity, let's return to the earlier models with a simple age-class mixing matrix.</span>
<span id="cb49-744"><a href="#cb49-744" aria-hidden="true" tabindex="-1"></a>But this time, we'll calculate $R_0$, the mean age of infection, and the number of cases between 15-35 years as we increase the rate of contact. Recall from the rubella and CRS example that the risk of severe disease outcomes depends on the risk of infection in reproductive age women. Recall also that increasing vaccination reduces $R_E$ -- so here we'll evalate at several values of $R_0$ as a proxy for the impact of vaccination. We'll then calculate how the mean age of infection changes, and specifically how the absolute number of cases among individuals between the ages of 15-35 (as a proxy for reproductive age women) changes. </span>
<span id="cb49-745"><a href="#cb49-745" aria-hidden="true" tabindex="-1"></a>To do so, we'll make a loop and evaluate the code for each of 10 increasing levels of mixing (which whill change R0)</span>
<span id="cb49-746"><a href="#cb49-746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-747"><a href="#cb49-747" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=TRUE,results='hide', fig.show='hide'}</span></span>
<span id="cb49-748"><a href="#cb49-748" aria-hidden="true" tabindex="-1"></a> <span class="co"># a vector of scaling factors, we'll reduce the contact rate </span></span>
<span id="cb49-749"><a href="#cb49-749" aria-hidden="true" tabindex="-1"></a> <span class="co"># from the original code by each of the values in this vector</span></span>
<span id="cb49-750"><a href="#cb49-750" aria-hidden="true" tabindex="-1"></a>scale <span class="ot">&lt;-</span> <span class="fu">seq</span>(.<span class="dv">2</span>,<span class="dv">1</span>,<span class="at">length=</span><span class="dv">10</span>) </span>
<span id="cb49-751"><a href="#cb49-751" aria-hidden="true" tabindex="-1"></a>R0 <span class="ot">&lt;-</span> <span class="fu">numeric</span>() <span class="co"># somewhere to store results for the mean age</span></span>
<span id="cb49-752"><a href="#cb49-752" aria-hidden="true" tabindex="-1"></a>mean_age <span class="ot">&lt;-</span> <span class="fu">numeric</span>() <span class="co"># somewhere to store results for the mean age</span></span>
<span id="cb49-753"><a href="#cb49-753" aria-hidden="true" tabindex="-1"></a>sum_cases <span class="ot">&lt;-</span> <span class="fu">numeric</span>() <span class="co"># somewhere to store results for the mean age</span></span>
<span id="cb49-754"><a href="#cb49-754" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-755"><a href="#cb49-755" aria-hidden="true" tabindex="-1"></a><span class="co"># this loop will run for as many different levels of contact that we specify </span></span>
<span id="cb49-756"><a href="#cb49-756" aria-hidden="true" tabindex="-1"></a><span class="co"># for the scale variable </span></span>
<span id="cb49-757"><a href="#cb49-757" aria-hidden="true" tabindex="-1"></a><span class="co"># this is the same code as above, but now we've included a multiplier for the </span></span>
<span id="cb49-758"><a href="#cb49-758" aria-hidden="true" tabindex="-1"></a><span class="co"># contact matrix</span></span>
<span id="cb49-759"><a href="#cb49-759" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(ii <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(scale)){ </span>
<span id="cb49-760"><a href="#cb49-760" aria-hidden="true" tabindex="-1"></a>  b1 <span class="ot">&lt;-</span> <span class="fl">0.007</span></span>
<span id="cb49-761"><a href="#cb49-761" aria-hidden="true" tabindex="-1"></a>  b2 <span class="ot">&lt;-</span> <span class="fl">0.02</span></span>
<span id="cb49-762"><a href="#cb49-762" aria-hidden="true" tabindex="-1"></a>  b3 <span class="ot">&lt;-</span> <span class="fl">0.03</span></span>
<span id="cb49-763"><a href="#cb49-763" aria-hidden="true" tabindex="-1"></a>  beta <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data=</span>b1,<span class="at">nrow=</span><span class="dv">30</span>,<span class="at">ncol=</span><span class="dv">30</span>)</span>
<span id="cb49-764"><a href="#cb49-764" aria-hidden="true" tabindex="-1"></a>  beta[<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>] <span class="ot">&lt;-</span> b2</span>
<span id="cb49-765"><a href="#cb49-765" aria-hidden="true" tabindex="-1"></a>  beta[<span class="dv">6</span><span class="sc">:</span><span class="dv">16</span>,<span class="dv">6</span><span class="sc">:</span><span class="dv">16</span>] <span class="ot">&lt;-</span> b3</span>
<span id="cb49-766"><a href="#cb49-766" aria-hidden="true" tabindex="-1"></a>  beta_ages <span class="ot">&lt;-</span> beta <span class="sc">*</span> scale[ii]</span>
<span id="cb49-767"><a href="#cb49-767" aria-hidden="true" tabindex="-1"></a>  <span class="co">#filled.contour(beta)</span></span>
<span id="cb49-768"><a href="#cb49-768" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-769"><a href="#cb49-769" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb49-770"><a href="#cb49-770" aria-hidden="true" tabindex="-1"></a>  sol_R0 <span class="ot">&lt;-</span> deSolve<span class="sc">::</span><span class="fu">ode</span>(</span>
<span id="cb49-771"><a href="#cb49-771" aria-hidden="true" tabindex="-1"></a>    <span class="at">y=</span>yinit_ages,</span>
<span id="cb49-772"><a href="#cb49-772" aria-hidden="true" tabindex="-1"></a>    <span class="at">times=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">400</span>,<span class="at">by=</span><span class="fl">0.1</span>),</span>
<span id="cb49-773"><a href="#cb49-773" aria-hidden="true" tabindex="-1"></a>    <span class="at">func=</span>ja.multistage.model,</span>
<span id="cb49-774"><a href="#cb49-774" aria-hidden="true" tabindex="-1"></a>    <span class="at">parms =</span> <span class="fu">c</span>(<span class="at">beta_ages=</span>beta_ages, <span class="at">aging=</span>aging, <span class="at">births_ages=</span>births_ages)</span>
<span id="cb49-775"><a href="#cb49-775" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb49-776"><a href="#cb49-776" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb49-777"><a href="#cb49-777" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb49-778"><a href="#cb49-778" aria-hidden="true" tabindex="-1"></a>  equil_R0 <span class="ot">&lt;-</span> <span class="fu">drop</span>(<span class="fu">tail</span>(sol_R0,<span class="dv">1</span>))[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb49-779"><a href="#cb49-779" aria-hidden="true" tabindex="-1"></a>  n_R0 <span class="ot">&lt;-</span> equil_R0[sindex]<span class="sc">+</span>equil_R0[iindex]<span class="sc">+</span>equil_R0[rindex]</span>
<span id="cb49-780"><a href="#cb49-780" aria-hidden="true" tabindex="-1"></a>  seroprev_R0 <span class="ot">&lt;-</span> equil_R0[rindex]<span class="sc">/</span>n_R0</span>
<span id="cb49-781"><a href="#cb49-781" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(seroprev_R0) <span class="ot">&lt;-</span> ages</span>
<span id="cb49-782"><a href="#cb49-782" aria-hidden="true" tabindex="-1"></a>  <span class="co"># barplot(height=seroprev,width=da)</span></span>
<span id="cb49-783"><a href="#cb49-783" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb49-784"><a href="#cb49-784" aria-hidden="true" tabindex="-1"></a>  <span class="do">## get stable age distribution</span></span>
<span id="cb49-785"><a href="#cb49-785" aria-hidden="true" tabindex="-1"></a>  n_R0 <span class="ot">&lt;-</span> <span class="fu">solve</span>(aging,<span class="sc">-</span><span class="fu">c</span>(births_ages,<span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">29</span>)))</span>
<span id="cb49-786"><a href="#cb49-786" aria-hidden="true" tabindex="-1"></a>  <span class="do">## get R0</span></span>
<span id="cb49-787"><a href="#cb49-787" aria-hidden="true" tabindex="-1"></a>  F_R0 <span class="ot">&lt;-</span> <span class="fu">diag</span>(n_R0)<span class="sc">%*%</span>beta_ages<span class="sc">+</span>aging<span class="sc">-</span><span class="fu">diag</span>(<span class="fu">diag</span>(aging))</span>
<span id="cb49-788"><a href="#cb49-788" aria-hidden="true" tabindex="-1"></a>  V_R0 <span class="ot">&lt;-</span> <span class="fu">diag</span>(gamma_ages<span class="sc">-</span><span class="fu">diag</span>(aging))</span>
<span id="cb49-789"><a href="#cb49-789" aria-hidden="true" tabindex="-1"></a>  R0[ii] <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">Re</span>(<span class="fu">eigen</span>(<span class="fu">solve</span>(V_R0,F_R0),<span class="at">only.values=</span>T)<span class="sc">$</span>values))</span>
<span id="cb49-790"><a href="#cb49-790" aria-hidden="true" tabindex="-1"></a>  <span class="co"># R0 = 6.53</span></span>
<span id="cb49-791"><a href="#cb49-791" aria-hidden="true" tabindex="-1"></a>  infects_R0 <span class="ot">&lt;-</span> sol_R0[<span class="fu">dim</span>(sol_R0)[<span class="dv">1</span>],<span class="dv">1</span><span class="sc">+</span>iindex]</span>
<span id="cb49-792"><a href="#cb49-792" aria-hidden="true" tabindex="-1"></a>  mean_age[ii] <span class="ot">&lt;-</span> <span class="fu">sum</span>(ages <span class="sc">*</span> infects_R0<span class="sc">/</span><span class="fu">sum</span>(infects_R0))</span>
<span id="cb49-793"><a href="#cb49-793" aria-hidden="true" tabindex="-1"></a>  sum_cases[ii] <span class="ot">&lt;-</span> <span class="fu">sum</span>(infects_R0[<span class="dv">15</span><span class="sc">:</span><span class="dv">23</span>])</span>
<span id="cb49-794"><a href="#cb49-794" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb49-795"><a href="#cb49-795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-796"><a href="#cb49-796" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-797"><a href="#cb49-797" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-798"><a href="#cb49-798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-799"><a href="#cb49-799" aria-hidden="true" tabindex="-1"></a>Now we can make a table of the results and plot mean age and the sum of cases between 15-35 years of age as a function of $R_0$.</span>
<span id="cb49-800"><a href="#cb49-800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-803"><a href="#cb49-803" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb49-804"><a href="#cb49-804" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">R0 =</span> R0, <span class="st">"mean age"</span> <span class="ot">=</span> mean_age, <span class="st">"cases (15-35y)"</span> <span class="ot">=</span> sum_cases)</span>
<span id="cb49-805"><a href="#cb49-805" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-806"><a href="#cb49-806" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(df)</span>
<span id="cb49-807"><a href="#cb49-807" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-808"><a href="#cb49-808" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb49-809"><a href="#cb49-809" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(R0,mean_age,<span class="at">xlab=</span><span class="st">"R0"</span>,<span class="at">ylab=</span><span class="st">"mean age of infection"</span>)</span>
<span id="cb49-810"><a href="#cb49-810" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(R0,sum_cases,<span class="at">xlab=</span><span class="st">"R0"</span>,<span class="at">ylab=</span><span class="st">"total cases between 15-35y"</span>)</span>
<span id="cb49-811"><a href="#cb49-811" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-812"><a href="#cb49-812" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-813"><a href="#cb49-813" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-814"><a href="#cb49-814" aria-hidden="true" tabindex="-1"></a><span class="in">```{r echo=FALSE}</span></span>
<span id="cb49-815"><a href="#cb49-815" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb49-816"><a href="#cb49-816" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-817"><a href="#cb49-817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-818"><a href="#cb49-818" aria-hidden="true" tabindex="-1"></a><span class="fu">### Exercise 5: Try the same as you fix $R_0$ but change the birth rate (as if new infants were vaccinated), instead of changing the contact rate. </span></span>
<span id="cb49-819"><a href="#cb49-819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-820"><a href="#cb49-820" aria-hidden="true" tabindex="-1"></a>For example, if the birth rate was 100 before, try using a sequence of birth rates ranging from 100 (i.e. no new infants are vaccinated) to 75 (i.e., 25% of new infants are vaccinated). You can use the technique we used above, where we ran the simulation in a loop multiple times, for varying levels of contact, modifying it to run on varying levels of births (e.g., between 75 and 100). </span>
<span id="cb49-821"><a href="#cb49-821" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-822"><a href="#cb49-822" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo= FALSE}</span></span>
<span id="cb49-823"><a href="#cb49-823" aria-hidden="true" tabindex="-1"></a>births_seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">75</span>,<span class="dv">100</span>,<span class="at">length=</span><span class="dv">10</span>)  <span class="co"># a vector of scaling factors, we'll reduce the contact rate from the original code by each of the values in this vector</span></span>
<span id="cb49-824"><a href="#cb49-824" aria-hidden="true" tabindex="-1"></a>R0_b <span class="ot">&lt;-</span> <span class="fu">numeric</span>() <span class="co"># somewhere to store results for the mean age</span></span>
<span id="cb49-825"><a href="#cb49-825" aria-hidden="true" tabindex="-1"></a>mean_age_b <span class="ot">&lt;-</span> <span class="fu">numeric</span>() <span class="co"># somewhere to store results for the mean age</span></span>
<span id="cb49-826"><a href="#cb49-826" aria-hidden="true" tabindex="-1"></a>sum_cases_b <span class="ot">&lt;-</span> <span class="fu">numeric</span>() <span class="co"># somewhere to store results for the mean age</span></span>
<span id="cb49-827"><a href="#cb49-827" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-828"><a href="#cb49-828" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-829"><a href="#cb49-829" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb49-830"><a href="#cb49-830" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(ii <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>){</span>
<span id="cb49-831"><a href="#cb49-831" aria-hidden="true" tabindex="-1"></a><span class="co">#this is the same code as above, but now we're modifying births</span></span>
<span id="cb49-832"><a href="#cb49-832" aria-hidden="true" tabindex="-1"></a>  b1 <span class="ot">&lt;-</span> <span class="fl">0.007</span></span>
<span id="cb49-833"><a href="#cb49-833" aria-hidden="true" tabindex="-1"></a>  b2 <span class="ot">&lt;-</span> <span class="fl">0.02</span></span>
<span id="cb49-834"><a href="#cb49-834" aria-hidden="true" tabindex="-1"></a>  b3 <span class="ot">&lt;-</span> <span class="fl">0.03</span></span>
<span id="cb49-835"><a href="#cb49-835" aria-hidden="true" tabindex="-1"></a>  beta <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="at">data=</span>b1,<span class="at">nrow=</span><span class="dv">30</span>,<span class="at">ncol=</span><span class="dv">30</span>)</span>
<span id="cb49-836"><a href="#cb49-836" aria-hidden="true" tabindex="-1"></a>  beta[<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>] <span class="ot">&lt;-</span> b2</span>
<span id="cb49-837"><a href="#cb49-837" aria-hidden="true" tabindex="-1"></a>  beta[<span class="dv">6</span><span class="sc">:</span><span class="dv">16</span>,<span class="dv">6</span><span class="sc">:</span><span class="dv">16</span>] <span class="ot">&lt;-</span> b3</span>
<span id="cb49-838"><a href="#cb49-838" aria-hidden="true" tabindex="-1"></a>  beta_ages <span class="ot">&lt;-</span> beta</span>
<span id="cb49-839"><a href="#cb49-839" aria-hidden="true" tabindex="-1"></a>  births_ages <span class="ot">&lt;-</span> births_seq[ii]</span>
<span id="cb49-840"><a href="#cb49-840" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-841"><a href="#cb49-841" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-842"><a href="#cb49-842" aria-hidden="true" tabindex="-1"></a>  <span class="co">#filled.contour(beta)</span></span>
<span id="cb49-843"><a href="#cb49-843" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-844"><a href="#cb49-844" aria-hidden="true" tabindex="-1"></a>  sol_b <span class="ot">&lt;-</span> deSolve<span class="sc">::</span><span class="fu">ode</span>(</span>
<span id="cb49-845"><a href="#cb49-845" aria-hidden="true" tabindex="-1"></a>    <span class="at">y=</span>yinit_ages,</span>
<span id="cb49-846"><a href="#cb49-846" aria-hidden="true" tabindex="-1"></a>    <span class="at">times=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">400</span>,<span class="at">by=</span><span class="fl">0.1</span>),</span>
<span id="cb49-847"><a href="#cb49-847" aria-hidden="true" tabindex="-1"></a>    <span class="at">func=</span>ja.multistage.model,</span>
<span id="cb49-848"><a href="#cb49-848" aria-hidden="true" tabindex="-1"></a>    <span class="at">parms =</span> <span class="fu">c</span>(<span class="at">beta_ages=</span>beta_ages, <span class="at">aging=</span>aging, <span class="at">births_ages=</span>birth_ages)</span>
<span id="cb49-849"><a href="#cb49-849" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb49-850"><a href="#cb49-850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-851"><a href="#cb49-851" aria-hidden="true" tabindex="-1"></a>  equil_b <span class="ot">&lt;-</span> <span class="fu">drop</span>(<span class="fu">tail</span>(sol_b,<span class="dv">1</span>))[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb49-852"><a href="#cb49-852" aria-hidden="true" tabindex="-1"></a>  n_b <span class="ot">&lt;-</span> equil_b[sindex]<span class="sc">+</span>equil_b[iindex]<span class="sc">+</span>equil_b[rindex]</span>
<span id="cb49-853"><a href="#cb49-853" aria-hidden="true" tabindex="-1"></a>  seroprev_b <span class="ot">&lt;-</span> equil_b[rindex]<span class="sc">/</span>n_b</span>
<span id="cb49-854"><a href="#cb49-854" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(seroprev_b) <span class="ot">&lt;-</span> ages</span>
<span id="cb49-855"><a href="#cb49-855" aria-hidden="true" tabindex="-1"></a>  <span class="co"># barplot(height=seroprev,width=da)</span></span>
<span id="cb49-856"><a href="#cb49-856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-857"><a href="#cb49-857" aria-hidden="true" tabindex="-1"></a>  <span class="do">## get stable age distribution</span></span>
<span id="cb49-858"><a href="#cb49-858" aria-hidden="true" tabindex="-1"></a>  n_b <span class="ot">&lt;-</span> <span class="fu">solve</span>(aging,<span class="sc">-</span><span class="fu">c</span>(births_ages,<span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">29</span>)))</span>
<span id="cb49-859"><a href="#cb49-859" aria-hidden="true" tabindex="-1"></a>  <span class="do">## get R0</span></span>
<span id="cb49-860"><a href="#cb49-860" aria-hidden="true" tabindex="-1"></a>  F <span class="ot">&lt;-</span> <span class="fu">diag</span>(n_b)<span class="sc">%*%</span>beta_ages<span class="sc">+</span>aging<span class="sc">-</span><span class="fu">diag</span>(<span class="fu">diag</span>(aging))</span>
<span id="cb49-861"><a href="#cb49-861" aria-hidden="true" tabindex="-1"></a>  V <span class="ot">&lt;-</span> <span class="fu">diag</span>(gamma_ages<span class="sc">-</span><span class="fu">diag</span>(aging))</span>
<span id="cb49-862"><a href="#cb49-862" aria-hidden="true" tabindex="-1"></a>  R0_b[ii] <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">Re</span>(<span class="fu">eigen</span>(<span class="fu">solve</span>(V,F),<span class="at">only.values=</span>T)<span class="sc">$</span>values))</span>
<span id="cb49-863"><a href="#cb49-863" aria-hidden="true" tabindex="-1"></a>  <span class="co"># R0 = 6.53</span></span>
<span id="cb49-864"><a href="#cb49-864" aria-hidden="true" tabindex="-1"></a>  infects_b <span class="ot">&lt;-</span> sol_b[<span class="fu">dim</span>(sol_b)[<span class="dv">1</span>],<span class="dv">1</span><span class="sc">+</span>iindex]</span>
<span id="cb49-865"><a href="#cb49-865" aria-hidden="true" tabindex="-1"></a>  mean_age_b[ii] <span class="ot">&lt;-</span> <span class="fu">sum</span>(ages <span class="sc">*</span> infects_b<span class="sc">/</span><span class="fu">sum</span>(infects_b))</span>
<span id="cb49-866"><a href="#cb49-866" aria-hidden="true" tabindex="-1"></a>  sum_cases_b[ii] <span class="ot">&lt;-</span> <span class="fu">sum</span>(infects_b[<span class="dv">15</span><span class="sc">:</span><span class="dv">23</span>])</span>
<span id="cb49-867"><a href="#cb49-867" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb49-868"><a href="#cb49-868" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-869"><a href="#cb49-869" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-870"><a href="#cb49-870" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-873"><a href="#cb49-873" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb49-874"><a href="#cb49-874" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">births =</span> births_seq, <span class="at">R0 =</span> R0_b, <span class="st">"mean age"</span> <span class="ot">=</span> mean_age_b, </span>
<span id="cb49-875"><a href="#cb49-875" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"cases (15-35y)"</span> <span class="ot">=</span> sum_cases_b)</span>
<span id="cb49-876"><a href="#cb49-876" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-877"><a href="#cb49-877" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(df)</span>
<span id="cb49-878"><a href="#cb49-878" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-879"><a href="#cb49-879" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb49-880"><a href="#cb49-880" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(births_seq,mean_age_b,<span class="at">xlab=</span><span class="st">"births"</span>,<span class="at">ylab=</span><span class="st">"mean age of infection"</span>)</span>
<span id="cb49-881"><a href="#cb49-881" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(births_seq,sum_cases_b,<span class="at">xlab=</span><span class="st">"births"</span>,<span class="at">ylab=</span><span class="st">"total cases between 15-35y"</span>)</span>
<span id="cb49-882"><a href="#cb49-882" aria-hidden="true" tabindex="-1"></a><span class="co">#plot(births_seq,R0_b,xlab="births",ylab="R0")</span></span>
<span id="cb49-883"><a href="#cb49-883" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-884"><a href="#cb49-884" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-885"><a href="#cb49-885" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-886"><a href="#cb49-886" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-887"><a href="#cb49-887" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-888"><a href="#cb49-888" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-889"><a href="#cb49-889" aria-hidden="true" tabindex="-1"></a><span class="fu">## What do real contact networks look like?</span></span>
<span id="cb49-890"><a href="#cb49-890" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-891"><a href="#cb49-891" aria-hidden="true" tabindex="-1"></a>The POLYMOD study **Mossong, 2008** was a journal-based look into the contact network in contemporary European society.</span>
<span id="cb49-892"><a href="#cb49-892" aria-hidden="true" tabindex="-1"></a>Let's have a look what these data tell us about the contact structure.</span>
<span id="cb49-893"><a href="#cb49-893" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-894"><a href="#cb49-894" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, results='hide'}</span></span>
<span id="cb49-895"><a href="#cb49-895" aria-hidden="true" tabindex="-1"></a>moss <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(</span>
<span id="cb49-896"><a href="#cb49-896" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">url</span>(<span class="st">"http://www.math.mcmaster.ca/~bolker/eeid/data/mossong.csv"</span>),</span>
<span id="cb49-897"><a href="#cb49-897" aria-hidden="true" tabindex="-1"></a>                 <span class="at">as.is=</span><span class="cn">TRUE</span></span>
<span id="cb49-898"><a href="#cb49-898" aria-hidden="true" tabindex="-1"></a>                 )</span>
<span id="cb49-899"><a href="#cb49-899" aria-hidden="true" tabindex="-1"></a>age.categories <span class="ot">&lt;-</span> moss<span class="sc">$</span>contactor[<span class="dv">1</span><span class="sc">:</span><span class="dv">30</span>]</span>
<span id="cb49-900"><a href="#cb49-900" aria-hidden="true" tabindex="-1"></a>moss<span class="sc">$</span>contactor <span class="ot">&lt;-</span> <span class="fu">ordered</span>(moss<span class="sc">$</span>contactor,<span class="at">levels=</span>age.categories)</span>
<span id="cb49-901"><a href="#cb49-901" aria-hidden="true" tabindex="-1"></a>moss<span class="sc">$</span>contactee <span class="ot">&lt;-</span> <span class="fu">ordered</span>(moss<span class="sc">$</span>contactee,<span class="at">levels=</span>age.categories)</span>
<span id="cb49-902"><a href="#cb49-902" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-903"><a href="#cb49-903" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-904"><a href="#cb49-904" aria-hidden="true" tabindex="-1"></a>Since contacts are symmetric, we'll need to estimate the symmetric contact matrix.</span>
<span id="cb49-905"><a href="#cb49-905" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-906"><a href="#cb49-906" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, results='hide', fig.show='hide'}</span></span>
<span id="cb49-907"><a href="#cb49-907" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> <span class="fu">with</span>(</span>
<span id="cb49-908"><a href="#cb49-908" aria-hidden="true" tabindex="-1"></a>           moss,</span>
<span id="cb49-909"><a href="#cb49-909" aria-hidden="true" tabindex="-1"></a>           <span class="fu">tapply</span>(contact.rate,<span class="fu">list</span>(contactor,contactee),unique)</span>
<span id="cb49-910"><a href="#cb49-910" aria-hidden="true" tabindex="-1"></a>           )</span>
<span id="cb49-911"><a href="#cb49-911" aria-hidden="true" tabindex="-1"></a>xsym <span class="ot">&lt;-</span> (x1<span class="sc">+</span><span class="fu">t</span>(x1))<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb49-912"><a href="#cb49-912" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-913"><a href="#cb49-913" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-914"><a href="#cb49-914" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-915"><a href="#cb49-915" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, results='hide', fig.show='hide'}</span></span>
<span id="cb49-916"><a href="#cb49-916" aria-hidden="true" tabindex="-1"></a><span class="fu">filled.contour</span>(ages,ages,<span class="fu">log10</span>(xsym))</span>
<span id="cb49-917"><a href="#cb49-917" aria-hidden="true" tabindex="-1"></a><span class="fu">filled.contour</span>(</span>
<span id="cb49-918"><a href="#cb49-918" aria-hidden="true" tabindex="-1"></a>               ages,ages,<span class="fu">log10</span>(xsym),</span>
<span id="cb49-919"><a href="#cb49-919" aria-hidden="true" tabindex="-1"></a>               <span class="at">plot.title=</span><span class="fu">title</span>(</span>
<span id="cb49-920"><a href="#cb49-920" aria-hidden="true" tabindex="-1"></a>                 <span class="at">main=</span><span class="fu">quote</span>(log[<span class="dv">10</span>](contact<span class="sc">~</span>rate)),</span>
<span id="cb49-921"><a href="#cb49-921" aria-hidden="true" tabindex="-1"></a>                 <span class="at">xlab=</span><span class="st">"age"</span>,<span class="at">ylab=</span><span class="st">"age"</span>)</span>
<span id="cb49-922"><a href="#cb49-922" aria-hidden="true" tabindex="-1"></a>               )</span>
<span id="cb49-923"><a href="#cb49-923" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(<span class="at">height=</span><span class="fu">apply</span>(x1,<span class="dv">1</span>,sum))</span>
<span id="cb49-924"><a href="#cb49-924" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(<span class="at">height=</span><span class="fu">apply</span>(x1,<span class="dv">2</span>,sum))</span>
<span id="cb49-925"><a href="#cb49-925" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-926"><a href="#cb49-926" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-927"><a href="#cb49-927" aria-hidden="true" tabindex="-1"></a>While this matrix tells us how many contacts are made per year by an individual of each age, it doesn't tell us anything about the probability that a contact results in communication of infection.</span>
<span id="cb49-928"><a href="#cb49-928" aria-hidden="true" tabindex="-1"></a>Let's assume that each contact has a constant probability $q$ of resulting in a transmission event.</span>
<span id="cb49-929"><a href="#cb49-929" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-930"><a href="#cb49-930" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, results='show', fig.show='show'}</span></span>
<span id="cb49-931"><a href="#cb49-931" aria-hidden="true" tabindex="-1"></a>q <span class="ot">&lt;-</span> <span class="fl">3e-5</span></span>
<span id="cb49-932"><a href="#cb49-932" aria-hidden="true" tabindex="-1"></a>beta_ages <span class="ot">&lt;-</span> q<span class="sc">*</span>xsym</span>
<span id="cb49-933"><a href="#cb49-933" aria-hidden="true" tabindex="-1"></a><span class="fu">filled.contour</span>(ages,ages,<span class="fu">log10</span>(beta_ages),                </span>
<span id="cb49-934"><a href="#cb49-934" aria-hidden="true" tabindex="-1"></a>               <span class="at">plot.title=</span><span class="fu">title</span>(</span>
<span id="cb49-935"><a href="#cb49-935" aria-hidden="true" tabindex="-1"></a>                 <span class="at">main=</span><span class="st">"WAIFW matrix based on POLYMOD data"</span>,</span>
<span id="cb49-936"><a href="#cb49-936" aria-hidden="true" tabindex="-1"></a>                 <span class="at">xlab=</span><span class="st">"age"</span>,<span class="at">ylab=</span><span class="st">"age"</span>))</span>
<span id="cb49-937"><a href="#cb49-937" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-938"><a href="#cb49-938" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-939"><a href="#cb49-939" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-940"><a href="#cb49-940" aria-hidden="true" tabindex="-1"></a>Now let's simulate the introduction of such a pathogen into a population characterized by this contact structure.</span>
<span id="cb49-941"><a href="#cb49-941" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-942"><a href="#cb49-942" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, results='hide', fig.show='hide'}</span></span>
<span id="cb49-943"><a href="#cb49-943" aria-hidden="true" tabindex="-1"></a>sol_p <span class="ot">&lt;-</span> deSolve<span class="sc">::</span><span class="fu">ode</span>(</span>
<span id="cb49-944"><a href="#cb49-944" aria-hidden="true" tabindex="-1"></a>           <span class="at">y=</span>yinit_ages,</span>
<span id="cb49-945"><a href="#cb49-945" aria-hidden="true" tabindex="-1"></a>           <span class="at">times=</span><span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">200</span>,<span class="at">by=</span><span class="fl">0.5</span>),</span>
<span id="cb49-946"><a href="#cb49-946" aria-hidden="true" tabindex="-1"></a>           <span class="at">func=</span>ja.multistage.model,</span>
<span id="cb49-947"><a href="#cb49-947" aria-hidden="true" tabindex="-1"></a>           <span class="at">parms =</span> <span class="fu">c</span>(<span class="at">beta_ages=</span>beta_ages, <span class="at">aging=</span>aging, <span class="at">births=</span>births_ages)</span>
<span id="cb49-948"><a href="#cb49-948" aria-hidden="true" tabindex="-1"></a>           )</span>
<span id="cb49-949"><a href="#cb49-949" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-950"><a href="#cb49-950" aria-hidden="true" tabindex="-1"></a>time <span class="ot">&lt;-</span> sol_p[,<span class="dv">1</span>]</span>
<span id="cb49-951"><a href="#cb49-951" aria-hidden="true" tabindex="-1"></a>infects_p <span class="ot">&lt;-</span> sol_p[,<span class="dv">1</span><span class="sc">+</span>iindex]</span>
<span id="cb49-952"><a href="#cb49-952" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(time,<span class="fu">apply</span>(infects_p,<span class="dv">1</span>,sum),<span class="at">type=</span><span class="st">'l'</span>)</span>
<span id="cb49-953"><a href="#cb49-953" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(time,<span class="fu">apply</span>(infects_p[,juvies],<span class="dv">1</span>,sum),<span class="at">col=</span><span class="st">'red'</span>)</span>
<span id="cb49-954"><a href="#cb49-954" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(time,<span class="fu">apply</span>(infects_p[,adults],<span class="dv">1</span>,sum),<span class="at">col=</span><span class="st">'blue'</span>)</span>
<span id="cb49-955"><a href="#cb49-955" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-956"><a href="#cb49-956" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-957"><a href="#cb49-957" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-958"><a href="#cb49-958" aria-hidden="true" tabindex="-1"></a>As before, we can also look at the equilibrium seroprevalence</span>
<span id="cb49-959"><a href="#cb49-959" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-960"><a href="#cb49-960" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, results='hide', fig.show='hide'}</span></span>
<span id="cb49-961"><a href="#cb49-961" aria-hidden="true" tabindex="-1"></a>equil_p <span class="ot">&lt;-</span> <span class="fu">drop</span>(<span class="fu">tail</span>(sol_p,<span class="dv">1</span>))[<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb49-962"><a href="#cb49-962" aria-hidden="true" tabindex="-1"></a>n_p <span class="ot">&lt;-</span> equil_p[sindex]<span class="sc">+</span>equil_p[iindex]<span class="sc">+</span>equil_p[rindex]</span>
<span id="cb49-963"><a href="#cb49-963" aria-hidden="true" tabindex="-1"></a>seroprev_p <span class="ot">&lt;-</span> equil_p[rindex]<span class="sc">/</span>n_p</span>
<span id="cb49-964"><a href="#cb49-964" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(seroprev_p) <span class="ot">&lt;-</span> ages</span>
<span id="cb49-965"><a href="#cb49-965" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(<span class="at">height=</span>seroprev_p,<span class="at">width=</span>da_ages)</span>
<span id="cb49-966"><a href="#cb49-966" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-967"><a href="#cb49-967" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-968"><a href="#cb49-968" aria-hidden="true" tabindex="-1"></a>and compute the $R_0$ for this infection.</span>
<span id="cb49-969"><a href="#cb49-969" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-970"><a href="#cb49-970" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, results='hide'}</span></span>
<span id="cb49-971"><a href="#cb49-971" aria-hidden="true" tabindex="-1"></a>n_p <span class="ot">&lt;-</span> <span class="fu">solve</span>(aging,<span class="sc">-</span><span class="fu">c</span>(births_ages,<span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">29</span>)))</span>
<span id="cb49-972"><a href="#cb49-972" aria-hidden="true" tabindex="-1"></a>F_p <span class="ot">&lt;-</span> <span class="fu">diag</span>(n_p)<span class="sc">%*%</span>beta_ages<span class="sc">+</span>aging<span class="sc">-</span><span class="fu">diag</span>(<span class="fu">diag</span>(aging))</span>
<span id="cb49-973"><a href="#cb49-973" aria-hidden="true" tabindex="-1"></a>V_p <span class="ot">&lt;-</span> <span class="fu">diag</span>(gamma_ages<span class="sc">-</span><span class="fu">diag</span>(aging))</span>
<span id="cb49-974"><a href="#cb49-974" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(<span class="fu">Re</span>(<span class="fu">eigen</span>(<span class="fu">solve</span>(V_p,F_p),<span class="at">only.values=</span>T)<span class="sc">$</span>values))</span>
<span id="cb49-975"><a href="#cb49-975" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-976"><a href="#cb49-976" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-977"><a href="#cb49-977" aria-hidden="true" tabindex="-1"></a>How does this R0 value compare to the R0 value obtained from Exercise 4?</span>
<span id="cb49-978"><a href="#cb49-978" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-979"><a href="#cb49-979" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, echo=FALSE}</span></span>
<span id="cb49-980"><a href="#cb49-980" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb49-981"><a href="#cb49-981" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-982"><a href="#cb49-982" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-983"><a href="#cb49-983" aria-hidden="true" tabindex="-1"></a><span class="fu">## Bonus: Calculating R0 Using a Next Generation Matrix</span></span>
<span id="cb49-984"><a href="#cb49-984" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-985"><a href="#cb49-985" aria-hidden="true" tabindex="-1"></a>The next generation matrix is a matrix that specifies how many new age-specific infections are generated by a typical infected individual of each age class (in a fully susceptible population).</span>
<span id="cb49-986"><a href="#cb49-986" aria-hidden="true" tabindex="-1"></a>For example, let's consider an infected adult and ask how many new juvenile infections it generates: this is the product of the number of susceptible juveniles (from the stable age distribution), the per capita transmission rate from adults to juveniles and the average duration of infection, i.e. $S_J^* \times \beta_{JA} \times 1/ (\gamma+\mu)$.</span>
<span id="cb49-987"><a href="#cb49-987" aria-hidden="true" tabindex="-1"></a>This forms one element of our next generation matrix.</span>
<span id="cb49-988"><a href="#cb49-988" aria-hidden="true" tabindex="-1"></a>The other elements look very similar, except there are extra terms when we consider an infected juvenile because there is a (very small) chance they may age during the infectious period and therefore cause new infections as an adult: $$</span>
<span id="cb49-989"><a href="#cb49-989" aria-hidden="true" tabindex="-1"></a> \mathrm{NGM} = \left(</span>
<span id="cb49-990"><a href="#cb49-990" aria-hidden="true" tabindex="-1"></a>  \begin{matrix}</span>
<span id="cb49-991"><a href="#cb49-991" aria-hidden="true" tabindex="-1"></a>    \frac{S_J^* \beta_{JJ} }{(\gamma+\alpha)} +\frac{\alpha}{(\gamma+\mu)}\frac{S_J^*\beta_{JA}}{(\gamma+\mu)} &amp;  </span>
<span id="cb49-992"><a href="#cb49-992" aria-hidden="true" tabindex="-1"></a>    \frac{S_J^* \beta_{JA}}{(\gamma+\mu)} <span class="sc">\\</span></span>
<span id="cb49-993"><a href="#cb49-993" aria-hidden="true" tabindex="-1"></a>    \frac{S_A^* \beta_{AJ} }{(\gamma+\alpha)} +\frac{\alpha}{(\gamma+\mu)}\frac{S_A^*\beta_{AA}}{(\gamma+\mu)} &amp;  \frac{S_A^* \beta_{AA}}{(\gamma+\mu)} </span>
<span id="cb49-994"><a href="#cb49-994" aria-hidden="true" tabindex="-1"></a>  \end{matrix}</span>
<span id="cb49-995"><a href="#cb49-995" aria-hidden="true" tabindex="-1"></a>\right)</span>
<span id="cb49-996"><a href="#cb49-996" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb49-997"><a href="#cb49-997" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-998"><a href="#cb49-998" aria-hidden="true" tabindex="-1"></a>$R_0$ can then be computed as the dominant eigenvalue (i.e., the one with the largest real part) of this matrix. Let's take an example from a model with 2 age classes, from above. First, let's define the components of the next generation matrix:</span>
<span id="cb49-999"><a href="#cb49-999" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-1002"><a href="#cb49-1002" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb49-1003"><a href="#cb49-1003" aria-hidden="true" tabindex="-1"></a>da_ngm <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">20</span>,<span class="dv">60</span>) <span class="co"># this classifies the two age groups (0-20, 21-60) </span></span>
<span id="cb49-1004"><a href="#cb49-1004" aria-hidden="true" tabindex="-1"></a>b1_ngm <span class="ot">=</span> <span class="fl">0.005</span></span>
<span id="cb49-1005"><a href="#cb49-1005" aria-hidden="true" tabindex="-1"></a>b2_ngm <span class="ot">=</span> <span class="fl">0.006</span></span>
<span id="cb49-1006"><a href="#cb49-1006" aria-hidden="true" tabindex="-1"></a>alpha_ngm <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span>da_ngm[<span class="dv">1</span>]</span>
<span id="cb49-1007"><a href="#cb49-1007" aria-hidden="true" tabindex="-1"></a>mu_ngm <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span>da_ngm[<span class="dv">2</span>]</span>
<span id="cb49-1008"><a href="#cb49-1008" aria-hidden="true" tabindex="-1"></a>n_ngm <span class="ot">&lt;-</span> births_demog<span class="sc">/</span><span class="fu">c</span>(alpha_ngm,mu_ngm)</span>
<span id="cb49-1009"><a href="#cb49-1009" aria-hidden="true" tabindex="-1"></a>beta_ngm <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(b1_ngm<span class="sc">+</span>b2_ngm,b1_ngm,b1_ngm,b1_ngm<span class="sc">+</span>b2_ngm),<span class="at">nrow=</span><span class="dv">2</span>,<span class="at">ncol=</span><span class="dv">2</span>) </span>
<span id="cb49-1010"><a href="#cb49-1010" aria-hidden="true" tabindex="-1"></a>gamma_ngm <span class="ot">=</span> <span class="dv">10</span></span>
<span id="cb49-1011"><a href="#cb49-1011" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb49-1012"><a href="#cb49-1012" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-1013"><a href="#cb49-1013" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-1014"><a href="#cb49-1014" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-1015"><a href="#cb49-1015" aria-hidden="true" tabindex="-1"></a>The Next Generation Matrix can be calculated in **R** as:</span>
<span id="cb49-1016"><a href="#cb49-1016" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-1019"><a href="#cb49-1019" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb49-1020"><a href="#cb49-1020" aria-hidden="true" tabindex="-1"></a>ngm <span class="ot">&lt;-</span> <span class="fu">matrix</span>(</span>
<span id="cb49-1021"><a href="#cb49-1021" aria-hidden="true" tabindex="-1"></a>              <span class="fu">c</span>(</span>
<span id="cb49-1022"><a href="#cb49-1022" aria-hidden="true" tabindex="-1"></a>                n_ngm[<span class="dv">1</span>]<span class="sc">*</span>beta_ngm[<span class="dv">1</span>,<span class="dv">1</span>]<span class="sc">/</span>(gamma_ngm<span class="sc">+</span>alpha_ngm)<span class="sc">+</span></span>
<span id="cb49-1023"><a href="#cb49-1023" aria-hidden="true" tabindex="-1"></a>                  alpha_ngm<span class="sc">/</span>(gamma_ngm<span class="sc">+</span>mu_ngm)<span class="sc">*</span>n[<span class="dv">1</span>]<span class="sc">*</span>beta_ngm[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">/</span>(gamma_ngm<span class="sc">+</span>mu_ngm),</span>
<span id="cb49-1024"><a href="#cb49-1024" aria-hidden="true" tabindex="-1"></a>                n_ngm[<span class="dv">2</span>]<span class="sc">*</span>beta_ngm[<span class="dv">2</span>,<span class="dv">1</span>]<span class="sc">/</span>(gamma_ngm<span class="sc">+</span>alpha_ngm)<span class="sc">+</span></span>
<span id="cb49-1025"><a href="#cb49-1025" aria-hidden="true" tabindex="-1"></a>                  alpha_ngm<span class="sc">/</span>(gamma_ngm<span class="sc">+</span>mu_ngm)<span class="sc">*</span>n[<span class="dv">2</span>]<span class="sc">*</span>beta_ngm[<span class="dv">2</span>,<span class="dv">2</span>]<span class="sc">/</span>(gamma_ngm<span class="sc">+</span>mu_ngm),</span>
<span id="cb49-1026"><a href="#cb49-1026" aria-hidden="true" tabindex="-1"></a>                n_ngm[<span class="dv">1</span>]<span class="sc">*</span>beta_ngm[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">/</span>(gamma_ngm<span class="sc">+</span>mu_ngm),</span>
<span id="cb49-1027"><a href="#cb49-1027" aria-hidden="true" tabindex="-1"></a>                n_ngm[<span class="dv">2</span>]<span class="sc">*</span>beta_ngm[<span class="dv">2</span>,<span class="dv">2</span>]<span class="sc">/</span>(gamma_ngm<span class="sc">+</span>mu_ngm)</span>
<span id="cb49-1028"><a href="#cb49-1028" aria-hidden="true" tabindex="-1"></a>                ),</span>
<span id="cb49-1029"><a href="#cb49-1029" aria-hidden="true" tabindex="-1"></a>              <span class="at">nrow=</span><span class="dv">2</span>,</span>
<span id="cb49-1030"><a href="#cb49-1030" aria-hidden="true" tabindex="-1"></a>              <span class="at">ncol=</span><span class="dv">2</span></span>
<span id="cb49-1031"><a href="#cb49-1031" aria-hidden="true" tabindex="-1"></a>              )</span>
<span id="cb49-1032"><a href="#cb49-1032" aria-hidden="true" tabindex="-1"></a><span class="fu">eigen</span>(ngm)</span>
<span id="cb49-1033"><a href="#cb49-1033" aria-hidden="true" tabindex="-1"></a><span class="fu">eigen</span>(ngm,<span class="at">only.values=</span><span class="cn">TRUE</span>)</span>
<span id="cb49-1034"><a href="#cb49-1034" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(<span class="fu">Re</span>(<span class="fu">eigen</span>(ngm,<span class="at">only.values=</span>T)<span class="sc">$</span>values))</span>
<span id="cb49-1035"><a href="#cb49-1035" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-1036"><a href="#cb49-1036" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>